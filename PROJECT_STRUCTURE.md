# Kiwi Education Workbench - é¡¹ç›®ç»“æ„

## æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **æ¡†æ¶**: Next.js 16.1.4 (App Router)
- **è¯­è¨€**: TypeScript
- **æ•°æ®åº“**: Supabase (PostgreSQL + Auth + RLS + Realtime)
- **UI**: shadcn/ui + Tailwind CSS
- **çŠ¶æ€ç®¡ç†**: Zustand (å®¢æˆ·ç«¯) + React Query (æœåŠ¡ç«¯)
- **éƒ¨ç½²**: Vercel

## ç›®å½•ç»“æ„

```
kiwi-workbench/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                   # è®¤è¯è·¯ç”±ç»„ï¼ˆæ—  Shellï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # ç©ºå¸ƒå±€
â”‚   â”‚   â””â”€â”€ login/
â”‚   â”‚       â””â”€â”€ page.tsx          # ç™»å½•é¡µ
â”‚   â”‚
â”‚   â”œâ”€â”€ (protected)/              # å—ä¿æŠ¤è·¯ç”±ç»„ï¼ˆæœ‰ Shellï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # å…¨å±€å¸ƒå±€ï¼ˆShell: ä¾§è¾¹æ +é¡¶éƒ¨æ ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ page.tsx              # ä¸ªäººé¦–é¡µ Dashboardï¼ˆæ ¹è·¯ç”± /ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ messages/             # ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ [conversationId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # ä¼šè¯è¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ knowledge/            # ä¼ä¸šçŸ¥è¯†åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ [documentId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ projects/             # é¡¹ç›®åä½œä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ [projectId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ materials/            # é”€å”®ç´ æä¸­å°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ contacts/             # é€šè®¯å½•
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sales/                # é”€å”®å·¥ä½œå°
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # å·¥ä½œå°é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ customers/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx      # å®¢æˆ·åˆ—è¡¨
â”‚   â”‚   â”‚       â””â”€â”€ [id]/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx  # å®¢æˆ·è¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ bd/                   # BDæ¸ é“å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ marketing/            # å¸‚åœºå·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tutor/                # å¯¼å¸ˆå·¥ä½œå°
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ students/
â”‚   â”‚   â”‚       â””â”€â”€ [studentId]/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ academic/             # æ•™åŠ¡å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ finance/              # è´¢åŠ¡äººäº‹å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ quality/              # ç®¡ç†è´¨æ£€ä¸­å¿ƒ
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ settings/             # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                     # Auth å›è°ƒï¼ˆä¸åœ¨è·¯ç”±ç»„å†…ï¼‰
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚       â””â”€â”€ route.ts          # Supabase OAuth å›è°ƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼
â”‚
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ layout/                   # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx           # ä¾§è¾¹æ å¯¼èˆª
â”‚   â”‚   â”œâ”€â”€ Topbar.tsx            # é¡¶éƒ¨å¯¼èˆª
â”‚   â”‚   â””â”€â”€ Shell.tsx             # Shellå¸ƒå±€å®¹å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                       # shadcn/uiåŸºç¡€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ shared/                   # å…±äº«ç»„ä»¶
â”‚       â”œâ”€â”€ PlaceholderPage.tsx   # å ä½é¡µ
â”‚       â”œâ”€â”€ EmptyState.tsx        # ç©ºçŠ¶æ€
â”‚       â””â”€â”€ AccessDenied.tsx      # æ— æƒé™
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ supabase/                 # Supabaseå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ client.ts             # æµè§ˆå™¨ç«¯å®¢æˆ·ç«¯ï¼ˆAnon Keyï¼‰
â”‚   â”‚   â””â”€â”€ server.ts             # æœåŠ¡ç«¯å®¢æˆ·ç«¯ï¼ˆAnon Keyï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ mock/                     # Mock æ•°æ®
â”‚   â”‚   â””â”€â”€ data.ts               # ä¸´æ—¶æ•°æ®
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # é€šç”¨å·¥å…·
â”‚       â””â”€â”€ cn.ts                 # classNameåˆå¹¶
â”‚
â”œâ”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ database.ts               # Supabaseæ•°æ®åº“ç±»å‹
â”‚   â””â”€â”€ entities.ts               # ä¸šåŠ¡å®ä½“ç±»å‹
â”‚
â”œâ”€â”€ middleware.ts                 # Next.jsä¸­é—´ä»¶ï¼ˆè®¤è¯æ‹¦æˆªï¼‰
â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.ts            # Tailwindé…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â”œâ”€â”€ package.json                  # ä¾èµ–ç®¡ç†
â””â”€â”€ package-lock.json             # ä¾èµ–é”å®šï¼ˆå¿…é¡»æäº¤ï¼‰
```

## è·¯ç”±æ˜ å°„ï¼ˆä¸¥æ ¼å¯¹åº”v8.0ï¼‰

| è·¯ç”±è·¯å¾„ | é¡µé¢ | å¯¹åº”v8.0æ¨¡å— | çŠ¶æ€ |
|---------|------|-------------|------|
| `/login` | ç™»å½•é¡µ | - | âœ… å®Œæˆ |
| `/` | ä¸ªäººé¦–é¡µ | 1. ä¸ªäººé¦–é¡µï¼ˆç»Ÿä¸€å…¥å£ï¼‰ | âœ… å®Œæˆ |
| `/messages` | ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ | 2. ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ | ğŸ”² å ä½ |
| `/knowledge` | ä¼ä¸šçŸ¥è¯†åº“ | 3. ä¼ä¸šçŸ¥è¯†åº“ | ğŸ”² å ä½ |
| `/projects` | é¡¹ç›®åä½œä¸­å¿ƒ | 4. é¡¹ç›®åä½œä¸­å¿ƒ | ğŸ”² å ä½ |
| `/materials` | é”€å”®ç´ æä¸­å° | 5. é”€å”®ç´ æä¸­å° | ğŸ”² å ä½ |
| `/contacts` | é€šè®¯å½• | 6. é€šè®¯å½• | ğŸ”² å ä½ |
| `/sales` | é”€å”®å·¥ä½œå° | 7. é”€å”®å·¥ä½œå° | ğŸ”² å ä½ |
| `/sales/customers` | å®¢æˆ·åˆ—è¡¨ | 7. é”€å”®å·¥ä½œå° | ğŸ”² å ä½ |
| `/bd` | BDæ¸ é“å·¥ä½œå° | 8. BDæ¸ é“å·¥ä½œå° | ğŸ”² å ä½ |
| `/marketing` | å¸‚åœºå·¥ä½œå° | 9. å¸‚åœºå·¥ä½œå° | ğŸ”² å ä½ |
| `/tutor` | å¯¼å¸ˆå·¥ä½œå° | 10. å¯¼å¸ˆå·¥ä½œå° | ğŸ”² å ä½ |
| `/academic` | æ•™åŠ¡å·¥ä½œå° | 11. æ•™åŠ¡å·¥ä½œå° | ğŸ”² å ä½ |
| `/finance` | è´¢åŠ¡äººäº‹å·¥ä½œå° | 12. è´¢åŠ¡äººäº‹å·¥ä½œå° | ğŸ”² å ä½ |
| `/quality` | ç®¡ç†è´¨æ£€ä¸­å¿ƒ | 13. ç®¡ç†è´¨æ£€ä¸­å¿ƒ | ğŸ”² å ä½ |
| `/settings` | ç³»ç»Ÿè®¾ç½® | 15. ç³»ç»Ÿè®¾ç½® | ğŸ”² å ä½ |

## æƒé™æ§åˆ¶æ¶æ„

### 1. Supabase RLSç­–ç•¥
- æ‰€æœ‰æ•°æ®è®¿é—®é€šè¿‡RLSæ§åˆ¶
- ä¸‰çº§æƒé™ï¼šæœ¬äºº/æœ¬éƒ¨é—¨/å…¨å…¬å¸
- å‰ç«¯åªä½¿ç”¨ `anon key`
- Service Role Keyä»…ç”¨äºECSåŒæ­¥æœåŠ¡

### 2. ä¸­é—´ä»¶å±‚é¢
```typescript
// middleware.ts
export async function middleware(request: NextRequest) {
  // éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
  // æ£€æŸ¥é¡µé¢è®¿é—®æƒé™
  // é‡å®šå‘æœªæˆæƒè®¿é—®
}
```

### 3. ç»„ä»¶å±‚é¢
```typescript
// ä½¿ç”¨è‡ªå®šä¹‰Hookæ£€æŸ¥æƒé™
const { hasPermission } = usePermissions();
if (!hasPermission('sales:view')) return <AccessDenied />;
```

## æ•°æ®æµæ¶æ„

```
ç”¨æˆ·äº¤äº’
    â†“
Reactç»„ä»¶
    â†“
â”œâ”€ Server Componentsï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰
â”‚  â””â”€ Supabase Server Client â†’ RLS â†’ PostgreSQL
â”‚
â””â”€ Client Componentsï¼ˆå®¢æˆ·ç«¯äº¤äº’ï¼‰
   â””â”€ Supabase Browser Client â†’ RLS â†’ PostgreSQL
       â””â”€ React Queryç¼“å­˜
```

## ç¬¬ä¸€é˜¶æ®µå®ç°èŒƒå›´

âœ… å¿…é¡»å®Œæˆï¼š
1. é¡¹ç›®åˆå§‹åŒ–ä¸é…ç½®
2. Supabaseé›†æˆä¸è®¤è¯
3. ç™»å½•é¡µ
4. å…¨å±€å¸ƒå±€ï¼ˆä¾§è¾¹æ +é¡¶éƒ¨å¯¼èˆªï¼‰
5. ä¸ªäººé¦–é¡µï¼ˆDashboardï¼‰
6. ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒï¼ˆåªè¯»ï¼‰
7. é”€å”®å·¥ä½œå°ï¼ˆå®¢æˆ·åˆ—è¡¨+è¯¦æƒ…ï¼‰
8. ä¼ä¸šçŸ¥è¯†åº“
9. ç®¡ç†è´¨æ£€ä¸­å¿ƒ
10. ç©ºçŠ¶æ€ä¸æ— æƒé™é¡µé¢

ğŸ”„ Mockæ•°æ®ç­–ç•¥ï¼š
- ç¬¬ä¸€é˜¶æ®µä½¿ç”¨Mockæ•°æ®
- æ•°æ®ç»“æ„å®Œå…¨å¯¹é½Supabaseè¡¨è®¾è®¡
- åç»­å¯æ— ç¼åˆ‡æ¢çœŸå®æ•°æ®
