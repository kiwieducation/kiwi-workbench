module.exports=[38515,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(87532),f=a.i(81464),g=a.i(84505),h=a.i(5784),i=a.i(63519),j=a.i(41675),k=a.i(92e3),l=a.i(73570),m=a.i(67453),n=a.i(15618),o=a.i(60246),p=a.i(70106);let q=(0,p.default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var r=a.i(50522);let s=(0,p.default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),t=(0,p.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var u=a.i(3130),v=a.i(40695),w=a.i(7706),x=a.i(98963),y=a.i(9444),z=a.i(33508),A=a.i(69240);let B={new:{label:"新咨询",color:"bg-blue-100 text-blue-700"},following:{label:"跟进中",color:"bg-purple-100 text-purple-700"},proposal:{label:"方案制定",color:"bg-amber-100 text-amber-700"},signed:{label:"已签约",color:"bg-emerald-100 text-emerald-700"},lost:{label:"已流失",color:"bg-slate-100 text-slate-500"}},C={low:{label:"正常",color:"text-emerald-600",bgColor:"bg-emerald-50"},medium:{label:"需关注",color:"text-amber-600",bgColor:"bg-amber-50"},high:{label:"高风险",color:"text-red-600",bgColor:"bg-red-50"}},D=[{id:"cust-001",name:"Emily Zhang",phone:"+86 138****0001",email:"emily.z@example.com",wechat:"emily_dream_big",tags:["VIP","高二","美本"],stage:"signed",riskLevel:"low",owner:"Sarah Wu",ownerId:"user-002",source:"小红书",lastContact:"2小时前",nextAction:"文书审核",nextActionDate:"2024-11-01",createdAt:"2024-09-15",updatedAt:"2024-10-24",studentName:"Emily Zhang",grade:"高二",targetCountry:"美国",budget:"50万+"}];async function E(a){let b=(0,A.createClient)(),{search:c,stage:d,owner:e,riskLevel:f,page:g=1,pageSize:h=20}=a||{};try{let a=b.from("customers").select("*",{count:"exact"});c&&(a=a.or(`name.ilike.%${c}%,phone.ilike.%${c}%`)),d&&"all"!==d&&(a=a.eq("stage",d)),e&&(a=a.eq("assigned_to",e)),f&&"all"!==f&&(a=a.eq("risk_level",f));let i=(g-1)*h;a=a.range(i,i+h-1).order("updated_at",{ascending:!1});let{data:j,error:k,count:l}=await a;if(k)return console.warn("Supabase query failed, using mock data:",k.message),(0,y.success)({data:D,total:D.length});let m=(j||[]).map(F);return(0,y.success)({data:m,total:l||0})}catch(a){return console.error("getCustomers error:",a),(0,y.success)({data:D,total:D.length})}}function F(a){var b;let c,d,e,f,g;return{id:a.id,name:a.name,phone:a.phone||"",email:a.email||void 0,wechat:a.wechat||void 0,tags:a.tags||[],stage:a.stage,riskLevel:a.risk_level||"low",owner:a.assigned_to||"未分配",ownerId:a.assigned_to||"",source:a.source||"",lastContact:(c=new Date(b=a.updated_at),e=Math.floor((d=new Date().getTime()-c.getTime())/6e4),f=Math.floor(d/36e5),g=Math.floor(d/864e5),e<60?`${e}分钟前`:f<24?`${f}小时前`:g<7?`${g}天前`:G(b)),nextAction:a.next_action||"",nextActionDate:a.next_action_date||void 0,createdAt:G(a.created_at),updatedAt:G(a.updated_at),studentName:a.student_name||void 0,grade:a.grade||void 0,targetCountry:a.target_country||void 0,budget:a.budget||void 0,notes:a.notes||void 0}}function G(a){return new Date(a).toLocaleDateString("zh-CN")}async function H(a){let b=(0,A.createClient)();try{let c={name:a.name,phone:a.phone||null,email:a.email||null,wechat:a.wechat||null,source:a.source||null,stage:a.stage||"new",tags:a.tags||null,notes:a.notes||null,student_name:a.studentName||null,grade:a.grade||null,target_country:a.targetCountry||null,budget:a.budget||null,assigned_to:a.assignedTo||null,risk_level:"low"},{data:d,error:e}=await b.from("customers").insert(c).select().single();if(e){if(console.error("Create customer error:",e),"42501"===e.code||e.message.includes("permission denied"))return(0,y.failure)({code:"PERMISSION_DENIED",message:"没有创建客户的权限，请联系管理员"});if("23505"===e.code)return(0,y.failure)({code:"DUPLICATE",message:"该客户已存在（手机号或邮箱重复）"});return(0,y.failure)((0,y.createServiceError)(e,"创建客户失败"))}return(0,y.success)(F(d))}catch(a){return console.error("createCustomer error:",a),(0,y.failure)((0,y.createServiceError)(a,"创建客户失败"))}}async function I(a,b){let c=(0,A.createClient)();try{let d={};void 0!==b.name&&(d.name=b.name),void 0!==b.phone&&(d.phone=b.phone||null),void 0!==b.email&&(d.email=b.email||null),void 0!==b.wechat&&(d.wechat=b.wechat||null),void 0!==b.source&&(d.source=b.source||null),void 0!==b.stage&&(d.stage=b.stage),void 0!==b.riskLevel&&(d.risk_level=b.riskLevel),void 0!==b.tags&&(d.tags=b.tags),void 0!==b.notes&&(d.notes=b.notes||null),void 0!==b.nextAction&&(d.next_action=b.nextAction||null),void 0!==b.nextActionDate&&(d.next_action_date=b.nextActionDate||null),void 0!==b.studentName&&(d.student_name=b.studentName||null),void 0!==b.grade&&(d.grade=b.grade||null),void 0!==b.targetCountry&&(d.target_country=b.targetCountry||null),void 0!==b.budget&&(d.budget=b.budget||null),void 0!==b.assignedTo&&(d.assigned_to=b.assignedTo||null);let{data:e,error:f}=await c.from("customers").update(d).eq("id",a).select().single();if(f){if(console.error("Update customer error:",f),"42501"===f.code||f.message.includes("permission denied"))return(0,y.failure)({code:"PERMISSION_DENIED",message:"没有编辑客户的权限"});if("PGRST116"===f.code)return(0,y.failure)({code:"NOT_FOUND",message:"客户不存在"});return(0,y.failure)((0,y.createServiceError)(f,"更新客户失败"))}return(0,y.success)(F(e))}catch(a){return console.error("updateCustomer error:",a),(0,y.failure)((0,y.createServiceError)(a,"更新客户失败"))}}async function J(a,b){return I(a,{stage:b})}async function K(a){let b=await I(a,{stage:"lost"});return b.success?(0,y.success)(void 0):(0,y.failure)(b.error)}function L({customer:a,onSuccess:d,onCancel:e}){let f=(0,y.useToast)(),g=!!a,[h,i]=(0,c.useState)({name:a?.name||"",phone:a?.phone||"",email:a?.email||"",wechat:a?.wechat||"",source:a?.source||"",stage:a?.stage||"new",tags:a?.tags?.join(", ")||"",notes:a?.notes||"",studentName:a?.studentName||"",grade:a?.grade||"",targetCountry:a?.targetCountry||"",budget:a?.budget||""}),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)({}),n=(a,b)=>{i(c=>({...c,[a]:b})),l[a]&&m(b=>{let c={...b};return delete c[a],c})},o=async b=>{let c;if(b.preventDefault(),c={},h.name.trim()||(c.name="请输入客户姓名"),h.phone&&!/^[\d\s\-+()]+$/.test(h.phone)&&(c.phone="请输入有效的手机号"),h.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h.email)&&(c.email="请输入有效的邮箱"),m(c),0!==Object.keys(c).length)return;k(!0);let e=h.tags.split(",").map(a=>a.trim()).filter(a=>a);if(g&&a){let b={name:h.name,phone:h.phone||void 0,email:h.email||void 0,wechat:h.wechat||void 0,source:h.source||void 0,stage:h.stage,tags:e.length>0?e:void 0,notes:h.notes||void 0,studentName:h.studentName||void 0,grade:h.grade||void 0,targetCountry:h.targetCountry||void 0,budget:h.budget||void 0},c=await I(a.id,b);c.success?(f.success("更新成功","客户信息已更新"),d(c.data)):f.error("更新失败",c.error.message)}else{let a={name:h.name,phone:h.phone||void 0,email:h.email||void 0,wechat:h.wechat||void 0,source:h.source||void 0,stage:h.stage,tags:e.length>0?e:void 0,notes:h.notes||void 0,studentName:h.studentName||void 0,grade:h.grade||void 0,targetCountry:h.targetCountry||void 0,budget:h.budget||void 0},b=await H(a);b.success?(f.success("创建成功","新客户已添加"),d(b.data)):f.error("创建失败",b.error.message)}k(!1)};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:g?"编辑客户":"新建客户"}),(0,b.jsx)("button",{onClick:e,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100",children:(0,b.jsx)(z.X,{size:20})})]}),(0,b.jsx)("form",{onSubmit:o,className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"基本信息"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["客户姓名 ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:h.name,onChange:a=>n("name",a.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${l.name?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入客户姓名"}),l.name&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:l.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"手机号"}),(0,b.jsx)("input",{type:"tel",value:h.phone,onChange:a=>n("phone",a.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${l.phone?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入手机号"}),l.phone&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:l.phone})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"邮箱"}),(0,b.jsx)("input",{type:"email",value:h.email,onChange:a=>n("email",a.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${l.email?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入邮箱"}),l.email&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:l.email})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"微信号"}),(0,b.jsx)("input",{type:"text",value:h.wechat,onChange:a=>n("wechat",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"输入微信号"})]}),(0,b.jsx)("div",{className:"col-span-2 mt-4",children:(0,b.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"销售信息"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"客户来源"}),(0,b.jsx)("input",{type:"text",value:h.source,onChange:a=>n("source",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"如：小红书、转介绍、官网"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"客户阶段"}),(0,b.jsx)("select",{value:h.stage,onChange:a=>n("stage",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:Object.entries(B).map(([a,c])=>(0,b.jsx)("option",{value:a,children:c.label},a))})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"标签"}),(0,b.jsx)("input",{type:"text",value:h.tags,onChange:a=>n("tags",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"用逗号分隔，如：VIP, 美本, 高意向"})]}),(0,b.jsx)("div",{className:"col-span-2 mt-4",children:(0,b.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"学员信息"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"学员姓名"}),(0,b.jsx)("input",{type:"text",value:h.studentName,onChange:a=>n("studentName",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"输入学员姓名"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"年级"}),(0,b.jsxs)("select",{value:h.grade,onChange:a=>n("grade",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,b.jsx)("option",{value:"",children:"请选择"}),(0,b.jsx)("option",{value:"初一",children:"初一"}),(0,b.jsx)("option",{value:"初二",children:"初二"}),(0,b.jsx)("option",{value:"初三",children:"初三"}),(0,b.jsx)("option",{value:"高一",children:"高一"}),(0,b.jsx)("option",{value:"高二",children:"高二"}),(0,b.jsx)("option",{value:"高三",children:"高三"}),(0,b.jsx)("option",{value:"大一",children:"大一"}),(0,b.jsx)("option",{value:"大二",children:"大二"}),(0,b.jsx)("option",{value:"大三",children:"大三"}),(0,b.jsx)("option",{value:"大四",children:"大四"}),(0,b.jsx)("option",{value:"研一",children:"研一"}),(0,b.jsx)("option",{value:"研二",children:"研二"}),(0,b.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"目标国家"}),(0,b.jsx)("input",{type:"text",value:h.targetCountry,onChange:a=>n("targetCountry",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"如：美国、英国、美国/英国"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"预算范围"}),(0,b.jsxs)("select",{value:h.budget,onChange:a=>n("budget",a.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,b.jsx)("option",{value:"",children:"请选择"}),(0,b.jsx)("option",{value:"10万以下",children:"10万以下"}),(0,b.jsx)("option",{value:"10-30万",children:"10-30万"}),(0,b.jsx)("option",{value:"30-50万",children:"30-50万"}),(0,b.jsx)("option",{value:"50万+",children:"50万+"})]})]}),(0,b.jsxs)("div",{className:"col-span-2 mt-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"备注"}),(0,b.jsx)("textarea",{value:h.notes,onChange:a=>n("notes",a.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 resize-none",placeholder:"输入备注信息..."})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50",children:[(0,b.jsx)(v.Button,{variant:"outline",onClick:e,disabled:j,children:"取消"}),(0,b.jsx)(v.Button,{onClick:o,disabled:j,children:j?"提交中...":g?"保存":"创建"})]})]})})}let M=(0,p.default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function N({customer:a,onUpdate:d}){let e=(0,y.useToast)(),[f,g]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),k=B[a.stage],l=async b=>{if(b===a.stage)return void g(!1);j(!0);let c=await J(a.id,b);c.success?(e.success("更新成功",`已将 ${a.name} 更新为"${B[b].label}"`),d(c.data)):e.error("更新失败",c.error.message),j(!1),g(!1)};return(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("button",{onClick:()=>g(!f),disabled:i,className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md transition-colors ${k.color} ${i?"opacity-50 cursor-wait":"hover:opacity-80 cursor-pointer"}`,children:[i?"更新中...":k.label,(0,b.jsx)(h.ChevronDown,{size:12})]}),f&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>g(!1)}),(0,b.jsx)("div",{className:"absolute left-0 top-full mt-1 z-20 bg-white border border-slate-200 rounded-lg shadow-lg py-1 min-w-[120px]",children:Object.entries(B).map(([c,d])=>(0,b.jsxs)("button",{onClick:()=>l(c),className:`w-full flex items-center justify-between gap-2 px-3 py-2 text-sm hover:bg-slate-50 ${c===a.stage?"text-brand-600 font-medium":"text-slate-700"}`,children:[(0,b.jsx)("span",{className:`inline-block w-2 h-2 rounded-full ${d.color.split(" ")[0]}`}),(0,b.jsx)("span",{className:"flex-1 text-left",children:d.label}),c===a.stage&&(0,b.jsx)(M,{size:14,className:"text-brand-600"})]},c))})]})]})}function O(){let a=(0,y.useToast)(),[p,z]=(0,c.useState)([]),[A,D]=(0,c.useState)(0),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)(new Set),[J,M]=(0,c.useState)(""),[O,P]=(0,c.useState)("my"),[Q,R]=(0,c.useState)("all"),[S,T]=(0,c.useState)(1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(null),Y=async()=>{G(!0);let b=await E({search:J||void 0,stage:Q,page:S,pageSize:20});b.success?(z(b.data.data),D(b.data.total)):a.error("加载客户列表失败",b.error.message),G(!1)};(0,c.useEffect)(()=>{Y()},[J,Q,S]);let[Z,$]=(0,c.useState)("");(0,c.useEffect)(()=>{let a=setTimeout(()=>{M(Z),T(1)},300);return()=>clearTimeout(a)},[Z]);let _=Math.ceil(A/20),aa=async b=>{if(!confirm(`确定要将 ${b.name} 标记为已流失吗？`))return;let c=await K(b.id);c.success?(a.success("操作成功",`${b.name} 已标记为已流失`),Y()):a.error("操作失败",c.error.message)},ab=a=>{z(b=>b.map(b=>b.id===a.id?a:b))};return(0,b.jsxs)("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden bg-slate-50/50",children:[U&&(0,b.jsx)(L,{customer:W,onSuccess:a=>{V(!1),X(null),Y()},onCancel:()=>{V(!1),X(null)}}),(0,b.jsxs)("div",{className:"px-6 py-5 bg-white border-b border-slate-200 shadow-sm flex-shrink-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"客户列表"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"管理您的客户资源，跟踪销售进度"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)(v.Button,{variant:"outline",children:[(0,b.jsx)(g.Download,{size:16,className:"mr-2"}),"导出"]}),(0,b.jsxs)(v.Button,{onClick:()=>{X(null),V(!0)},children:[(0,b.jsx)(n.Plus,{size:16,className:"mr-2"}),"新建客户"]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"flex items-center gap-1 bg-slate-100 p-1 rounded-lg",children:[{key:"all",label:"全部客户"},{key:"my",label:"我的客户"},{key:"team",label:"团队公海"}].map(a=>(0,b.jsx)("button",{onClick:()=>P(a.key),className:`px-4 py-1.5 text-xs font-semibold rounded-md transition-all ${O===a.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"}`,children:a.label},a.key))}),(0,b.jsxs)("div",{className:"relative w-80",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{type:"text",value:Z,onChange:a=>$(a.target.value),placeholder:"搜索姓名、手机号...",className:"w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("select",{value:Q,onChange:a=>{R(a.target.value),T(1)},className:"px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,b.jsx)("option",{value:"all",children:"全部阶段"}),(0,b.jsx)("option",{value:"new",children:"新咨询"}),(0,b.jsx)("option",{value:"following",children:"跟进中"}),(0,b.jsx)("option",{value:"proposal",children:"方案制定"}),(0,b.jsx)("option",{value:"signed",children:"已签约"}),(0,b.jsx)("option",{value:"lost",children:"已流失"})]}),(0,b.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,b.jsx)("span",{className:"font-medium",children:"负责人"}),(0,b.jsx)(h.ChevronDown,{size:14,className:"text-slate-400"})]}),(0,b.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,b.jsx)("span",{className:"font-medium",children:"风险等级"}),(0,b.jsx)(h.ChevronDown,{size:14,className:"text-slate-400"})]}),(0,b.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,b.jsx)(f.Filter,{size:14}),(0,b.jsx)("span",{className:"font-medium",children:"更多筛选"})]}),(J||"all"!==Q)&&(0,b.jsx)("button",{onClick:()=>{M(""),R("all")},className:"text-sm text-brand-600 hover:text-brand-700 font-medium",children:"重置筛选"})]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,b.jsx)(u.Card,{className:"overflow-hidden border-0 shadow-sm ring-1 ring-slate-200",children:F?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-500 border-t-transparent rounded-full"})}):p.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,b.jsx)("thead",{className:"bg-slate-50 border-b border-slate-200 text-slate-500 font-semibold",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-6 py-4 w-14",children:(0,b.jsx)("input",{type:"checkbox",checked:H.size===p.length&&p.length>0,onChange:()=>{H.size===p.length?I(new Set):I(new Set(p.map(a=>a.id)))},className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"})}),(0,b.jsx)("th",{className:"px-4 py-4",children:"客户信息"}),(0,b.jsx)("th",{className:"px-4 py-4",children:"阶段"}),(0,b.jsx)("th",{className:"px-4 py-4",children:"负责人"}),(0,b.jsx)("th",{className:"px-4 py-4",children:"最近跟进"}),(0,b.jsx)("th",{className:"px-4 py-4",children:"风险"}),(0,b.jsx)("th",{className:"px-4 py-4 text-right",children:"操作"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:p.map(a=>{B[a.stage];let c=C[a.riskLevel];return(0,b.jsxs)("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[(0,b.jsx)("td",{className:"px-6 py-4",children:(0,b.jsx)("input",{type:"checkbox",checked:H.has(a.id),onChange:()=>{var b;let c;return b=a.id,void((c=new Set(H)).has(b)?c.delete(b):c.add(b),I(c))},className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"})}),(0,b.jsxs)("td",{className:"px-4 py-4",children:[(0,b.jsxs)(d.default,{href:`/sales/customers/${a.id}`,className:"flex items-center gap-3 group",children:[(0,b.jsx)(w.Avatar,{className:"h-10 w-10",children:(0,b.jsx)(w.AvatarFallback,{className:"bg-brand-100 text-brand-700 text-xs",children:a.name.slice(0,2)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-900 group-hover:text-brand-600 transition-colors",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-0.5",children:[(0,b.jsx)(i.Phone,{size:10}),a.phone]})]})]}),a.tags.length>0&&(0,b.jsx)("div",{className:"flex gap-1 mt-2",children:a.tags.slice(0,3).map(a=>(0,b.jsx)("span",{className:"text-[10px] bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded",children:a},a))})]}),(0,b.jsx)("td",{className:"px-4 py-4",children:(0,b.jsx)(N,{customer:a,onUpdate:ab})}),(0,b.jsx)("td",{className:"px-4 py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Avatar,{className:"h-6 w-6",children:(0,b.jsx)(w.AvatarFallback,{className:"text-[10px] bg-slate-200",children:a.owner.slice(0,1)})}),(0,b.jsx)("span",{className:"text-slate-700",children:a.owner})]})}),(0,b.jsxs)("td",{className:"px-4 py-4",children:[(0,b.jsx)("div",{className:"text-slate-900",children:a.lastContact}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 mt-0.5 flex items-center gap-1",children:[(0,b.jsx)(j.Calendar,{size:10}),a.nextAction]})]}),(0,b.jsx)("td",{className:"px-4 py-4",children:(0,b.jsxs)("div",{className:`flex items-center gap-1.5 ${c.color}`,children:[(a=>{switch(a){case"high":return(0,b.jsx)(k.AlertCircle,{size:14,className:"text-red-500"});case"medium":return(0,b.jsx)(l.AlertTriangle,{size:14,className:"text-amber-500"});default:return(0,b.jsx)(m.CheckCircle2,{size:14,className:"text-emerald-500"})}})(a.riskLevel),(0,b.jsx)("span",{className:"text-xs font-medium",children:c.label})]})}),(0,b.jsx)("td",{className:"px-4 py-4 text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,b.jsx)("button",{onClick:()=>{X(a),V(!0)},className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded",title:"编辑",children:(0,b.jsx)(s,{size:14})}),(0,b.jsx)(d.default,{href:`/sales/customers/${a.id}`,children:(0,b.jsx)(v.Button,{variant:"ghost",size:"sm",children:"查看"})}),"lost"!==a.stage&&(0,b.jsx)("button",{onClick:()=>aa(a),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded",title:"标记流失",children:(0,b.jsx)(t,{size:14})})]})})]},a.id)})})]}),(0,b.jsxs)("div",{className:"px-6 py-4 border-t border-slate-200 flex items-center justify-between bg-slate-50/50",children:[(0,b.jsxs)("div",{className:"text-sm text-slate-500",children:["共 ",(0,b.jsx)("span",{className:"font-medium text-slate-900",children:A})," 条记录",H.size>0&&(0,b.jsxs)("span",{className:"ml-2",children:["（已选择 ",(0,b.jsx)("span",{className:"font-medium text-brand-600",children:H.size})," 条）"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>T(a=>Math.max(1,a-1)),disabled:1===S,className:"p-2 border border-slate-200 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsx)(q,{size:16})}),Array.from({length:Math.min(5,_)},(a,c)=>{let d;return d=_<=5||S<=3?c+1:S>=_-2?_-4+c:S-2+c,(0,b.jsx)("button",{onClick:()=>T(d),className:`px-3 py-1.5 text-sm font-medium rounded-lg ${S===d?"bg-brand-600 text-white":"text-slate-600 hover:bg-slate-100"}`,children:d},d)}),(0,b.jsx)("button",{onClick:()=>T(a=>Math.min(_,a+1)),disabled:S===_||0===_,className:"p-2 border border-slate-200 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:(0,b.jsx)(r.ChevronRight,{size:16})})]})]})]}):(0,b.jsx)(x.EmptyState,{variant:"search",title:"暂无客户数据",description:J?"没有找到匹配的客户，尝试调整搜索条件":'点击右上角"新建客户"添加第一个客户',icon:o.Users})})})]})}a.s(["default",()=>O],38515)}];

//# sourceMappingURL=app_%28protected%29_sales_customers_page_tsx_3c852094._.js.map