{"version":3,"sources":["../../../../app/%28protected%29/sales/customers/page.tsx","../../../../lib/services/customer.service.ts","../../../../components/customers/CustomerForm.tsx","../../../../components/customers/StageDropdown.tsx","../../../../node_modules/lucide-react/src/icons/check.ts","../../../../node_modules/lucide-react/src/icons/trash-2.ts","../../../../node_modules/lucide-react/src/icons/square-pen.ts","../../../../node_modules/lucide-react/src/icons/chevron-left.ts"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport Link from 'next/link'\nimport {\n  Search,\n  Filter,\n  Download,\n  ChevronDown,\n  Phone,\n  Calendar,\n  AlertCircle,\n  AlertTriangle,\n  CheckCircle2,\n  MoreHorizontal,\n  Plus,\n  Users,\n  ChevronLeft,\n  ChevronRight,\n  Edit,\n  Trash2,\n} from 'lucide-react'\nimport { Card } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar'\nimport { EmptyState } from '@/components/shared/EmptyState'\nimport { useToast } from '@/components/shared/Toast'\nimport { CustomerForm, StageDropdown } from '@/components/customers'\nimport {\n  getCustomers,\n  customerStageConfig,\n  riskLevelConfig,\n  archiveCustomer,\n  type CustomerFilters,\n} from '@/lib/services/customer.service'\nimport type { SalesCustomer, SalesStage, RiskLevel } from '@/types/entities'\n\n/**\n * 销售工作台 - 客户列表页\n * \n * 对齐 v8.0 PRD + AI Studio 设计母版：\n * - 表格列表展示\n * - 多维度筛选（阶段、负责人、风险等级）\n * - 批量操作\n * - 新建/编辑/阶段更新\n * \n * 数据源：Supabase customers 表\n */\nexport default function CustomersPage() {\n  const toast = useToast()\n  \n  // 数据状态\n  const [customers, setCustomers] = useState<SalesCustomer[]>([])\n  const [total, setTotal] = useState(0)\n  const [isLoading, setIsLoading] = useState(true)\n  \n  // UI 状态\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n  const [searchQuery, setSearchQuery] = useState('')\n  const [activeTab, setActiveTab] = useState<'all' | 'my' | 'team'>('my')\n  const [stageFilter, setStageFilter] = useState<SalesStage | 'all'>('all')\n  const [page, setPage] = useState(1)\n  const pageSize = 20\n\n  // 表单状态\n  const [showForm, setShowForm] = useState(false)\n  const [editingCustomer, setEditingCustomer] = useState<SalesCustomer | null>(null)\n\n  // 加载客户数据\n  const loadCustomers = async () => {\n    setIsLoading(true)\n    \n    const filters: CustomerFilters = {\n      search: searchQuery || undefined,\n      stage: stageFilter,\n      page,\n      pageSize,\n    }\n    \n    const result = await getCustomers(filters)\n    \n    if (result.success) {\n      setCustomers(result.data.data)\n      setTotal(result.data.total)\n    } else {\n      toast.error('加载客户列表失败', result.error.message)\n    }\n    \n    setIsLoading(false)\n  }\n\n  useEffect(() => {\n    loadCustomers()\n  }, [searchQuery, stageFilter, page])\n\n  // 搜索防抖\n  const [searchInput, setSearchInput] = useState('')\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setSearchQuery(searchInput)\n      setPage(1) // 搜索时重置页码\n    }, 300)\n    return () => clearTimeout(timer)\n  }, [searchInput])\n\n  // 选择操作\n  const toggleSelection = (id: string) => {\n    const newSet = new Set(selectedIds)\n    if (newSet.has(id)) {\n      newSet.delete(id)\n    } else {\n      newSet.add(id)\n    }\n    setSelectedIds(newSet)\n  }\n\n  const toggleAll = () => {\n    if (selectedIds.size === customers.length) {\n      setSelectedIds(new Set())\n    } else {\n      setSelectedIds(new Set(customers.map(c => c.id)))\n    }\n  }\n\n  // 风险图标\n  const getRiskIcon = (risk: RiskLevel) => {\n    switch (risk) {\n      case 'high':\n        return <AlertCircle size={14} className=\"text-red-500\" />\n      case 'medium':\n        return <AlertTriangle size={14} className=\"text-amber-500\" />\n      default:\n        return <CheckCircle2 size={14} className=\"text-emerald-500\" />\n    }\n  }\n\n  // 计算分页\n  const totalPages = Math.ceil(total / pageSize)\n\n  // 新建客户\n  const handleCreate = () => {\n    setEditingCustomer(null)\n    setShowForm(true)\n  }\n\n  // 编辑客户\n  const handleEdit = (customer: SalesCustomer) => {\n    setEditingCustomer(customer)\n    setShowForm(true)\n  }\n\n  // 表单成功回调\n  const handleFormSuccess = (customer: SalesCustomer) => {\n    setShowForm(false)\n    setEditingCustomer(null)\n    loadCustomers() // 重新加载数据\n  }\n\n  // 删除客户（归档）\n  const handleArchive = async (customer: SalesCustomer) => {\n    if (!confirm(`确定要将 ${customer.name} 标记为已流失吗？`)) return\n\n    const result = await archiveCustomer(customer.id)\n    if (result.success) {\n      toast.success('操作成功', `${customer.name} 已标记为已流失`)\n      loadCustomers()\n    } else {\n      toast.error('操作失败', result.error.message)\n    }\n  }\n\n  // 阶段更新回调\n  const handleStageUpdate = (updatedCustomer: SalesCustomer) => {\n    setCustomers(prev =>\n      prev.map(c => c.id === updatedCustomer.id ? updatedCustomer : c)\n    )\n  }\n\n  return (\n    <div className=\"flex flex-col h-[calc(100vh-64px)] overflow-hidden bg-slate-50/50\">\n      {/* 表单弹窗 */}\n      {showForm && (\n        <CustomerForm\n          customer={editingCustomer}\n          onSuccess={handleFormSuccess}\n          onCancel={() => {\n            setShowForm(false)\n            setEditingCustomer(null)\n          }}\n        />\n      )}\n\n      {/* ========== 头部区域 ========== */}\n      <div className=\"px-6 py-5 bg-white border-b border-slate-200 shadow-sm flex-shrink-0\">\n        <div className=\"flex justify-between items-center mb-5\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-slate-900 tracking-tight\">客户列表</h1>\n            <p className=\"text-sm text-slate-500 mt-1\">管理您的客户资源，跟踪销售进度</p>\n          </div>\n          <div className=\"flex gap-3\">\n            <Button variant=\"outline\">\n              <Download size={16} className=\"mr-2\" />\n              导出\n            </Button>\n            <Button onClick={handleCreate}>\n              <Plus size={16} className=\"mr-2\" />\n              新建客户\n            </Button>\n          </div>\n        </div>\n\n        {/* 筛选区域 */}\n        <div className=\"flex flex-col gap-4\">\n          {/* Tab 切换 */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-1 bg-slate-100 p-1 rounded-lg\">\n              {[\n                { key: 'all', label: '全部客户' },\n                { key: 'my', label: '我的客户' },\n                { key: 'team', label: '团队公海' },\n              ].map(tab => (\n                <button\n                  key={tab.key}\n                  onClick={() => setActiveTab(tab.key as typeof activeTab)}\n                  className={`px-4 py-1.5 text-xs font-semibold rounded-md transition-all ${\n                    activeTab === tab.key\n                      ? 'bg-white text-slate-900 shadow-sm'\n                      : 'text-slate-500 hover:text-slate-900'\n                  }`}\n                >\n                  {tab.label}\n                </button>\n              ))}\n            </div>\n\n            {/* 搜索框 */}\n            <div className=\"relative w-80\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n              <input\n                type=\"text\"\n                value={searchInput}\n                onChange={(e) => setSearchInput(e.target.value)}\n                placeholder=\"搜索姓名、手机号...\"\n                className=\"w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n              />\n            </div>\n          </div>\n\n          {/* 筛选条件 */}\n          <div className=\"flex items-center gap-3\">\n            <select\n              value={stageFilter}\n              onChange={(e) => {\n                setStageFilter(e.target.value as SalesStage | 'all')\n                setPage(1) // 筛选时重置页码\n              }}\n              className=\"px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-brand-500\"\n            >\n              <option value=\"all\">全部阶段</option>\n              <option value=\"new\">新咨询</option>\n              <option value=\"following\">跟进中</option>\n              <option value=\"proposal\">方案制定</option>\n              <option value=\"signed\">已签约</option>\n              <option value=\"lost\">已流失</option>\n            </select>\n\n            <button className=\"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300\">\n              <span className=\"font-medium\">负责人</span>\n              <ChevronDown size={14} className=\"text-slate-400\" />\n            </button>\n\n            <button className=\"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300\">\n              <span className=\"font-medium\">风险等级</span>\n              <ChevronDown size={14} className=\"text-slate-400\" />\n            </button>\n\n            <button className=\"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300\">\n              <Filter size={14} />\n              <span className=\"font-medium\">更多筛选</span>\n            </button>\n\n            {(searchQuery || stageFilter !== 'all') && (\n              <button\n                onClick={() => {\n                  setSearchQuery('')\n                  setStageFilter('all')\n                }}\n                className=\"text-sm text-brand-600 hover:text-brand-700 font-medium\"\n              >\n                重置筛选\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* ========== 表格区域 ========== */}\n      <div className=\"flex-1 overflow-auto p-6\">\n        <Card className=\"overflow-hidden border-0 shadow-sm ring-1 ring-slate-200\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center h-64\">\n              <div className=\"animate-spin w-8 h-8 border-2 border-brand-500 border-t-transparent rounded-full\" />\n            </div>\n          ) : customers.length > 0 ? (\n            <>\n              <table className=\"w-full text-left text-sm\">\n                <thead className=\"bg-slate-50 border-b border-slate-200 text-slate-500 font-semibold\">\n                  <tr>\n                    <th className=\"px-6 py-4 w-14\">\n                      <input\n                        type=\"checkbox\"\n                        checked={selectedIds.size === customers.length && customers.length > 0}\n                        onChange={toggleAll}\n                        className=\"rounded border-slate-300 text-brand-600 focus:ring-brand-500\"\n                      />\n                    </th>\n                    <th className=\"px-4 py-4\">客户信息</th>\n                    <th className=\"px-4 py-4\">阶段</th>\n                    <th className=\"px-4 py-4\">负责人</th>\n                    <th className=\"px-4 py-4\">最近跟进</th>\n                    <th className=\"px-4 py-4\">风险</th>\n                    <th className=\"px-4 py-4 text-right\">操作</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100 bg-white\">\n                  {customers.map((customer) => {\n                    const stageConfig = customerStageConfig[customer.stage]\n                    const riskConfig = riskLevelConfig[customer.riskLevel]\n                    \n                    return (\n                      <tr key={customer.id} className=\"hover:bg-slate-50/50 transition-colors\">\n                        <td className=\"px-6 py-4\">\n                          <input\n                            type=\"checkbox\"\n                            checked={selectedIds.has(customer.id)}\n                            onChange={() => toggleSelection(customer.id)}\n                            className=\"rounded border-slate-300 text-brand-600 focus:ring-brand-500\"\n                          />\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <Link href={`/sales/customers/${customer.id}`} className=\"flex items-center gap-3 group\">\n                            <Avatar className=\"h-10 w-10\">\n                              <AvatarFallback className=\"bg-brand-100 text-brand-700 text-xs\">\n                                {customer.name.slice(0, 2)}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <div className=\"font-semibold text-slate-900 group-hover:text-brand-600 transition-colors\">\n                                {customer.name}\n                              </div>\n                              <div className=\"text-xs text-slate-500 flex items-center gap-2 mt-0.5\">\n                                <Phone size={10} />\n                                {customer.phone}\n                              </div>\n                            </div>\n                          </Link>\n                          {customer.tags.length > 0 && (\n                            <div className=\"flex gap-1 mt-2\">\n                              {customer.tags.slice(0, 3).map(tag => (\n                                <span key={tag} className=\"text-[10px] bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded\">\n                                  {tag}\n                                </span>\n                              ))}\n                            </div>\n                          )}\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <StageDropdown customer={customer} onUpdate={handleStageUpdate} />\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-6 w-6\">\n                              <AvatarFallback className=\"text-[10px] bg-slate-200\">\n                                {customer.owner.slice(0, 1)}\n                              </AvatarFallback>\n                            </Avatar>\n                            <span className=\"text-slate-700\">{customer.owner}</span>\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div className=\"text-slate-900\">{customer.lastContact}</div>\n                          <div className=\"text-xs text-slate-500 mt-0.5 flex items-center gap-1\">\n                            <Calendar size={10} />\n                            {customer.nextAction}\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-4\">\n                          <div className={`flex items-center gap-1.5 ${riskConfig.color}`}>\n                            {getRiskIcon(customer.riskLevel)}\n                            <span className=\"text-xs font-medium\">{riskConfig.label}</span>\n                          </div>\n                        </td>\n                        <td className=\"px-4 py-4 text-right\">\n                          <div className=\"flex items-center justify-end gap-1\">\n                            <button\n                              onClick={() => handleEdit(customer)}\n                              className=\"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded\"\n                              title=\"编辑\"\n                            >\n                              <Edit size={14} />\n                            </button>\n                            <Link href={`/sales/customers/${customer.id}`}>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                查看\n                              </Button>\n                            </Link>\n                            {customer.stage !== 'lost' && (\n                              <button\n                                onClick={() => handleArchive(customer)}\n                                className=\"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded\"\n                                title=\"标记流失\"\n                              >\n                                <Trash2 size={14} />\n                              </button>\n                            )}\n                          </div>\n                        </td>\n                      </tr>\n                    )\n                  })}\n                </tbody>\n              </table>\n\n              {/* 分页器 */}\n              <div className=\"px-6 py-4 border-t border-slate-200 flex items-center justify-between bg-slate-50/50\">\n                <div className=\"text-sm text-slate-500\">\n                  共 <span className=\"font-medium text-slate-900\">{total}</span> 条记录\n                  {selectedIds.size > 0 && (\n                    <span className=\"ml-2\">\n                      （已选择 <span className=\"font-medium text-brand-600\">{selectedIds.size}</span> 条）\n                    </span>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <button \n                    onClick={() => setPage(p => Math.max(1, p - 1))}\n                    disabled={page === 1}\n                    className=\"p-2 border border-slate-200 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    <ChevronLeft size={16} />\n                  </button>\n                  {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                    let pageNum: number\n                    if (totalPages <= 5) {\n                      pageNum = i + 1\n                    } else if (page <= 3) {\n                      pageNum = i + 1\n                    } else if (page >= totalPages - 2) {\n                      pageNum = totalPages - 4 + i\n                    } else {\n                      pageNum = page - 2 + i\n                    }\n                    return (\n                      <button\n                        key={pageNum}\n                        onClick={() => setPage(pageNum)}\n                        className={`px-3 py-1.5 text-sm font-medium rounded-lg ${\n                          page === pageNum\n                            ? 'bg-brand-600 text-white'\n                            : 'text-slate-600 hover:bg-slate-100'\n                        }`}\n                      >\n                        {pageNum}\n                      </button>\n                    )\n                  })}\n                  <button \n                    onClick={() => setPage(p => Math.min(totalPages, p + 1))}\n                    disabled={page === totalPages || totalPages === 0}\n                    className=\"p-2 border border-slate-200 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    <ChevronRight size={16} />\n                  </button>\n                </div>\n              </div>\n            </>\n          ) : (\n            <EmptyState\n              variant=\"search\"\n              title=\"暂无客户数据\"\n              description={searchQuery ? '没有找到匹配的客户，尝试调整搜索条件' : '点击右上角\"新建客户\"添加第一个客户'}\n              icon={Users}\n            />\n          )}\n        </Card>\n      </div>\n    </div>\n  )\n}\n","/**\n * 销售客户数据服务层\n * \n * 负责获取客户数据\n * 优先从 Supabase 获取，失败时回退到 Mock 数据\n */\n\nimport { createClient } from '@/lib/supabase/client'\nimport { createServiceError, success, failure, type ServiceResult } from '@/components/shared/Toast'\nimport type {\n  SalesCustomer,\n  SalesStage,\n  RiskLevel,\n  TimelineEvent,\n  KPIMetric,\n  StageConfig,\n  RiskConfig,\n  Customer,\n} from '@/types/entities'\n\n// ============================================\n// 配置常量\n// ============================================\n\nexport const customerStageConfig: Record<SalesStage, StageConfig> = {\n  new: { label: '新咨询', color: 'bg-blue-100 text-blue-700' },\n  following: { label: '跟进中', color: 'bg-purple-100 text-purple-700' },\n  proposal: { label: '方案制定', color: 'bg-amber-100 text-amber-700' },\n  signed: { label: '已签约', color: 'bg-emerald-100 text-emerald-700' },\n  lost: { label: '已流失', color: 'bg-slate-100 text-slate-500' },\n}\n\nexport const riskLevelConfig: Record<RiskLevel, RiskConfig> = {\n  low: { label: '正常', color: 'text-emerald-600', bgColor: 'bg-emerald-50' },\n  medium: { label: '需关注', color: 'text-amber-600', bgColor: 'bg-amber-50' },\n  high: { label: '高风险', color: 'text-red-600', bgColor: 'bg-red-50' },\n}\n\n// ============================================\n// Mock 数据（Supabase 查询失败时的 fallback）\n// ============================================\n\nconst mockCustomers: SalesCustomer[] = [\n  {\n    id: 'cust-001',\n    name: 'Emily Zhang',\n    phone: '+86 138****0001',\n    email: 'emily.z@example.com',\n    wechat: 'emily_dream_big',\n    tags: ['VIP', '高二', '美本'],\n    stage: 'signed',\n    riskLevel: 'low',\n    owner: 'Sarah Wu',\n    ownerId: 'user-002',\n    source: '小红书',\n    lastContact: '2小时前',\n    nextAction: '文书审核',\n    nextActionDate: '2024-11-01',\n    createdAt: '2024-09-15',\n    updatedAt: '2024-10-24',\n    studentName: 'Emily Zhang',\n    grade: '高二',\n    targetCountry: '美国',\n    budget: '50万+',\n  },\n  // 更多 mock 数据...\n]\n\nconst mockTimeline: Record<string, TimelineEvent[]> = {\n  'cust-001': [\n    {\n      id: 'evt-001',\n      type: 'call',\n      title: '咨询电话',\n      description: '讨论ED申请策略，客户对文书有些焦虑',\n      created_by: 'Sarah Wu',\n      created_at: '2024-10-24 10:30',\n    },\n  ],\n}\n\n// ============================================\n// 筛选条件类型\n// ============================================\n\nexport interface CustomerFilters {\n  search?: string\n  stage?: SalesStage | 'all'\n  owner?: string\n  riskLevel?: RiskLevel | 'all'\n  page?: number\n  pageSize?: number\n}\n\n// ============================================\n// 服务函数\n// ============================================\n\n/**\n * 获取客户列表\n * \n * 优先从 Supabase 获取，失败时回退到 Mock\n */\nexport async function getCustomers(filters?: CustomerFilters): Promise<ServiceResult<{ data: SalesCustomer[]; total: number }>> {\n  const supabase = createClient()\n  const { search, stage, owner, riskLevel, page = 1, pageSize = 20 } = filters || {}\n\n  try {\n    let query = supabase\n      .from('customers')\n      .select('*', { count: 'exact' })\n\n    // 应用搜索\n    if (search) {\n      query = query.or(`name.ilike.%${search}%,phone.ilike.%${search}%`)\n    }\n\n    // 应用阶段筛选\n    if (stage && stage !== 'all') {\n      query = query.eq('stage', stage)\n    }\n\n    // 应用负责人筛选\n    if (owner) {\n      query = query.eq('assigned_to', owner)\n    }\n\n    // 应用风险等级筛选\n    if (riskLevel && riskLevel !== 'all') {\n      query = query.eq('risk_level', riskLevel)\n    }\n\n    // 分页\n    const from = (page - 1) * pageSize\n    const to = from + pageSize - 1\n    query = query.range(from, to).order('updated_at', { ascending: false })\n\n    const { data, error, count } = await query\n\n    if (error) {\n      console.warn('Supabase query failed, using mock data:', error.message)\n      // 回退到 Mock 数据\n      return success({ data: mockCustomers, total: mockCustomers.length })\n    }\n\n    // 转换为 SalesCustomer 格式\n    const customers: SalesCustomer[] = (data || []).map(transformCustomer)\n\n    return success({ data: customers, total: count || 0 })\n  } catch (error) {\n    console.error('getCustomers error:', error)\n    // 回退到 Mock 数据\n    return success({ data: mockCustomers, total: mockCustomers.length })\n  }\n}\n\n/**\n * 根据 ID 获取客户详情\n */\nexport async function getCustomerById(id: string): Promise<ServiceResult<SalesCustomer>> {\n  const supabase = createClient()\n\n  try {\n    const { data, error } = await supabase\n      .from('customers')\n      .select('*')\n      .eq('id', id)\n      .single()\n\n    if (error) {\n      console.warn('Supabase query failed, using mock data:', error.message)\n      const mockCustomer = mockCustomers.find(c => c.id === id)\n      if (mockCustomer) {\n        return success(mockCustomer)\n      }\n      return failure({ code: 'NOT_FOUND', message: '客户不存在' })\n    }\n\n    return success(transformCustomer(data))\n  } catch (error) {\n    console.error('getCustomerById error:', error)\n    const mockCustomer = mockCustomers.find(c => c.id === id)\n    if (mockCustomer) {\n      return success(mockCustomer)\n    }\n    return failure(createServiceError(error, '获取客户详情失败'))\n  }\n}\n\n/**\n * 获取客户时间轴\n */\nexport async function getCustomerTimeline(customerId: string): Promise<ServiceResult<TimelineEvent[]>> {\n  // TODO: 从 Supabase 获取客户时间轴\n  // 目前使用 Mock 数据\n  return success(mockTimeline[customerId] || [])\n}\n\n/**\n * 获取阶段统计\n */\nexport async function getStageStats(): Promise<ServiceResult<Record<SalesStage, number>>> {\n  const supabase = createClient()\n\n  try {\n    const stages: SalesStage[] = ['new', 'following', 'proposal', 'signed', 'lost']\n    const stats: Record<SalesStage, number> = {} as Record<SalesStage, number>\n\n    for (const stage of stages) {\n      const { count, error } = await supabase\n        .from('customers')\n        .select('*', { count: 'exact', head: true })\n        .eq('stage', stage)\n\n      if (error) {\n        console.warn(`Failed to get count for stage ${stage}:`, error.message)\n        stats[stage] = 0\n      } else {\n        stats[stage] = count || 0\n      }\n    }\n\n    return success(stats)\n  } catch (error) {\n    console.error('getStageStats error:', error)\n    // 返回默认值\n    return success({\n      new: 0,\n      following: 0,\n      proposal: 0,\n      signed: 0,\n      lost: 0,\n    })\n  }\n}\n\n/**\n * 获取销售 KPI\n */\nexport async function getSalesKPIs(): Promise<ServiceResult<KPIMetric[]>> {\n  const statsResult = await getStageStats()\n  \n  if (!statsResult.success) {\n    return failure(statsResult.error)\n  }\n\n  const stats = statsResult.data\n  \n  return success([\n    { label: '本月新增客户', value: 28, change: 12, trend: 'up', icon: 'Users' },\n    { label: '跟进中客户', value: stats.following + stats.proposal, change: 5, trend: 'up', icon: 'TrendingUp' },\n    { label: '本月签约', value: stats.signed, change: 2, trend: 'up', icon: 'FileText' },\n    { label: '本月业绩', value: '¥128万', change: 18, trend: 'up', icon: 'DollarSign' },\n  ])\n}\n\n// ============================================\n// 辅助函数\n// ============================================\n\n/**\n * 转换数据库记录为 SalesCustomer\n */\nfunction transformCustomer(data: Customer): SalesCustomer {\n  return {\n    id: data.id,\n    name: data.name,\n    phone: data.phone || '',\n    email: data.email || undefined,\n    wechat: data.wechat || undefined,\n    tags: data.tags || [],\n    stage: data.stage as SalesStage,\n    riskLevel: (data.risk_level as RiskLevel) || 'low',\n    owner: data.assigned_to || '未分配',\n    ownerId: data.assigned_to || '',\n    source: data.source || '',\n    lastContact: formatRelativeTime(data.updated_at),\n    nextAction: data.next_action || '',\n    nextActionDate: data.next_action_date || undefined,\n    createdAt: formatDate(data.created_at),\n    updatedAt: formatDate(data.updated_at),\n    studentName: data.student_name || undefined,\n    grade: data.grade || undefined,\n    targetCountry: data.target_country || undefined,\n    budget: data.budget || undefined,\n    notes: data.notes || undefined,\n  }\n}\n\n/**\n * 格式化日期\n */\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr)\n  return date.toLocaleDateString('zh-CN')\n}\n\n/**\n * 格式化相对时间\n */\nfunction formatRelativeTime(dateStr: string): string {\n  const date = new Date(dateStr)\n  const now = new Date()\n  const diff = now.getTime() - date.getTime()\n  \n  const minutes = Math.floor(diff / 60000)\n  const hours = Math.floor(diff / 3600000)\n  const days = Math.floor(diff / 86400000)\n\n  if (minutes < 60) return `${minutes}分钟前`\n  if (hours < 24) return `${hours}小时前`\n  if (days < 7) return `${days}天前`\n  return formatDate(dateStr)\n}\n\n// ============================================\n// 写入函数\n// ============================================\n\n/**\n * 创建客户输入类型\n */\nexport interface CreateCustomerInput {\n  name: string\n  phone?: string\n  email?: string\n  wechat?: string\n  source?: string\n  stage?: SalesStage\n  tags?: string[]\n  notes?: string\n  studentName?: string\n  grade?: string\n  targetCountry?: string\n  budget?: string\n  assignedTo?: string\n}\n\n/**\n * 更新客户输入类型\n */\nexport interface UpdateCustomerInput {\n  name?: string\n  phone?: string\n  email?: string\n  wechat?: string\n  source?: string\n  stage?: SalesStage\n  riskLevel?: RiskLevel\n  tags?: string[]\n  notes?: string\n  nextAction?: string\n  nextActionDate?: string\n  studentName?: string\n  grade?: string\n  targetCountry?: string\n  budget?: string\n  assignedTo?: string\n}\n\n/**\n * 创建新客户\n */\nexport async function createCustomer(input: CreateCustomerInput): Promise<ServiceResult<SalesCustomer>> {\n  const supabase = createClient()\n\n  try {\n    const insertData = {\n      name: input.name,\n      phone: input.phone || null,\n      email: input.email || null,\n      wechat: input.wechat || null,\n      source: input.source || null,\n      stage: input.stage || 'new',\n      tags: input.tags || null,\n      notes: input.notes || null,\n      student_name: input.studentName || null,\n      grade: input.grade || null,\n      target_country: input.targetCountry || null,\n      budget: input.budget || null,\n      assigned_to: input.assignedTo || null,\n      risk_level: 'low',\n    }\n\n    const { data, error } = await supabase\n      .from('customers')\n      .insert(insertData as never)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Create customer error:', error)\n      \n      if (error.code === '42501' || error.message.includes('permission denied')) {\n        return failure({\n          code: 'PERMISSION_DENIED',\n          message: '没有创建客户的权限，请联系管理员',\n        })\n      }\n\n      if (error.code === '23505') {\n        return failure({\n          code: 'DUPLICATE',\n          message: '该客户已存在（手机号或邮箱重复）',\n        })\n      }\n\n      return failure(createServiceError(error, '创建客户失败'))\n    }\n\n    return success(transformCustomer(data as Customer))\n  } catch (error) {\n    console.error('createCustomer error:', error)\n    return failure(createServiceError(error, '创建客户失败'))\n  }\n}\n\n/**\n * 更新客户信息\n */\nexport async function updateCustomer(id: string, input: UpdateCustomerInput): Promise<ServiceResult<SalesCustomer>> {\n  const supabase = createClient()\n\n  try {\n    const updateData: Record<string, unknown> = {}\n\n    // 只更新有值的字段\n    if (input.name !== undefined) updateData.name = input.name\n    if (input.phone !== undefined) updateData.phone = input.phone || null\n    if (input.email !== undefined) updateData.email = input.email || null\n    if (input.wechat !== undefined) updateData.wechat = input.wechat || null\n    if (input.source !== undefined) updateData.source = input.source || null\n    if (input.stage !== undefined) updateData.stage = input.stage\n    if (input.riskLevel !== undefined) updateData.risk_level = input.riskLevel\n    if (input.tags !== undefined) updateData.tags = input.tags\n    if (input.notes !== undefined) updateData.notes = input.notes || null\n    if (input.nextAction !== undefined) updateData.next_action = input.nextAction || null\n    if (input.nextActionDate !== undefined) updateData.next_action_date = input.nextActionDate || null\n    if (input.studentName !== undefined) updateData.student_name = input.studentName || null\n    if (input.grade !== undefined) updateData.grade = input.grade || null\n    if (input.targetCountry !== undefined) updateData.target_country = input.targetCountry || null\n    if (input.budget !== undefined) updateData.budget = input.budget || null\n    if (input.assignedTo !== undefined) updateData.assigned_to = input.assignedTo || null\n\n    const { data, error } = await supabase\n      .from('customers')\n      .update(updateData as never)\n      .eq('id', id)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Update customer error:', error)\n\n      if (error.code === '42501' || error.message.includes('permission denied')) {\n        return failure({\n          code: 'PERMISSION_DENIED',\n          message: '没有编辑客户的权限',\n        })\n      }\n\n      if (error.code === 'PGRST116') {\n        return failure({\n          code: 'NOT_FOUND',\n          message: '客户不存在',\n        })\n      }\n\n      return failure(createServiceError(error, '更新客户失败'))\n    }\n\n    return success(transformCustomer(data as Customer))\n  } catch (error) {\n    console.error('updateCustomer error:', error)\n    return failure(createServiceError(error, '更新客户失败'))\n  }\n}\n\n/**\n * 更新客户阶段\n */\nexport async function updateCustomerStage(id: string, stage: SalesStage): Promise<ServiceResult<SalesCustomer>> {\n  return updateCustomer(id, { stage })\n}\n\n/**\n * 更新客户风险等级\n */\nexport async function updateCustomerRiskLevel(id: string, riskLevel: RiskLevel): Promise<ServiceResult<SalesCustomer>> {\n  return updateCustomer(id, { riskLevel })\n}\n\n/**\n * 删除客户（软删除，标记为 lost）\n */\nexport async function archiveCustomer(id: string): Promise<ServiceResult<void>> {\n  const result = await updateCustomer(id, { stage: 'lost' })\n  if (!result.success) return failure(result.error)\n  return success(undefined)\n}\n\n/**\n * 分配客户负责人\n */\nexport async function assignCustomer(id: string, assigneeId: string): Promise<ServiceResult<SalesCustomer>> {\n  return updateCustomer(id, { assignedTo: assigneeId })\n}\n\n/**\n * 批量更新客户阶段\n */\nexport async function batchUpdateStage(ids: string[], stage: SalesStage): Promise<ServiceResult<number>> {\n  const supabase = createClient()\n\n  try {\n    const { error, count } = await supabase\n      .from('customers')\n      .update({ stage } as never)\n      .in('id', ids)\n\n    if (error) {\n      return failure(createServiceError(error, '批量更新失败'))\n    }\n\n    return success(count || 0)\n  } catch (error) {\n    return failure(createServiceError(error, '批量更新失败'))\n  }\n}\n\n/**\n * 添加客户时间轴事件\n */\nexport async function addTimelineEvent(\n  customerId: string,\n  event: Omit<TimelineEvent, 'id' | 'created_at'>\n): Promise<ServiceResult<TimelineEvent>> {\n  // TODO: 需要创建 customer_timeline 表\n  // 目前返回预留接口\n  return failure({\n    code: 'NOT_IMPLEMENTED',\n    message: '时间轴功能需要创建 customer_timeline 表',\n  })\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { X } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { useToast } from '@/components/shared/Toast'\nimport {\n  createCustomer,\n  updateCustomer,\n  customerStageConfig,\n  type CreateCustomerInput,\n  type UpdateCustomerInput,\n} from '@/lib/services/customer.service'\nimport type { SalesCustomer, SalesStage } from '@/types/entities'\n\ninterface CustomerFormProps {\n  customer?: SalesCustomer | null\n  onSuccess: (customer: SalesCustomer) => void\n  onCancel: () => void\n}\n\n/**\n * 客户表单（新建/编辑）\n */\nexport function CustomerForm({ customer, onSuccess, onCancel }: CustomerFormProps) {\n  const toast = useToast()\n  const isEditing = !!customer\n\n  // 表单状态\n  const [formData, setFormData] = useState({\n    name: customer?.name || '',\n    phone: customer?.phone || '',\n    email: customer?.email || '',\n    wechat: customer?.wechat || '',\n    source: customer?.source || '',\n    stage: customer?.stage || 'new' as SalesStage,\n    tags: customer?.tags?.join(', ') || '',\n    notes: customer?.notes || '',\n    studentName: customer?.studentName || '',\n    grade: customer?.grade || '',\n    targetCountry: customer?.targetCountry || '',\n    budget: customer?.budget || '',\n  })\n\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [errors, setErrors] = useState<Record<string, string>>({})\n\n  // 更新字段\n  const updateField = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }))\n    // 清除该字段的错误\n    if (errors[field]) {\n      setErrors(prev => {\n        const newErrors = { ...prev }\n        delete newErrors[field]\n        return newErrors\n      })\n    }\n  }\n\n  // 验证表单\n  const validate = (): boolean => {\n    const newErrors: Record<string, string> = {}\n\n    if (!formData.name.trim()) {\n      newErrors.name = '请输入客户姓名'\n    }\n\n    if (formData.phone && !/^[\\d\\s\\-+()]+$/.test(formData.phone)) {\n      newErrors.phone = '请输入有效的手机号'\n    }\n\n    if (formData.email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      newErrors.email = '请输入有效的邮箱'\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  // 提交表单\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!validate()) return\n\n    setIsSubmitting(true)\n\n    const tags = formData.tags\n      .split(',')\n      .map(t => t.trim())\n      .filter(t => t)\n\n    if (isEditing && customer) {\n      // 更新客户\n      const input: UpdateCustomerInput = {\n        name: formData.name,\n        phone: formData.phone || undefined,\n        email: formData.email || undefined,\n        wechat: formData.wechat || undefined,\n        source: formData.source || undefined,\n        stage: formData.stage,\n        tags: tags.length > 0 ? tags : undefined,\n        notes: formData.notes || undefined,\n        studentName: formData.studentName || undefined,\n        grade: formData.grade || undefined,\n        targetCountry: formData.targetCountry || undefined,\n        budget: formData.budget || undefined,\n      }\n\n      const result = await updateCustomer(customer.id, input)\n\n      if (result.success) {\n        toast.success('更新成功', '客户信息已更新')\n        onSuccess(result.data)\n      } else {\n        toast.error('更新失败', result.error.message)\n      }\n    } else {\n      // 创建客户\n      const input: CreateCustomerInput = {\n        name: formData.name,\n        phone: formData.phone || undefined,\n        email: formData.email || undefined,\n        wechat: formData.wechat || undefined,\n        source: formData.source || undefined,\n        stage: formData.stage,\n        tags: tags.length > 0 ? tags : undefined,\n        notes: formData.notes || undefined,\n        studentName: formData.studentName || undefined,\n        grade: formData.grade || undefined,\n        targetCountry: formData.targetCountry || undefined,\n        budget: formData.budget || undefined,\n      }\n\n      const result = await createCustomer(input)\n\n      if (result.success) {\n        toast.success('创建成功', '新客户已添加')\n        onSuccess(result.data)\n      } else {\n        toast.error('创建失败', result.error.message)\n      }\n    }\n\n    setIsSubmitting(false)\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div className=\"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden\">\n        {/* 头部 */}\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-200\">\n          <h2 className=\"text-lg font-semibold text-slate-900\">\n            {isEditing ? '编辑客户' : '新建客户'}\n          </h2>\n          <button\n            onClick={onCancel}\n            className=\"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100\"\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        {/* 表单 */}\n        <form onSubmit={handleSubmit} className=\"p-6 overflow-y-auto max-h-[calc(90vh-140px)]\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            {/* 基本信息 */}\n            <div className=\"col-span-2\">\n              <h3 className=\"text-sm font-medium text-slate-700 mb-3\">基本信息</h3>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">\n                客户姓名 <span className=\"text-red-500\">*</span>\n              </label>\n              <input\n                type=\"text\"\n                value={formData.name}\n                onChange={(e) => updateField('name', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${\n                  errors.name ? 'border-red-300 bg-red-50' : 'border-slate-200'\n                }`}\n                placeholder=\"输入客户姓名\"\n              />\n              {errors.name && <p className=\"text-xs text-red-500 mt-1\">{errors.name}</p>}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">手机号</label>\n              <input\n                type=\"tel\"\n                value={formData.phone}\n                onChange={(e) => updateField('phone', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${\n                  errors.phone ? 'border-red-300 bg-red-50' : 'border-slate-200'\n                }`}\n                placeholder=\"输入手机号\"\n              />\n              {errors.phone && <p className=\"text-xs text-red-500 mt-1\">{errors.phone}</p>}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">邮箱</label>\n              <input\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => updateField('email', e.target.value)}\n                className={`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${\n                  errors.email ? 'border-red-300 bg-red-50' : 'border-slate-200'\n                }`}\n                placeholder=\"输入邮箱\"\n              />\n              {errors.email && <p className=\"text-xs text-red-500 mt-1\">{errors.email}</p>}\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">微信号</label>\n              <input\n                type=\"text\"\n                value={formData.wechat}\n                onChange={(e) => updateField('wechat', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n                placeholder=\"输入微信号\"\n              />\n            </div>\n\n            {/* 销售信息 */}\n            <div className=\"col-span-2 mt-4\">\n              <h3 className=\"text-sm font-medium text-slate-700 mb-3\">销售信息</h3>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">客户来源</label>\n              <input\n                type=\"text\"\n                value={formData.source}\n                onChange={(e) => updateField('source', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n                placeholder=\"如：小红书、转介绍、官网\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">客户阶段</label>\n              <select\n                value={formData.stage}\n                onChange={(e) => updateField('stage', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n              >\n                {Object.entries(customerStageConfig).map(([key, config]) => (\n                  <option key={key} value={key}>{config.label}</option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"col-span-2\">\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">标签</label>\n              <input\n                type=\"text\"\n                value={formData.tags}\n                onChange={(e) => updateField('tags', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n                placeholder=\"用逗号分隔，如：VIP, 美本, 高意向\"\n              />\n            </div>\n\n            {/* 学员信息 */}\n            <div className=\"col-span-2 mt-4\">\n              <h3 className=\"text-sm font-medium text-slate-700 mb-3\">学员信息</h3>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">学员姓名</label>\n              <input\n                type=\"text\"\n                value={formData.studentName}\n                onChange={(e) => updateField('studentName', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n                placeholder=\"输入学员姓名\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">年级</label>\n              <select\n                value={formData.grade}\n                onChange={(e) => updateField('grade', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n              >\n                <option value=\"\">请选择</option>\n                <option value=\"初一\">初一</option>\n                <option value=\"初二\">初二</option>\n                <option value=\"初三\">初三</option>\n                <option value=\"高一\">高一</option>\n                <option value=\"高二\">高二</option>\n                <option value=\"高三\">高三</option>\n                <option value=\"大一\">大一</option>\n                <option value=\"大二\">大二</option>\n                <option value=\"大三\">大三</option>\n                <option value=\"大四\">大四</option>\n                <option value=\"研一\">研一</option>\n                <option value=\"研二\">研二</option>\n                <option value=\"其他\">其他</option>\n              </select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">目标国家</label>\n              <input\n                type=\"text\"\n                value={formData.targetCountry}\n                onChange={(e) => updateField('targetCountry', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n                placeholder=\"如：美国、英国、美国/英国\"\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">预算范围</label>\n              <select\n                value={formData.budget}\n                onChange={(e) => updateField('budget', e.target.value)}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500\"\n              >\n                <option value=\"\">请选择</option>\n                <option value=\"10万以下\">10万以下</option>\n                <option value=\"10-30万\">10-30万</option>\n                <option value=\"30-50万\">30-50万</option>\n                <option value=\"50万+\">50万+</option>\n              </select>\n            </div>\n\n            {/* 备注 */}\n            <div className=\"col-span-2 mt-4\">\n              <label className=\"block text-sm font-medium text-slate-700 mb-1\">备注</label>\n              <textarea\n                value={formData.notes}\n                onChange={(e) => updateField('notes', e.target.value)}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 resize-none\"\n                placeholder=\"输入备注信息...\"\n              />\n            </div>\n          </div>\n        </form>\n\n        {/* 底部按钮 */}\n        <div className=\"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50\">\n          <Button variant=\"outline\" onClick={onCancel} disabled={isSubmitting}>\n            取消\n          </Button>\n          <Button onClick={handleSubmit} disabled={isSubmitting}>\n            {isSubmitting ? '提交中...' : isEditing ? '保存' : '创建'}\n          </Button>\n        </div>\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { ChevronDown, Check } from 'lucide-react'\nimport { useToast } from '@/components/shared/Toast'\nimport { updateCustomerStage, customerStageConfig } from '@/lib/services/customer.service'\nimport type { SalesStage, SalesCustomer } from '@/types/entities'\n\ninterface StageDropdownProps {\n  customer: SalesCustomer\n  onUpdate: (customer: SalesCustomer) => void\n}\n\n/**\n * 客户阶段下拉选择器\n */\nexport function StageDropdown({ customer, onUpdate }: StageDropdownProps) {\n  const toast = useToast()\n  const [isOpen, setIsOpen] = useState(false)\n  const [isUpdating, setIsUpdating] = useState(false)\n\n  const currentConfig = customerStageConfig[customer.stage]\n\n  const handleSelect = async (stage: SalesStage) => {\n    if (stage === customer.stage) {\n      setIsOpen(false)\n      return\n    }\n\n    setIsUpdating(true)\n    const result = await updateCustomerStage(customer.id, stage)\n\n    if (result.success) {\n      toast.success('更新成功', `已将 ${customer.name} 更新为\"${customerStageConfig[stage].label}\"`)\n      onUpdate(result.data)\n    } else {\n      toast.error('更新失败', result.error.message)\n    }\n\n    setIsUpdating(false)\n    setIsOpen(false)\n  }\n\n  return (\n    <div className=\"relative\">\n      <button\n        onClick={() => setIsOpen(!isOpen)}\n        disabled={isUpdating}\n        className={`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md transition-colors ${currentConfig.color} ${\n          isUpdating ? 'opacity-50 cursor-wait' : 'hover:opacity-80 cursor-pointer'\n        }`}\n      >\n        {isUpdating ? '更新中...' : currentConfig.label}\n        <ChevronDown size={12} />\n      </button>\n\n      {isOpen && (\n        <>\n          {/* 点击外部关闭 */}\n          <div\n            className=\"fixed inset-0 z-10\"\n            onClick={() => setIsOpen(false)}\n          />\n\n          {/* 下拉菜单 */}\n          <div className=\"absolute left-0 top-full mt-1 z-20 bg-white border border-slate-200 rounded-lg shadow-lg py-1 min-w-[120px]\">\n            {Object.entries(customerStageConfig).map(([key, config]) => (\n              <button\n                key={key}\n                onClick={() => handleSelect(key as SalesStage)}\n                className={`w-full flex items-center justify-between gap-2 px-3 py-2 text-sm hover:bg-slate-50 ${\n                  key === customer.stage ? 'text-brand-600 font-medium' : 'text-slate-700'\n                }`}\n              >\n                <span className={`inline-block w-2 h-2 rounded-full ${config.color.split(' ')[0]}`} />\n                <span className=\"flex-1 text-left\">{config.label}</span>\n                {key === customer.stage && <Check size={14} className=\"text-brand-600\" />}\n              </button>\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Check\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjAgNiA5IDE3bC01LTUiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/check\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Check = createLucideIcon('Check', [['path', { d: 'M20 6 9 17l-5-5', key: '1gmf2c' }]]);\n\nexport default Check;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Trash2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMyA2aDE4IiAvPgogIDxwYXRoIGQ9Ik0xOSA2djE0YzAgMS0xIDItMiAySDdjLTEgMC0yLTEtMi0yVjYiIC8+CiAgPHBhdGggZD0iTTggNlY0YzAtMSAxLTIgMi0yaDRjMSAwIDIgMSAyIDJ2MiIgLz4KICA8bGluZSB4MT0iMTAiIHgyPSIxMCIgeTE9IjExIiB5Mj0iMTciIC8+CiAgPGxpbmUgeDE9IjE0IiB4Mj0iMTQiIHkxPSIxMSIgeTI9IjE3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/trash-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trash2 = createLucideIcon('Trash2', [\n  ['path', { d: 'M3 6h18', key: 'd0wm0j' }],\n  ['path', { d: 'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6', key: '4alrt4' }],\n  ['path', { d: 'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2', key: 'v07s0e' }],\n  ['line', { x1: '10', x2: '10', y1: '11', y2: '17', key: '1uufr5' }],\n  ['line', { x1: '14', x2: '14', y1: '11', y2: '17', key: 'xtxkd' }],\n]);\n\nexport default Trash2;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name SquarePen\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgM0g1YTIgMiAwIDAgMC0yIDJ2MTRhMiAyIDAgMCAwIDIgMmgxNGEyIDIgMCAwIDAgMi0ydi03IiAvPgogIDxwYXRoIGQ9Ik0xOC4zNzUgMi42MjVhMSAxIDAgMCAxIDMgM2wtOS4wMTMgOS4wMTRhMiAyIDAgMCAxLS44NTMuNTA1bC0yLjg3My44NGEuNS41IDAgMCAxLS42Mi0uNjJsLjg0LTIuODczYTIgMiAwIDAgMSAuNTA2LS44NTJ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/square-pen\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst SquarePen = createLucideIcon('SquarePen', [\n  ['path', { d: 'M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7', key: '1m0v6g' }],\n  [\n    'path',\n    {\n      d: 'M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z',\n      key: 'ohrbg2',\n    },\n  ],\n]);\n\nexport default SquarePen;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name ChevronLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTUgMTgtNi02IDYtNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/chevron-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ChevronLeft = createLucideIcon('ChevronLeft', [\n  ['path', { d: 'm15 18-6-6 6-6', key: '1wnfg3' }],\n]);\n\nexport default ChevronLeft;\n"],"names":[],"mappings":"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","ignoreList":[4,5,6,7]}