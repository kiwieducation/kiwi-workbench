module.exports=[4720,a=>{"use strict";let b=(0,a.i(70106).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);a.s(["FileText",()=>b],4720)},41675,a=>{"use strict";let b=(0,a.i(70106).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);a.s(["Calendar",()=>b],41675)},41710,11300,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>c],41710);let d=(0,b.default)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);a.s(["ClipboardList",()=>d],11300)},210,a=>{"use strict";let b=(0,a.i(70106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],210)},43108,a=>{"use strict";let b=(0,a.i(70106).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);a.s(["Lock",()=>b],43108)},3130,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(23177);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex flex-col space-y-1.5 p-6",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",a),...c}));g.displayName="CardTitle",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-sm text-slate-500",a),...c})).displayName="CardDescription";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("p-6 pt-0",a),...c}));h.displayName="CardContent",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("flex items-center p-6 pt-0",a),...c})).displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>h,"CardHeader",()=>f,"CardTitle",()=>g])},84505,22127,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);a.s(["Download",()=>c],84505);let d=(0,b.default)("SearchX",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);a.s(["SearchX",()=>d],22127)},96101,a=>{"use strict";let b=(0,a.i(70106).default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);a.s(["FolderOpen",()=>b],96101)},98963,a=>{"use strict";var b=a.i(87924),c=a.i(22127),d=a.i(92e3),e=a.i(96101),f=a.i(43108),g=a.i(40695);let h={default:e.FolderOpen,search:c.SearchX,error:d.AlertCircle,"no-permission":f.Lock};function i({variant:a="default",icon:c,title:d,description:e,actionLabel:f,onAction:i,className:j=""}){let k=c||h[a];return(0,b.jsxs)("div",{className:`py-16 text-center ${j}`,children:[(0,b.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center",children:(0,b.jsx)(k,{size:32,className:"text-slate-400"})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:d}),e&&(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-4 max-w-sm mx-auto",children:e}),f&&i&&(0,b.jsx)(g.Button,{variant:"outline",onClick:i,children:f})]})}a.s(["EmptyState",()=>i])},17755,a=>{"use strict";let b=(0,a.i(70106).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);a.s(["MoreHorizontal",()=>b],17755)},99278,a=>{"use strict";var b=a.i(69240),c=a.i(9444);let d=[{id:"mat-001",title:"2024美本申请趋势解读",type:"article",source:"公众号",date:"2024-10-20",summary:"今年美本申请有这些新变化..."},{id:"mat-002",title:"文书写作避坑指南",type:"video",source:"视频号",date:"2024-10-18",summary:"分享这个视频给正在准备文书的学生"}];async function e(a){let d=(0,b.createClient)(),{page:e=1,pageSize:f=50,type:g}=a||{};try{var h,k,l;let a,{data:b,error:m}=await d.from("wechat_messages").select("room_id, from_user_id, to_user_id, content, send_time, msg_type").order("send_time",{ascending:!1}).limit(500);if(m){if(console.error("Supabase wechat_messages query failed:",m.message),"42P01"===m.code||m.message.includes("does not exist"))return(0,c.failure)({code:"TABLE_NOT_EXISTS",message:"企业微信消息表不存在，请联系管理员创建 wechat_messages 表"});if("42501"===m.code||m.message.includes("permission denied"))return(0,c.failure)({code:"PERMISSION_DENIED",message:"没有访问企业微信消息的权限"});return(0,c.failure)((0,c.createServiceError)(m,"获取会话列表失败"))}let n=(k=(h=b||[],a=new Map,h.forEach(b=>{let c;if(b.room_id)c=`room_${b.room_id}`;else if(b.from_user_id&&b.to_user_id){let a=[b.from_user_id,b.to_user_id].sort();c=`dm_${a[0]}_${a[1]}`}else c=`msg_${b.from_user_id||"unknown"}`;let d=a.get(c);!d||new Date(b.send_time||"")>new Date(d.lastMessage.send_time||"")?a.set(c,{id:c,lastMessage:b,messageCount:(d?.messageCount||0)+1}):d&&d.messageCount++}),Array.from(a.values()).map(a=>{let b=a.lastMessage,c=i(b.content);return{id:a.id,name:b.room_id?`群聊 ${b.room_id.slice(0,8)}`:`用户 ${b.from_user_id?.slice(0,8)||"Unknown"}`,type:b.room_id?"group":"student",lastMessage:c.slice(0,50)+(c.length>50?"...":""),lastMessageTime:j(b.send_time||""),unreadCount:0,isOverdue:!1}})),(l=g)&&"all"!==l?"internal"===l?k.filter(a=>"internal"===a.type||"group"===a.type):k.filter(a=>a.type===l):k),o=(e-1)*f,p=n.slice(o,o+f);return(0,c.success)({data:p,total:n.length})}catch(a){return console.error("getConversationList error:",a),(0,c.failure)((0,c.createServiceError)(a,"获取会话列表失败"))}}async function f(a,d){let e=(0,b.createClient)(),{limit:f=50,before:g}=d||{};try{let b=e.from("wechat_messages").select("*").order("send_time",{ascending:!1}).limit(f+1);if(a.startsWith("room_")){let c=a.replace("room_","");b=b.eq("room_id",c)}else if(a.startsWith("dm_")){let c=a.replace("dm_","").split("_");c.length>=2&&(b=b.or(`and(from_user_id.eq.${c[0]},to_user_id.eq.${c[1]}),and(from_user_id.eq.${c[1]},to_user_id.eq.${c[0]})`))}g&&(b=b.lt("send_time",g));let{data:d,error:i}=await b;if(i)return console.error("Supabase messages query failed:",i.message),(0,c.failure)((0,c.createServiceError)(i,"获取消息列表失败"));let j=(d?.length||0)>f,k=(d||[]).slice(0,f).map(h);return(0,c.success)({data:k.reverse(),hasMore:j})}catch(a){return console.error("getConversationMessages error:",a),(0,c.failure)((0,c.createServiceError)(a,"获取消息列表失败"))}}async function g(){return(0,c.success)(d)}function h(a){return{id:a.id,conversationId:a.room_id?`room_${a.room_id}`:`dm_${a.from_user_id}_${a.to_user_id}`,senderName:a.from_user_id?.slice(0,8)||"Unknown",senderId:a.from_user_id,content:i(a.content),timestamp:j(a.send_time),isMe:!1,type:function(a){switch(a?.toLowerCase()){case"text":default:return"text";case"image":return"image";case"voice":return"voice";case"video":return"video";case"file":return"file";case"link":return"link"}}(a.msg_type)}}function i(a){if(!a)return"[空消息]";if("string"==typeof a)return a;if(a.text)return String(a.text);if(a.content)return String(a.content);if(a.message)return String(a.message);switch(a.msgtype||a.type){case"image":return"[图片]";case"voice":return"[语音]";case"video":return"[视频]";case"file":return"[文件]";case"link":return"[链接]";case"miniprogram":return"[小程序]";case"location":return"[位置]";default:return"[消息]"}}function j(a){if(!a)return"";try{let b=new Date(a),c=new Date().getTime()-b.getTime(),d=Math.floor(c/6e4),e=Math.floor(c/36e5),f=Math.floor(c/864e5);if(d<1)return"刚刚";if(d<60)return`${d}分钟前`;if(e<24)return b.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});if(1===f)return"昨天";if(f<7)return`${f}天前`;return b.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})}catch{return a}}a.s(["getConversationList",()=>e,"getConversationMessages",()=>f,"getMarketingMaterials",()=>g])},69520,52495,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);a.s(["RefreshCw",()=>c],69520);let d=(0,b.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);a.s(["ExternalLink",()=>d],52495)},75384,a=>{"use strict";var b=a.i(69240),c=a.i(9444),d=a.i(99278);async function e(a){try{var b,e,f;let g,h,i,j=await (0,d.getConversationList)({pageSize:100});if(!j.success)return(0,c.failure)(j.error);let k=(e=(b=j.data.data,g=[],h=new Date,b.forEach(a=>{a.isOverdue&&g.push({id:`alert-overdue-${a.id}`,type:"response_timeout",severity:"high",title:"会话响应超时",description:`${a.name} 的会话已超时未回复`,relatedType:"conversation",relatedId:a.id,relatedName:a.name,status:"pending",createdAt:h.toISOString()}),a.unreadCount>5&&g.push({id:`alert-unread-${a.id}`,type:"response_timeout",severity:"medium",title:"未读消息堆积",description:`${a.name} 有 ${a.unreadCount} 条未读消息`,relatedType:"conversation",relatedId:a.id,relatedName:a.name,status:"pending",createdAt:h.toISOString()}),"critical"===a.riskStatus?g.push({id:`alert-risk-${a.id}`,type:"service_risk",severity:"critical",title:"高风险客户预警",description:`${a.name} 被标记为高风险状态`,relatedType:"conversation",relatedId:a.id,relatedName:a.name,status:"pending",createdAt:h.toISOString()}):"attention"===a.riskStatus&&g.push({id:`alert-attention-${a.id}`,type:"service_risk",severity:"medium",title:"客户需关注",description:`${a.name} 需要重点关注`,relatedType:"conversation",relatedId:a.id,relatedName:a.name,status:"pending",createdAt:h.toISOString()})}),g),f=a,i=[...e],f?.type&&"all"!==f.type&&(i=i.filter(a=>a.type===f.type)),f?.severity&&"all"!==f.severity&&(i=i.filter(a=>a.severity===f.severity)),f?.status&&"all"!==f.status&&(i=i.filter(a=>a.status===f.status)),f?.assignee&&(i=i.filter(a=>a.assigneeId===f.assignee)),i);return(0,c.success)(k)}catch(a){return console.error("getQualityAlerts error:",a),(0,c.failure)((0,c.createServiceError)(a,"获取预警列表失败"))}}async function f(a){let b=await e();if(!b.success)return(0,c.failure)(b.error);let d=b.data.find(b=>b.id===a);return(0,c.success)(d||null)}async function g(){try{let a=await (0,d.getConversationList)({pageSize:200}),b=0;a.success&&(b=a.data.total,a.data.data.filter(a=>a.isOverdue).length,a.data.data.filter(a=>a.unreadCount>0).length);let f=await e(),g=0,h=0,i=0;f.success&&(g=f.data.filter(a=>"pending"===a.status).length,h=f.data.filter(a=>"critical"===a.severity&&"resolved"!==a.status).length,i=f.data.filter(a=>"resolved"===a.status).length);let j=[{label:"今日会话数",value:b,color:"text-blue-600",trend:"neutral"},{label:"待处理预警",value:g,color:"text-amber-600",trend:g>3?"up":"neutral",change:g>3?g-3:void 0},{label:"紧急预警",value:h,color:"text-red-600",trend:h>0?"up":"down"},{label:"已处理",value:i,total:g+i+h,color:"text-emerald-600"}];return(0,c.success)(j)}catch(a){return console.error("getQualityMetrics error:",a),(0,c.success)([{label:"今日会话数",value:0,color:"text-blue-600"},{label:"待处理预警",value:0,color:"text-amber-600"},{label:"紧急预警",value:0,color:"text-red-600"},{label:"已处理",value:0,color:"text-emerald-600"}])}}async function h(){let a=await e();if(!a.success)return(0,c.failure)(a.error);let b=a.data,d={},f={},g={};return b.forEach(a=>{d[a.type]=(d[a.type]||0)+1,f[a.severity]=(f[a.severity]||0)+1,g[a.status]=(g[a.status]||0)+1}),(0,c.success)({byType:d,bySeverity:f,byStatus:g})}async function i(){let a=await e({status:"pending"});return a.success?(0,c.success)(a.data.length):(0,c.failure)(a.error)}async function j(a=5){let b=await e();if(!b.success)return(0,c.failure)(b.error);let d=[...b.data].sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime()).slice(0,a);return(0,c.success)(d)}async function k(a){let d=(0,b.createClient)();try{let{data:{user:b}}=await d.auth.getUser(),f={alert_id:a.alertId,alert_type:"manual_resolve",status:"resolved",notes:a.notes||null,reviewed_by:b?.id||null,reviewed_at:new Date().toISOString()},{error:g}=await d.from("quality_reviews").upsert(f,{onConflict:"alert_id"});if(g){if(console.error("Resolve alert error:",g),"42P01"===g.code||g.message.includes("does not exist"))return(0,c.failure)({code:"TABLE_NOT_EXISTS",message:"quality_reviews 表不存在，请联系管理员创建"});if("42501"===g.code||g.message.includes("permission denied"))return(0,c.failure)({code:"PERMISSION_DENIED",message:"没有处理预警的权限"});return(0,c.failure)((0,c.createServiceError)(g,"处理预警失败"))}let h=await e();if(h.success){let b=h.data.find(b=>b.id===a.alertId);if(b)return(0,c.success)({...b,status:"resolved",resolvedAt:new Date().toISOString()})}return(0,c.success)({id:a.alertId,type:"response_timeout",severity:"low",title:"已处理",description:"",relatedType:"conversation",relatedId:"",relatedName:"",status:"resolved",createdAt:new Date().toISOString(),resolvedAt:new Date().toISOString()})}catch(a){return console.error("resolveAlert error:",a),(0,c.failure)((0,c.createServiceError)(a,"处理预警失败"))}}async function l(a,d){let e=(0,b.createClient)();try{let{data:{user:b}}=await e.auth.getUser(),f={alert_id:a,alert_type:"ignored",status:"ignored",notes:d||"用户忽略",reviewed_by:b?.id||null,reviewed_at:new Date().toISOString()},{error:g}=await e.from("quality_reviews").upsert(f,{onConflict:"alert_id"});if(g){if("42P01"===g.code)return(0,c.failure)({code:"TABLE_NOT_EXISTS",message:"quality_reviews 表不存在"});return(0,c.failure)((0,c.createServiceError)(g,"忽略预警失败"))}return(0,c.success)(void 0)}catch(a){return(0,c.failure)((0,c.createServiceError)(a,"忽略预警失败"))}}async function m(a,b){let d=0;for(let c of a)(await k({alertId:c,notes:b})).success&&d++;return(0,c.success)(d)}a.s(["batchResolveAlerts",()=>m,"getAlertById",()=>f,"getAlertStats",()=>h,"getPendingAlertsCount",()=>i,"getQualityAlerts",()=>e,"getQualityMetrics",()=>g,"getRecentAlerts",()=>j,"ignoreAlert",()=>l,"resolveAlert",()=>k])},26373,a=>{a.v(a=>Promise.resolve().then(()=>a(75384)))}];

//# sourceMappingURL=_03fba462._.js.map