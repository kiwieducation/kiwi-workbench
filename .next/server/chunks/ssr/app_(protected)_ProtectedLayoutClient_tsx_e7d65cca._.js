module.exports=[59070,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(50944),e=a.i(70106);let f=(0,e.default)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var g=a.i(63588),h=a.i(53722);let i=(0,e.default)("FolderKanban",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]]),j=(0,e.default)("Library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]),k=(0,e.default)("Contact",[["path",{d:"M16 2v2",key:"scm5qe"}],["path",{d:"M7 22v-2a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2",key:"1waht3"}],["path",{d:"M8 2v2",key:"pbkmx"}],["circle",{cx:"12",cy:"11",r:"3",key:"itu57m"}],["rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",key:"12vinp"}]]);var l=a.i(24669),m=a.i(60246),n=a.i(59165),o=a.i(69769);let p=(0,e.default)("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 3.447 1.724a1 1 0 0 1 .553.894V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-7.382a1 1 0 0 1 .553-.894L6 10",key:"1xqip1"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 7.106-3.553a2 2 0 0 1 1.788 0L20 6",key:"9d2mlk"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]);var q=a.i(56738);let r=(0,e.default)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),s=(0,e.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var t=a.i(23177);let u=[{label:"公司级能力",items:[{title:"个人首页",href:"/",icon:f},{title:"会话中心",href:"/messages",icon:g.MessageSquare},{title:"知识库",href:"/knowledge",icon:h.BookOpen},{title:"项目协作",href:"/projects",icon:i},{title:"素材中台",href:"/materials",icon:j},{title:"通讯录",href:"/contacts",icon:k}]},{label:"部门工作台",items:[{title:"销售工作台",href:"/sales",icon:l.TrendingUp,roles:["sales","team_leader","manager","admin"]},{title:"BD工作台",href:"/bd",icon:m.Users,roles:["bd","manager","admin"]},{title:"市场工作台",href:"/marketing",icon:n.Megaphone,roles:["marketing","manager","admin"]},{title:"导师工作台",href:"/tutor",icon:o.GraduationCap,roles:["tutor","team_leader","manager","admin"]},{title:"教务工作台",href:"/academic",icon:p,roles:["academic","manager","admin"]},{title:"财务工作台",href:"/finance",icon:q.Wallet,roles:["finance","manager","admin"]}]},{label:"管理监控",items:[{title:"质检中心",href:"/quality",icon:r,roles:["manager","admin"]}]},{label:"系统",items:[{title:"系统设置",href:"/settings",icon:s,roles:["admin"]}]}];function v({currentUser:a}){let e=(0,d.usePathname)();return(0,b.jsxs)("aside",{className:"w-64 bg-white border-r border-slate-200 flex flex-col h-screen fixed left-0 top-0 z-20",children:[(0,b.jsx)("div",{className:"h-16 flex items-center px-6 border-b border-slate-100",children:(0,b.jsxs)(c.default,{href:"/",className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold",children:"K"}),(0,b.jsx)("span",{className:"text-xl font-bold tracking-tight text-slate-900",children:"柯维留学"})]})}),(0,b.jsx)("nav",{className:"flex-1 overflow-y-auto py-4 px-3 space-y-6",children:u.map(d=>{let f=d.items.filter(b=>!b.roles||!!a&&b.roles.includes(a.role));return 0===f.length?null:(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2",children:d.label}),(0,b.jsx)("div",{className:"space-y-1",children:f.map(a=>{var d;let f=a.icon,g="/"===(d=a.href)?"/"===e:e.startsWith(d);return(0,b.jsxs)(c.default,{href:a.href,className:(0,t.cn)("flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",g?"bg-brand-50 text-brand-700":"text-slate-600 hover:bg-slate-50 hover:text-slate-900"),children:[(0,b.jsx)(f,{size:18}),a.title]},a.href)})})]},d.label)})}),(0,b.jsx)("div",{className:"p-4 border-t border-slate-100",children:(0,b.jsx)("div",{className:"bg-slate-50 p-3 rounded-xl",children:(0,b.jsx)("p",{className:"text-xs text-slate-500 text-center font-medium",children:"v1.0.0 Enterprise"})})})]})}var w=a.i(72131),x=a.i(44),y=a.i(87532);let z=(0,e.default)("Bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);var A=a.i(44494),B=a.i(5784);let C=(0,e.default)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var D=a.i(46842),E=a.i(40695),F=a.i(7706),G=a.i(54161),H=a.i(69240),I=a.i(9444);async function J(){let a=(0,H.createClient)();try{let{data:{user:b},error:c}=await a.auth.getUser();if(c)return console.warn("Auth error, using mock user:",c.message),(0,I.failure)((0,I.createServiceError)(c,"获取用户认证信息失败"));if(!b)return(0,I.failure)({code:"NOT_AUTHENTICATED",message:"用户未登录"});let{data:d,error:e}=await a.from("users").select("*").eq("id",b.id).single();if(e)return console.warn("User profile error, using auth data:",e.message),(0,I.success)({id:b.id,email:b.email||"",name:b.user_metadata?.name||b.email?.split("@")[0]||"User",avatar_url:b.user_metadata?.avatar_url||null,role:"sales",department:null,team_id:null,created_at:b.created_at,updated_at:b.updated_at||b.created_at});return(0,I.success)(d)}catch(a){return console.error("getCurrentUser error:",a),(0,I.failure)((0,I.createServiceError)(a,"获取用户信息失败"))}}new Date().toISOString(),new Date().toISOString();let K={admin:"系统管理员",manager:"管理层",team_leader:"组长",sales:"销售顾问",tutor:"导师",bd:"BD经理",marketing:"市场专员",finance:"财务",academic:"教务"};function L({currentUser:a}){let c=(0,d.useRouter)(),[e,f]=(0,w.useState)(!1),[g,h]=(0,w.useState)("cn"),i=(0,x.createBrowserClient)("https://wlcknsxtmlvqyfrwqfcx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsY2tuc3h0bWx2cXlmcndxZmN4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0Nzk1NTAsImV4cCI6MjA4NTA1NTU1MH0.F1WhnP_MnTsMh_2j2j81RA2XY-G60jf37p8VS1k0foQ"),j=async()=>{await i.auth.signOut(),c.push("/login"),c.refresh()},k=a?.name||"Guest",l=a?.role?K[a.role]:"访客",m=a?.email||"";return(0,b.jsxs)("header",{className:"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 fixed top-0 left-64 right-0 z-10",children:[(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(y.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{type:"text",placeholder:"搜索资源...",className:"w-80 pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(E.Button,{variant:"ghost",size:"icon",onClick:()=>{h(a=>"cn"===a?"en":"cn")},className:"text-slate-500",children:(0,b.jsx)(A.Globe,{size:20})}),(0,b.jsxs)(E.Button,{variant:"ghost",size:"icon",className:"text-slate-500 relative",children:[(0,b.jsx)(z,{size:20}),(0,b.jsx)("span",{className:"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"})]}),(0,b.jsx)("div",{className:"h-6 w-px bg-slate-200 mx-2"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("button",{onClick:()=>f(!e),className:"flex items-center gap-3 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors",children:[(0,b.jsxs)(F.Avatar,{className:"h-8 w-8",children:[a?.avatar_url&&(0,b.jsx)(F.AvatarImage,{src:a.avatar_url,alt:k}),(0,b.jsx)(F.AvatarFallback,{className:"text-xs",children:k.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2)})]}),(0,b.jsxs)("div",{className:"text-left hidden sm:block",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-slate-900",children:k}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:l})]}),(0,b.jsx)(B.ChevronDown,{size:16,className:"text-slate-400"})]}),e&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>f(!1)}),(0,b.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white border border-slate-200 rounded-lg shadow-lg py-2 z-20",children:[(0,b.jsxs)("div",{className:"px-4 py-3 border-b border-slate-100",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-slate-900",children:k}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:m}),(0,b.jsx)(G.Badge,{variant:"secondary",className:"mt-2",children:l})]}),(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsxs)("button",{onClick:()=>{f(!1)},className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors",children:[(0,b.jsx)(D.User,{size:16}),"个人资料"]}),(0,b.jsxs)("button",{onClick:()=>{f(!1),c.push("/settings")},className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors",children:[(0,b.jsx)(s,{size:16}),"系统设置"]})]}),(0,b.jsx)("div",{className:"border-t border-slate-100 pt-1",children:(0,b.jsxs)("button",{onClick:j,className:"w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[(0,b.jsx)(C,{size:16}),"退出登录"]})})]})]})]})]})]})}function M({children:a,currentUser:c,isLoading:d}){return d?(0,b.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin w-10 h-10 border-3 border-brand-500 border-t-transparent rounded-full mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-slate-500 text-sm",children:"正在加载..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,b.jsx)(v,{currentUser:c}),(0,b.jsx)(L,{currentUser:c}),(0,b.jsx)("main",{className:"ml-64 pt-16 min-h-screen",children:a})]})}let N=(0,w.createContext)(null);function O({children:a}){let[c,d]=(0,w.useState)(null),[e,f]=(0,w.useState)(!0),g=(0,I.useToast)(),h=async()=>{f(!0);try{let a=await J();a.success?d(a.data):(g.error("获取用户信息失败",a.error.message),d(null))}catch(a){console.error("fetchUser error:",a),d(null)}finally{f(!1)}};(0,w.useEffect)(()=>{h()},[]);let i=async()=>{await h()};return(0,b.jsx)(N.Provider,{value:{user:c,isLoading:e,isAuthenticated:!!c,refresh:i},children:a})}function P({children:a}){return(0,b.jsx)(I.ToastProvider,{children:(0,b.jsx)(O,{children:(0,b.jsx)(Q,{children:a})})})}function Q({children:a}){let{user:c,isLoading:d}=function(){let a=(0,w.useContext)(N);if(!a)throw Error("useCurrentUser must be used within a UserProvider");return a}();return(0,b.jsx)(M,{currentUser:c,isLoading:d,children:a})}a.s(["ProtectedLayoutClient",()=>P],59070)}];

//# sourceMappingURL=app_%28protected%29_ProtectedLayoutClient_tsx_e7d65cca._.js.map