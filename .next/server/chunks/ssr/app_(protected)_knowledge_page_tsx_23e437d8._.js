module.exports=[91014,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(87532),e=a.i(70106);let f=(0,e.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var g=a.i(15618);let h=(0,e.default)("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),i=(0,e.default)("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),j=(0,e.default)("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);var k=a.i(50522);let l=(0,e.default)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var m=a.i(81464),n=a.i(92e3),o=a.i(3130),p=a.i(40695),q=a.i(54161),r=a.i(5784),s=a.i(92596),t=a.i(96101),u=a.i(4720),v=a.i(69769);let w=(0,e.default)("Stamp",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M19.27 13.73A2.5 2.5 0 0 0 17.5 13h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1.5c0-.66-.26-1.3-.73-1.77Z",key:"1sy9ra"}],["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-3-3c-1.66 0-3 1-3 3s1 2 1 3.5V13",key:"cnxgux"}]]);var x=a.i(53722),y=a.i(59165);let z={FolderRoot:(0,e.default)("FolderRoot",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["circle",{cx:"12",cy:"13",r:"2",key:"1c1ljs"}],["path",{d:"M12 15v5",key:"11xva1"}]]),FileTemplate:u.FileText,GraduationCap:v.GraduationCap,Stamp:w,BookOpen:x.BookOpen,Megaphone:y.Megaphone};function A({folders:a,selectedId:d,onSelect:e,expandedIds:f,onToggleExpand:g}){let[h,i]=(0,c.useState)(new Set(["folder-root"])),j=f||h,k=g||(a=>{i(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})});return(0,b.jsx)("div",{className:"py-2",children:a.map(a=>(0,b.jsx)(B,{folder:a,level:0,selectedId:d,expandedIds:j,onSelect:e,onToggle:k},a.id))})}function B({folder:a,level:c,selectedId:d,expandedIds:e,onSelect:f,onToggle:g}){let h=e.has(a.id),i=d===a.id,j=a.children&&a.children.length>0,l=a.icon&&z[a.icon]?z[a.icon]:h?t.FolderOpen:s.Folder;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:`flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-slate-100 transition-colors ${i?"bg-brand-50 text-brand-700":"text-slate-700"}`,style:{paddingLeft:`${12+16*c}px`},onClick:()=>f(a),children:[j?(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),g(a.id)},className:"p-0.5 hover:bg-slate-200 rounded",children:h?(0,b.jsx)(r.ChevronDown,{size:14,className:"text-slate-400"}):(0,b.jsx)(k.ChevronRight,{size:14,className:"text-slate-400"})}):(0,b.jsx)("span",{className:"w-5"}),(0,b.jsx)(l,{size:16,className:i?"text-brand-600":"text-slate-500"}),(0,b.jsx)("span",{className:"flex-1 text-sm font-medium truncate",children:a.name}),void 0!==a.fileCount&&(0,b.jsx)("span",{className:"text-xs text-slate-400",children:a.fileCount})]}),j&&h&&(0,b.jsx)("div",{children:a.children.map(a=>(0,b.jsx)(B,{folder:a,level:c+1,selectedId:d,expandedIds:e,onSelect:f,onToggle:g},a.id))})]})}let C=(0,e.default)("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),D=(0,e.default)("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]),E=(0,e.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),F=(0,e.default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),G=(0,e.default)("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);var H=a.i(17755),I=a.i(84505);let J=(0,e.default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var K=a.i(98963),L=a.i(69240),M=a.i(9444);let N={document:{label:"文档",icon:"FileText",color:"text-blue-600"},spreadsheet:{label:"表格",icon:"Table",color:"text-emerald-600"},presentation:{label:"演示",icon:"Presentation",color:"text-orange-600"},image:{label:"图片",icon:"Image",color:"text-purple-600"},video:{label:"视频",icon:"Video",color:"text-red-600"},template:{label:"模板",icon:"FileTemplate",color:"text-amber-600"},other:{label:"其他",icon:"File",color:"text-slate-600"}};async function O(){let a=(0,L.createClient)();try{var b;let c,d,{data:e,error:f}=await a.from("knowledge_folders").select("*").order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(f){if(console.error("Supabase knowledge_folders query failed:",f.message),"42P01"===f.code||f.message.includes("does not exist"))return(0,M.failure)({code:"TABLE_NOT_EXISTS",message:"知识库文件夹表不存在，请联系管理员创建 knowledge_folders 表"});if("42501"===f.code||f.message.includes("permission denied"))return(0,M.failure)({code:"PERMISSION_DENIED",message:"没有访问知识库的权限，请联系管理员配置 RLS 策略"});return(0,M.failure)((0,M.createServiceError)(f,"获取文件夹列表失败"))}let g=(b=e||[],c=new Map,d=[],(b.forEach(a=>{c.set(a.id,{...U(a),children:[]})}),b.forEach(a=>{let b=c.get(a.id);if(a.parent_id&&c.has(a.parent_id)){let d=c.get(a.parent_id);d.children||(d.children=[]),d.children.push(b)}else d.push(b)}),0===d.length)?[{id:"folder-root",name:"全部文件",parentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),children:[]}]:d);return(0,M.success)(g)}catch(a){return console.error("getFolders error:",a),(0,M.failure)((0,M.createServiceError)(a,"获取文件夹列表失败"))}}async function P(a,b){let c=(0,L.createClient)(),{page:d=1,pageSize:e=50,search:f}=b||{};try{let b=c.from("knowledge_files").select("*",{count:"exact"});a&&"folder-root"!==a&&"all"!==a&&(b=b.eq("folder_id",a)),f&&(b=b.or(`title.ilike.%${f}%,description.ilike.%${f}%`));let g=(d-1)*e;b=b.range(g,g+e-1).order("updated_at",{ascending:!1});let{data:h,error:i,count:j}=await b;if(i){if(console.error("Supabase knowledge_files query failed:",i.message),"42P01"===i.code||i.message.includes("does not exist"))return(0,M.failure)({code:"TABLE_NOT_EXISTS",message:"知识库文件表不存在，请联系管理员创建 knowledge_files 表"});if("42501"===i.code||i.message.includes("permission denied"))return(0,M.failure)({code:"PERMISSION_DENIED",message:"没有访问知识库文件的权限"});return(0,M.failure)((0,M.createServiceError)(i,"获取文件列表失败"))}let k=(h||[]).map(V);return(0,M.success)({data:k,total:j||0})}catch(a){return console.error("getFilesByFolder error:",a),(0,M.failure)((0,M.createServiceError)(a,"获取文件列表失败"))}}async function Q(a){let b=await P(null,{search:a,pageSize:100});return b.success?(0,M.success)(b.data.data):(0,M.failure)(b.error)}async function R(a){if(!a||"folder-root"===a||"all"===a)return(0,M.success)([{id:"folder-root",name:"全部文件"}]);let b=(0,L.createClient)(),c=[{id:"folder-root",name:"全部文件"}];try{let d=a,e=new Set;for(;d&&!e.has(d);){e.add(d);let{data:a,error:f}=await b.from("knowledge_folders").select("id, name, parent_id").eq("id",d).single();if(f||!a)break;c.splice(1,0,{id:a.id,name:a.name}),d=a.parent_id}return(0,M.success)(c)}catch(a){return(0,M.success)(c)}}async function S(a){let b=(0,L.createClient)();try{let{data:{user:c}}=await b.auth.getUser(),d={name:a.name,parent_id:"folder-root"===a.parentId?null:a.parentId,icon:a.icon||null,created_by:c?.id||null},{data:e,error:f}=await b.from("knowledge_folders").insert(d).select().single();if(f){if(console.error("Create folder error:",f),"42P01"===f.code||f.message.includes("does not exist"))return(0,M.failure)({code:"TABLE_NOT_EXISTS",message:"知识库文件夹表不存在，请联系管理员创建 knowledge_folders 表"});if("42501"===f.code||f.message.includes("permission denied"))return(0,M.failure)({code:"PERMISSION_DENIED",message:"没有创建文件夹的权限"});return(0,M.failure)((0,M.createServiceError)(f,"创建文件夹失败"))}return(0,M.success)(U(e))}catch(a){return console.error("createFolder error:",a),(0,M.failure)((0,M.createServiceError)(a,"创建文件夹失败"))}}async function T(a){let b=(0,L.createClient)();try{var c;let{data:{user:d}}=await b.auth.getUser();if(!d)return(0,M.failure)({code:"NOT_AUTHENTICATED",message:"请先登录"});let e=a.file.name.split(".").pop()||"bin",f=`${Date.now()}-${Math.random().toString(36).slice(2)}.${e}`,g=`knowledge/${d.id}/${f}`,{data:h,error:i}=await b.storage.from("files").upload(g,a.file,{cacheControl:"3600",upsert:!1});if(i){if(console.error("Storage upload error:",i),i.message.includes("Bucket not found"))return(0,M.failure)({code:"BUCKET_NOT_EXISTS",message:'Storage bucket 不存在，请联系管理员创建 "files" bucket'});if(i.message.includes("permission denied")||i.message.includes("not authorized"))return(0,M.failure)({code:"PERMISSION_DENIED",message:"没有上传文件的权限，请检查 Storage 策略"});return(0,M.failure)((0,M.createServiceError)(i,"上传文件失败"))}let{data:j}=b.storage.from("files").getPublicUrl(g),k=j?.publicUrl||null,l=(c=a.file.type).includes("word")||c.includes("pdf")||c.includes("text")?"document":c.includes("excel")||c.includes("spreadsheet")?"spreadsheet":c.includes("powerpoint")||c.includes("presentation")?"presentation":c.startsWith("image/")?"image":c.startsWith("video/")?"video":"other",m={folder_id:"folder-root"===a.folderId?null:a.folderId,title:a.title||a.file.name,description:a.description||null,file_path:g,file_url:k,file_type:l,mime_type:a.file.type,size:a.file.size,tags:a.tags||null,view_count:0,download_count:0,created_by:d.id},{data:n,error:o}=await b.from("knowledge_files").insert(m).select().single();if(o){if(console.error("Create file record error:",o),await b.storage.from("files").remove([g]),"42P01"===o.code||o.message.includes("does not exist"))return(0,M.failure)({code:"TABLE_NOT_EXISTS",message:"知识库文件表不存在，请联系管理员创建 knowledge_files 表"});return(0,M.failure)((0,M.createServiceError)(o,"创建文件记录失败"))}return(0,M.success)(V(n))}catch(a){return console.error("uploadFile error:",a),(0,M.failure)((0,M.createServiceError)(a,"上传文件失败"))}}function U(a){return{id:a.id,name:a.name,parentId:a.parent_id,icon:a.icon||void 0,createdAt:W(a.created_at),updatedAt:W(a.updated_at)}}function V(a){var b,c;let d,e;return{id:a.id,name:a.title,folderId:a.folder_id||"",type:(b=a.file_type,c=a.mime_type,d=b?.toLowerCase()||"",e=c?.toLowerCase()||"","document"===d||e.includes("word")||e.includes("pdf")||e.includes("text")?"document":"spreadsheet"===d||e.includes("excel")||e.includes("spreadsheet")?"spreadsheet":"presentation"===d||e.includes("powerpoint")||e.includes("presentation")?"presentation":"image"===d||e.startsWith("image/")?"image":"video"===d||e.startsWith("video/")?"video":"template"===d?"template":"other"),size:a.size||0,mimeType:a.mime_type||"application/octet-stream",url:a.file_url||a.file_path||void 0,tags:a.tags||[],description:a.description||void 0,createdBy:a.created_by||"Unknown",createdAt:W(a.created_at),updatedAt:W(a.updated_at),viewCount:a.view_count||0,downloadCount:a.download_count||0}}function W(a){try{return new Date(a).toLocaleDateString("zh-CN")}catch{return a}}function X(a){if(0===a)return"0 B";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(1))+" "+["B","KB","MB","GB"][b]}let Y={document:u.FileText,spreadsheet:C,presentation:D,image:E,video:F,template:u.FileText,other:G};function Z({files:a,viewMode:c="list",onFileClick:d,onDownload:e,emptyTitle:f="暂无文件",emptyDescription:g="当前文件夹为空"}){return 0===a.length?(0,b.jsx)(K.EmptyState,{variant:"default",title:f,description:g,icon:u.FileText}):"grid"===c?(0,b.jsx)(_,{files:a,onFileClick:d,onDownload:e}):(0,b.jsx)($,{files:a,onFileClick:d,onDownload:e})}function $({files:a,onFileClick:c,onDownload:d}){return(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,b.jsx)("thead",{className:"bg-slate-50 border-y border-slate-200 text-slate-500 font-semibold",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"文件名"}),(0,b.jsx)("th",{className:"px-4 py-3 w-24",children:"大小"}),(0,b.jsx)("th",{className:"px-4 py-3 w-32",children:"更新时间"}),(0,b.jsx)("th",{className:"px-4 py-3 w-24",children:"浏览"}),(0,b.jsx)("th",{className:"px-4 py-3 w-20 text-right",children:"操作"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-slate-100",children:a.map(a=>{let e=N[a.type],f=Y[a.type];return(0,b.jsxs)("tr",{className:"hover:bg-slate-50 transition-colors cursor-pointer",onClick:()=>c?.(a),children:[(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center ${e.color}`,children:(0,b.jsx)(f,{size:16})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"font-medium text-slate-900 truncate max-w-md",children:a.name}),a.tags.length>0&&(0,b.jsx)("div",{className:"flex gap-1 mt-1",children:a.tags.slice(0,3).map(a=>(0,b.jsx)("span",{className:"text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded",children:a},a))})]})]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-500",children:X(a.size)}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-500",children:a.updatedAt}),(0,b.jsx)("td",{className:"px-4 py-3 text-slate-500",children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(J,{size:12}),a.viewCount]})}),(0,b.jsx)("td",{className:"px-4 py-3 text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",onClick:a=>a.stopPropagation(),children:[(0,b.jsx)("button",{onClick:()=>d?.(a),className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded",title:"下载",children:(0,b.jsx)(I.Download,{size:14})}),(0,b.jsx)("button",{className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded",title:"更多",children:(0,b.jsx)(H.MoreHorizontal,{size:14})})]})})]},a.id)})})]})})}function _({files:a,onFileClick:c,onDownload:d}){return(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 p-4",children:a.map(a=>{let e=N[a.type],f=Y[a.type];return(0,b.jsxs)("div",{className:"group bg-white border border-slate-200 rounded-xl p-4 hover:shadow-md hover:border-brand-200 transition-all cursor-pointer",onClick:()=>c?.(a),children:[(0,b.jsx)("div",{className:`w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mb-3 ${e.color}`,children:(0,b.jsx)(f,{size:24})}),(0,b.jsx)("h4",{className:"font-medium text-slate-900 text-sm truncate mb-1",title:a.name,children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-slate-400 mb-2",children:[X(a.size)," · ",a.updatedAt]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-400",children:[(0,b.jsx)(J,{size:10}),a.viewCount]}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),d?.(a)},className:"p-1.5 text-slate-400 hover:text-brand-600 hover:bg-brand-50 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(I.Download,{size:14})})]})]},a.id)})})}var aa=a.i(33508);let ab=(0,e.default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);function ac({folderId:a,onSuccess:d,onCancel:e}){let g=(0,M.useToast)(),h=(0,c.useRef)(null),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),[o,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(0),v=async()=>{if(!i)return void g.warning("请选择文件","请先选择要上传的文件");if(!k.trim())return void g.warning("请输入标题","请输入文件标题");s(!0),u(10);let b={folderId:"folder-root"===a?null:a,title:k.trim(),description:m.trim()||void 0,file:i,tags:o.split(",").map(a=>a.trim()).filter(a=>a)||void 0},c=setInterval(()=>{u(a=>Math.min(a+10,90))},200),e=await T(b);clearInterval(c),u(100),e.success?(g.success("上传成功",`${i.name} 已上传`),d(e.data)):g.error("上传失败",e.error.message),s(!1)};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"上传文件"}),(0,b.jsx)("button",{onClick:e,disabled:r,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 disabled:opacity-50",children:(0,b.jsx)(aa.X,{size:20})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{onClick:()=>!r&&h.current?.click(),onDrop:a=>{a.preventDefault();let b=a.dataTransfer.files?.[0];b&&(j(b),k||l(b.name.replace(/\.[^/.]+$/,"")))},onDragOver:a=>{a.preventDefault()},className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${i?"border-brand-300 bg-brand-50":"border-slate-200 hover:border-brand-300 hover:bg-slate-50"} ${r?"pointer-events-none opacity-50":""}`,children:[(0,b.jsx)("input",{ref:h,type:"file",onChange:a=>{let b=a.target.files?.[0];b&&(j(b),k||l(b.name.replace(/\.[^/.]+$/,"")))},className:"hidden",disabled:r}),i?(0,b.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,b.jsx)(G,{size:32,className:"text-brand-600"}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"font-medium text-slate-900",children:i.name}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:(a=>{if(0===a)return"0 B";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(1))+" "+["B","KB","MB","GB"][b]})(i.size)})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f,{size:32,className:"mx-auto text-slate-400 mb-2"}),(0,b.jsx)("p",{className:"text-slate-700 font-medium",children:"点击选择文件或拖拽到此处"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"支持 PDF、Word、Excel、图片等格式"})]})]}),r&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-slate-600",children:"上传中..."}),(0,b.jsxs)("span",{className:"text-brand-600",children:[t,"%"]})]}),(0,b.jsx)("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-brand-600 transition-all duration-300",style:{width:`${t}%`}})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["文件标题 ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:k,onChange:a=>l(a.target.value),disabled:r,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:bg-slate-50",placeholder:"输入文件标题"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"描述"}),(0,b.jsx)("textarea",{value:m,onChange:a=>n(a.target.value),disabled:r,rows:2,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 resize-none disabled:bg-slate-50",placeholder:"输入文件描述（可选）"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"标签"}),(0,b.jsx)("input",{type:"text",value:o,onChange:a=>q(a.target.value),disabled:r,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:bg-slate-50",placeholder:"用逗号分隔，如：模板, 重要, 必读"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50",children:[(0,b.jsx)(p.Button,{variant:"outline",onClick:e,disabled:r,children:"取消"}),(0,b.jsx)(p.Button,{onClick:v,disabled:r||!i,children:r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ab,{size:16,className:"mr-2 animate-spin"}),"上传中..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f,{size:16,className:"mr-2"}),"上传"]})})]})]})})}function ad({parentId:a,onSuccess:d,onCancel:e}){let f=(0,M.useToast)(),[g,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),l=async()=>{if(!g.trim())return void f.warning("请输入名称","请输入文件夹名称");k(!0);let b={name:g.trim(),parentId:"folder-root"===a?null:a},c=await S(b);c.success?(f.success("创建成功",`文件夹 "${g}" 已创建`),d(c.data)):f.error("创建失败",c.error.message),k(!1)};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"新建文件夹"}),(0,b.jsx)("button",{onClick:e,disabled:j,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 disabled:opacity-50",children:(0,b.jsx)(aa.X,{size:20})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["文件夹名称 ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"text",value:g,onChange:a=>i(a.target.value),onKeyDown:a=>{"Enter"!==a.key||j||l()},disabled:j,autoFocus:!0,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:bg-slate-50",placeholder:"输入文件夹名称"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50",children:[(0,b.jsx)(p.Button,{variant:"outline",onClick:e,disabled:j,children:"取消"}),(0,b.jsx)(p.Button,{onClick:l,disabled:j||!g.trim(),children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ab,{size:16,className:"mr-2 animate-spin"}),"创建中..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h,{size:16,className:"mr-2"}),"创建"]})})]})]})})}function ae(){let a=(0,M.useToast)(),[e,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(0),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)("folder-root"),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)("list"),[H,I]=(0,c.useState)(!0),[J,K]=(0,c.useState)(!0),[L,N]=(0,c.useState)(!1),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),Y=async()=>{K(!0);let b=await O();b.success?(r(b.data),T(null)):(a.error("加载文件夹失败",b.error.message),T(b.error.message),r([])),K(!1)};(0,c.useEffect)(()=>{Y()},[]),(0,c.useEffect)(()=>{B||(async()=>{I(!0),N(!1);let[b,c]=await Promise.all([P(y),R(y)]);b.success?(t(b.data.data),v(b.data.total)):(a.error("加载文件列表失败",b.error.message),t([]),v(0)),c.success&&x(c.data),I(!1)})()},[y,B]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{C(D)},300);return()=>clearTimeout(a)},[D]),(0,c.useEffect)(()=>{B?(async()=>{N(!0),I(!0);let b=await Q(B);b.success?(t(b.data),v(b.data.length)):(a.error("搜索失败",b.error.message),t([]),v(0)),I(!1)})():N(!1)},[B]);let $=a=>{E(""),C(""),z(a)},_=async()=>{I(!0);let a=await P(y);a.success&&(t(a.data.data),v(a.data.total)),I(!1)};return S&&0===e.length?(0,b.jsx)("div",{className:"flex h-[calc(100vh-64px)] items-center justify-center bg-slate-50/50",children:(0,b.jsxs)("div",{className:"text-center max-w-md",children:[(0,b.jsx)(n.AlertCircle,{size:48,className:"mx-auto text-red-400 mb-4"}),(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900 mb-2",children:"加载知识库失败"}),(0,b.jsx)("p",{className:"text-sm text-slate-500 mb-4",children:S}),(0,b.jsx)(p.Button,{onClick:()=>window.location.reload(),children:"重试"})]})}):(0,b.jsxs)("div",{className:"flex h-[calc(100vh-64px)] overflow-hidden bg-slate-50/50",children:[U&&(0,b.jsx)(ac,{folderId:y,onSuccess:a=>{V(!1),_()},onCancel:()=>V(!1)}),W&&(0,b.jsx)(ad,{parentId:y,onSuccess:b=>{X(!1),Y(),a.success("创建成功",`文件夹 "${b.name}" 已创建`)},onCancel:()=>X(!1)}),(0,b.jsxs)("div",{className:"w-64 border-r border-slate-200 bg-white flex flex-col",children:[(0,b.jsx)("div",{className:"p-4 border-b border-slate-100",children:(0,b.jsx)("h2",{className:"font-semibold text-slate-900",children:"知识库"})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:J?(0,b.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,b.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-brand-500 border-t-transparent rounded-full"})}):(0,b.jsx)(A,{folders:e,selectedId:y,onSelect:a=>{E(""),C(""),z(a.id)}})}),(0,b.jsx)("div",{className:"p-3 border-t border-slate-100",children:(0,b.jsxs)(p.Button,{variant:"outline",className:"w-full justify-start",size:"sm",onClick:()=>{X(!0)},children:[(0,b.jsx)(h,{size:14,className:"mr-2"}),"新建文件夹"]})})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,b.jsxs)("div",{className:"px-6 py-4 bg-white border-b border-slate-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)("button",{onClick:()=>$("folder-root"),className:"text-slate-500 hover:text-slate-700 flex items-center gap-1",children:(0,b.jsx)(l,{size:14})}),!L&&w.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(k.ChevronRight,{size:14,className:"text-slate-300 mx-1"}),c===w.length-1?(0,b.jsx)("span",{className:"font-medium text-slate-900",children:a.name}):(0,b.jsx)("button",{onClick:()=>$(a.id),className:"text-slate-500 hover:text-slate-700",children:a.name})]},a.id)),L&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.ChevronRight,{size:14,className:"text-slate-300 mx-1"}),(0,b.jsx)("span",{className:"font-medium text-slate-900",children:"搜索结果"}),(0,b.jsxs)(q.Badge,{variant:"secondary",className:"ml-2",children:[s.length," 个文件"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>{V(!0)},children:[(0,b.jsx)(f,{size:14,className:"mr-2"}),"上传文件"]}),(0,b.jsxs)(p.Button,{size:"sm",onClick:()=>{a.info("功能开发中","在线新建文档功能即将上线")},children:[(0,b.jsx)(g.Plus,{size:14,className:"mr-2"}),"新建文档"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,b.jsx)("input",{type:"text",value:D,onChange:a=>E(a.target.value),placeholder:"搜索文件名、标签...",className:"w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:bg-white"})]}),(0,b.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded-lg",children:[(0,b.jsx)(m.Filter,{size:14}),"筛选"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-slate-100 p-1 rounded-lg",children:[(0,b.jsx)("button",{onClick:()=>G("list"),className:`p-1.5 rounded ${"list"===F?"bg-white shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:(0,b.jsx)(j,{size:16})}),(0,b.jsx)("button",{onClick:()=>G("grid"),className:`p-1.5 rounded ${"grid"===F?"bg-white shadow-sm":"text-slate-500 hover:text-slate-700"}`,children:(0,b.jsx)(i,{size:16})})]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:H?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-500 border-t-transparent rounded-full"})}):(0,b.jsx)(o.Card,{className:"m-6 border-0 shadow-sm ring-1 ring-slate-200 overflow-hidden",children:(0,b.jsx)(Z,{files:s,viewMode:F,onFileClick:b=>{b.url?window.open(b.url,"_blank"):a.info("文件预览",`即将预览：${b.name}`)},onDownload:b=>{b.url?window.open(b.url,"_blank"):a.warning("下载失败","文件地址不可用")},emptyTitle:L?"没有找到匹配的文件":"暂无文件",emptyDescription:L?"尝试使用其他关键词搜索":"上传文件或创建新文档"})})})]})]})}a.s(["default",()=>ae],91014)}];

//# sourceMappingURL=app_%28protected%29_knowledge_page_tsx_23e437d8._.js.map