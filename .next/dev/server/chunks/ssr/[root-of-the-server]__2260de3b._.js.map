{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/lib/utils/cn.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/layout/Sidebar.tsx"],"sourcesContent":["'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport {\n  LayoutDashboard,\n  MessageSquare,\n  BookOpen,\n  FolderKanban,\n  Library,\n  Contact,\n  TrendingUp,\n  Users,\n  Megaphone,\n  GraduationCap,\n  School,\n  Wallet,\n  ShieldCheck,\n  Settings,\n  type LucideIcon,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils/cn'\nimport type { User } from '@/types/entities'\n\n/**\n * 侧边栏导航配置\n * 对齐 v8.0 PRD 模块分类\n */\ninterface NavItem {\n  title: string\n  href: string\n  icon: LucideIcon\n  roles?: User['role'][]  // 可访问的角色，undefined 表示全员可见\n}\n\ninterface NavGroup {\n  label: string\n  items: NavItem[]\n}\n\nconst navigation: NavGroup[] = [\n  {\n    label: '公司级能力',\n    items: [\n      { title: '个人首页', href: '/', icon: LayoutDashboard },\n      { title: '会话中心', href: '/messages', icon: MessageSquare },\n      { title: '知识库', href: '/knowledge', icon: BookOpen },\n      { title: '项目协作', href: '/projects', icon: FolderKanban },\n      { title: '素材中台', href: '/materials', icon: Library },\n      { title: '通讯录', href: '/contacts', icon: Contact },\n    ],\n  },\n  {\n    label: '部门工作台',\n    items: [\n      { title: '销售工作台', href: '/sales', icon: TrendingUp, roles: ['sales', 'team_leader', 'manager', 'admin'] },\n      { title: 'BD工作台', href: '/bd', icon: Users, roles: ['bd', 'manager', 'admin'] },\n      { title: '市场工作台', href: '/marketing', icon: Megaphone, roles: ['marketing', 'manager', 'admin'] },\n      { title: '导师工作台', href: '/tutor', icon: GraduationCap, roles: ['tutor', 'team_leader', 'manager', 'admin'] },\n      { title: '教务工作台', href: '/academic', icon: School, roles: ['academic', 'manager', 'admin'] },\n      { title: '财务工作台', href: '/finance', icon: Wallet, roles: ['finance', 'manager', 'admin'] },\n    ],\n  },\n  {\n    label: '管理监控',\n    items: [\n      { title: '质检中心', href: '/quality', icon: ShieldCheck, roles: ['manager', 'admin'] },\n    ],\n  },\n  {\n    label: '系统',\n    items: [\n      { title: '系统设置', href: '/settings', icon: Settings, roles: ['admin'] },\n    ],\n  },\n]\n\ninterface SidebarProps {\n  currentUser: User | null\n}\n\nexport function Sidebar({ currentUser }: SidebarProps) {\n  const pathname = usePathname()\n\n  // 根据用户角色过滤可见的导航项\n  const filterNavItems = (items: NavItem[]): NavItem[] => {\n    return items.filter((item) => {\n      if (!item.roles) return true // 无角色限制，全员可见\n      if (!currentUser) return false // 无用户时隐藏需要角色的项\n      return item.roles.includes(currentUser.role)\n    })\n  }\n\n  // 检查路径是否激活\n  const isActive = (href: string): boolean => {\n    if (href === '/') {\n      return pathname === '/'\n    }\n    return pathname.startsWith(href)\n  }\n\n  return (\n    <aside className=\"w-64 bg-white border-r border-slate-200 flex flex-col h-screen fixed left-0 top-0 z-20\">\n      {/* Logo */}\n      <div className=\"h-16 flex items-center px-6 border-b border-slate-100\">\n        <Link href=\"/\" className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold\">\n            K\n          </div>\n          <span className=\"text-xl font-bold tracking-tight text-slate-900\">\n            柯维留学\n          </span>\n        </Link>\n      </div>\n\n      {/* 导航菜单 */}\n      <nav className=\"flex-1 overflow-y-auto py-4 px-3 space-y-6\">\n        {navigation.map((group) => {\n          const visibleItems = filterNavItems(group.items)\n          if (visibleItems.length === 0) return null\n\n          return (\n            <div key={group.label}>\n              <h4 className=\"px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2\">\n                {group.label}\n              </h4>\n              <div className=\"space-y-1\">\n                {visibleItems.map((item) => {\n                  const Icon = item.icon\n                  const active = isActive(item.href)\n\n                  return (\n                    <Link\n                      key={item.href}\n                      href={item.href}\n                      className={cn(\n                        'flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium transition-colors',\n                        active\n                          ? 'bg-brand-50 text-brand-700'\n                          : 'text-slate-600 hover:bg-slate-50 hover:text-slate-900'\n                      )}\n                    >\n                      <Icon size={18} />\n                      {item.title}\n                    </Link>\n                  )\n                })}\n              </div>\n            </div>\n          )\n        })}\n      </nav>\n\n      {/* 底部版本信息 */}\n      <div className=\"p-4 border-t border-slate-100\">\n        <div className=\"bg-slate-50 p-3 rounded-xl\">\n          <p className=\"text-xs text-slate-500 text-center font-medium\">\n            v1.0.0 Enterprise\n          </p>\n        </div>\n      </div>\n    </aside>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 346, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { cn } from '@/lib/utils/cn'\n\nconst buttonVariants = cva(\n  'inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',\n  {\n    variants: {\n      variant: {\n        default: 'bg-brand-600 text-white hover:bg-brand-700 shadow-sm',\n        destructive: 'bg-red-500 text-white hover:bg-red-600',\n        outline: 'border border-slate-200 bg-white hover:bg-slate-50 hover:text-slate-900',\n        secondary: 'bg-slate-100 text-slate-900 hover:bg-slate-200',\n        ghost: 'hover:bg-slate-100 hover:text-slate-900',\n        link: 'text-brand-600 underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-10 px-4 py-2',\n        sm: 'h-9 rounded-md px-3',\n        lg: 'h-11 rounded-lg px-8',\n        icon: 'h-10 w-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : 'button'\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = 'Button'\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,0RACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aAAa;YACb,SAAS;YACT,WAAW;YACX,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,mNAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,IAAA,wHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 406, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/ui/avatar.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as AvatarPrimitive from '@radix-ui/react-avatar'\nimport { cn } from '@/lib/utils/cn'\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      'relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full',\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn('aspect-square h-full w-full', className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      'flex h-full w-full items-center justify-center rounded-full bg-slate-100 text-slate-600 font-medium',\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAMA,MAAM,uBAAS,mNAAgB,CAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,0KAAoB;QACnB,KAAK;QACL,WAAW,IAAA,wHAAE,EACX,iEACA;QAED,GAAG,KAAK;;;;;;AAGb,OAAO,WAAW,GAAG,0KAAoB,CAAC,WAAW;AAErD,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,wHAAE,EAAC,+BAA+B;QAC5C,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW;AAE3D,MAAM,+BAAiB,mNAAgB,CAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,8KAAwB;QACvB,KAAK;QACL,WAAW,IAAA,wHAAE,EACX,uGACA;QAED,GAAG,KAAK;;;;;;AAGb,eAAe,WAAW,GAAG,8KAAwB,CAAC,WAAW"}},
    {"offset": {"line": 458, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { cva, type VariantProps } from 'class-variance-authority'\nimport { cn } from '@/lib/utils/cn'\n\nconst badgeVariants = cva(\n  'inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2',\n  {\n    variants: {\n      variant: {\n        default: 'border-transparent bg-brand-100 text-brand-700',\n        secondary: 'border-transparent bg-slate-100 text-slate-700',\n        destructive: 'border-transparent bg-red-100 text-red-700',\n        warning: 'border-transparent bg-amber-100 text-amber-700',\n        success: 'border-transparent bg-emerald-100 text-emerald-700',\n        outline: 'border-slate-200 text-slate-700',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,+KACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,WAAW;YACX,aAAa;YACb,SAAS;YACT,SAAS;YACT,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,IAAA,wHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE"}},
    {"offset": {"line": 502, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\nimport { Database } from '@/types/database'\n\nexport function createClient() {\n  return createBrowserClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n}\n"],"names":[],"mappings":";;;;AAAA;;AAGO,SAAS;IACd,OAAO,IAAA,0LAAmB;AAI5B"}},
    {"offset": {"line": 515, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/shared/Toast.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useState, useCallback, ReactNode } from 'react'\nimport { X, CheckCircle2, AlertCircle, AlertTriangle, Info } from 'lucide-react'\n\n// ============================================\n// Toast 类型定义\n// ============================================\n\ntype ToastType = 'success' | 'error' | 'warning' | 'info'\n\ninterface Toast {\n  id: string\n  type: ToastType\n  title: string\n  message?: string\n  duration?: number\n}\n\ninterface ToastContextValue {\n  toasts: Toast[]\n  showToast: (toast: Omit<Toast, 'id'>) => void\n  dismissToast: (id: string) => void\n  // 便捷方法\n  success: (title: string, message?: string) => void\n  error: (title: string, message?: string) => void\n  warning: (title: string, message?: string) => void\n  info: (title: string, message?: string) => void\n}\n\n// ============================================\n// Toast Context\n// ============================================\n\nconst ToastContext = createContext<ToastContextValue | null>(null)\n\nexport function useToast() {\n  const context = useContext(ToastContext)\n  if (!context) {\n    throw new Error('useToast must be used within a ToastProvider')\n  }\n  return context\n}\n\n// ============================================\n// Toast Provider\n// ============================================\n\nexport function ToastProvider({ children }: { children: ReactNode }) {\n  const [toasts, setToasts] = useState<Toast[]>([])\n\n  const showToast = useCallback((toast: Omit<Toast, 'id'>) => {\n    const id = Math.random().toString(36).slice(2)\n    const newToast: Toast = { ...toast, id }\n    \n    setToasts(prev => [...prev, newToast])\n\n    // 自动消失\n    const duration = toast.duration ?? (toast.type === 'error' ? 5000 : 3000)\n    setTimeout(() => {\n      setToasts(prev => prev.filter(t => t.id !== id))\n    }, duration)\n  }, [])\n\n  const dismissToast = useCallback((id: string) => {\n    setToasts(prev => prev.filter(t => t.id !== id))\n  }, [])\n\n  // 便捷方法\n  const success = useCallback((title: string, message?: string) => {\n    showToast({ type: 'success', title, message })\n  }, [showToast])\n\n  const error = useCallback((title: string, message?: string) => {\n    showToast({ type: 'error', title, message })\n  }, [showToast])\n\n  const warning = useCallback((title: string, message?: string) => {\n    showToast({ type: 'warning', title, message })\n  }, [showToast])\n\n  const info = useCallback((title: string, message?: string) => {\n    showToast({ type: 'info', title, message })\n  }, [showToast])\n\n  return (\n    <ToastContext.Provider value={{ toasts, showToast, dismissToast, success, error, warning, info }}>\n      {children}\n      <ToastContainer toasts={toasts} onDismiss={dismissToast} />\n    </ToastContext.Provider>\n  )\n}\n\n// ============================================\n// Toast Container\n// ============================================\n\nfunction ToastContainer({ toasts, onDismiss }: { toasts: Toast[]; onDismiss: (id: string) => void }) {\n  if (toasts.length === 0) return null\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50 flex flex-col gap-2\">\n      {toasts.map(toast => (\n        <ToastItem key={toast.id} toast={toast} onDismiss={() => onDismiss(toast.id)} />\n      ))}\n    </div>\n  )\n}\n\n// ============================================\n// Toast Item\n// ============================================\n\nconst toastStyles: Record<ToastType, { bg: string; icon: typeof CheckCircle2; iconColor: string }> = {\n  success: { bg: 'bg-emerald-50 border-emerald-200', icon: CheckCircle2, iconColor: 'text-emerald-600' },\n  error: { bg: 'bg-red-50 border-red-200', icon: AlertCircle, iconColor: 'text-red-600' },\n  warning: { bg: 'bg-amber-50 border-amber-200', icon: AlertTriangle, iconColor: 'text-amber-600' },\n  info: { bg: 'bg-blue-50 border-blue-200', icon: Info, iconColor: 'text-blue-600' },\n}\n\nfunction ToastItem({ toast, onDismiss }: { toast: Toast; onDismiss: () => void }) {\n  const style = toastStyles[toast.type]\n  const Icon = style.icon\n\n  return (\n    <div\n      className={`flex items-start gap-3 px-4 py-3 rounded-lg border shadow-lg min-w-[300px] max-w-md animate-in slide-in-from-right ${style.bg}`}\n    >\n      <Icon size={20} className={style.iconColor} />\n      <div className=\"flex-1 min-w-0\">\n        <h4 className=\"font-medium text-slate-900 text-sm\">{toast.title}</h4>\n        {toast.message && (\n          <p className=\"text-xs text-slate-600 mt-0.5\">{toast.message}</p>\n        )}\n      </div>\n      <button\n        onClick={onDismiss}\n        className=\"text-slate-400 hover:text-slate-600 transition-colors\"\n      >\n        <X size={16} />\n      </button>\n    </div>\n  )\n}\n\n// ============================================\n// 统一错误处理工具\n// ============================================\n\nexport interface ServiceError {\n  code: string\n  message: string\n  details?: unknown\n}\n\nexport function createServiceError(error: unknown, defaultMessage: string = '操作失败'): ServiceError {\n  if (error instanceof Error) {\n    return {\n      code: 'ERROR',\n      message: error.message || defaultMessage,\n      details: error,\n    }\n  }\n  \n  if (typeof error === 'object' && error !== null) {\n    const err = error as Record<string, unknown>\n    return {\n      code: String(err.code || 'ERROR'),\n      message: String(err.message || defaultMessage),\n      details: err,\n    }\n  }\n  \n  return {\n    code: 'UNKNOWN',\n    message: defaultMessage,\n    details: error,\n  }\n}\n\n// 服务返回类型\nexport type ServiceResult<T> = \n  | { success: true; data: T }\n  | { success: false; error: ServiceError }\n\n// 创建成功结果\nexport function success<T>(data: T): ServiceResult<T> {\n  return { success: true, data }\n}\n\n// 创建失败结果\nexport function failure<T>(error: ServiceError): ServiceResult<T> {\n  return { success: false, error }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 779, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/lib/services/user.service.ts"],"sourcesContent":["/**\n * 用户服务层\n * \n * 负责用户身份、认证、权限相关数据\n * 所有 Supabase 查询集中在此\n */\n\nimport { createClient } from '@/lib/supabase/client'\nimport { createServiceError, success, failure, type ServiceResult } from '@/components/shared/Toast'\nimport type { User } from '@/types/entities'\n\n// ============================================\n// Mock 数据（Supabase 查询失败时的 fallback）\n// ============================================\n\nconst mockUser: User = {\n  id: 'mock-user-001',\n  email: 'demo@kiwiedu.com',\n  name: 'Demo User',\n  avatar_url: null,\n  role: 'sales',\n  department: 'Sales',\n  team_id: null,\n  created_at: new Date().toISOString(),\n  updated_at: new Date().toISOString(),\n}\n\n// ============================================\n// 服务函数\n// ============================================\n\n/**\n * 获取当前登录用户\n * \n * 优先从 Supabase 获取，失败时返回 Mock 数据（开发模式）\n */\nexport async function getCurrentUser(): Promise<ServiceResult<User>> {\n  const supabase = createClient()\n  \n  try {\n    // 1. 获取认证用户\n    const { data: { user: authUser }, error: authError } = await supabase.auth.getUser()\n    \n    if (authError) {\n      console.warn('Auth error, using mock user:', authError.message)\n      // 开发模式下返回 mock 用户\n      if (process.env.NODE_ENV === 'development') {\n        return success(mockUser)\n      }\n      return failure(createServiceError(authError, '获取用户认证信息失败'))\n    }\n    \n    if (!authUser) {\n      // 未登录，开发模式下返回 mock\n      if (process.env.NODE_ENV === 'development') {\n        return success(mockUser)\n      }\n      return failure({ code: 'NOT_AUTHENTICATED', message: '用户未登录' })\n    }\n    \n    // 2. 获取用户详情（从 users 表）\n    const { data: userData, error: userError } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', authUser.id)\n      .single()\n    \n    if (userError) {\n      console.warn('User profile error, using auth data:', userError.message)\n      // 如果 users 表没有记录，使用认证信息构建基本用户\n      return success({\n        id: authUser.id,\n        email: authUser.email || '',\n        name: authUser.user_metadata?.name || authUser.email?.split('@')[0] || 'User',\n        avatar_url: authUser.user_metadata?.avatar_url || null,\n        role: 'sales', // 默认角色\n        department: null,\n        team_id: null,\n        created_at: authUser.created_at,\n        updated_at: authUser.updated_at || authUser.created_at,\n      })\n    }\n    \n    return success(userData as User)\n  } catch (error) {\n    console.error('getCurrentUser error:', error)\n    // 开发模式下返回 mock\n    if (process.env.NODE_ENV === 'development') {\n      return success(mockUser)\n    }\n    return failure(createServiceError(error, '获取用户信息失败'))\n  }\n}\n\n/**\n * 根据 ID 获取用户\n */\nexport async function getUserById(id: string): Promise<ServiceResult<User>> {\n  const supabase = createClient()\n  \n  try {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', id)\n      .single()\n    \n    if (error) {\n      return failure(createServiceError(error, '获取用户信息失败'))\n    }\n    \n    return success(data as User)\n  } catch (error) {\n    return failure(createServiceError(error, '获取用户信息失败'))\n  }\n}\n\n/**\n * 获取团队成员列表\n */\nexport async function getTeamMembers(teamId?: string): Promise<ServiceResult<User[]>> {\n  const supabase = createClient()\n  \n  try {\n    let query = supabase.from('users').select('*')\n    \n    if (teamId) {\n      query = query.eq('team_id', teamId)\n    }\n    \n    const { data, error } = await query.order('name')\n    \n    if (error) {\n      return failure(createServiceError(error, '获取团队成员失败'))\n    }\n    \n    return success((data || []) as User[])\n  } catch (error) {\n    return failure(createServiceError(error, '获取团队成员失败'))\n  }\n}\n\n/**\n * 获取所有销售/顾问（用于下拉选择）\n */\nexport async function getSalesUsers(): Promise<ServiceResult<User[]>> {\n  const supabase = createClient()\n  \n  try {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .in('role', ['sales', 'team_leader', 'manager'])\n      .order('name')\n    \n    if (error) {\n      return failure(createServiceError(error, '获取销售人员列表失败'))\n    }\n    \n    return success((data || []) as User[])\n  } catch (error) {\n    return failure(createServiceError(error, '获取销售人员列表失败'))\n  }\n}\n\n// ============================================\n// 角色显示名称\n// ============================================\n\nexport const roleDisplayNames: Record<User['role'], string> = {\n  admin: '系统管理员',\n  manager: '管理层',\n  team_leader: '组长',\n  sales: '销售顾问',\n  tutor: '导师',\n  bd: 'BD经理',\n  marketing: '市场专员',\n  finance: '财务',\n  academic: '教务',\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 923, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/layout/Topbar.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { createBrowserClient } from '@supabase/ssr'\nimport {\n  Search,\n  Bell,\n  Globe,\n  ChevronDown,\n  LogOut,\n  User as UserIcon,\n  Settings,\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar'\nimport { Badge } from '@/components/ui/badge'\nimport type { User } from '@/types/entities'\nimport { roleDisplayNames } from '@/lib/services/user.service'\n\ninterface TopbarProps {\n  currentUser: User | null\n}\n\nexport function Topbar({ currentUser }: TopbarProps) {\n  const router = useRouter()\n  const [showUserMenu, setShowUserMenu] = useState(false)\n  const [language, setLanguage] = useState<'cn' | 'en'>('cn')\n\n  // 创建浏览器端 Supabase 客户端\n  const supabase = createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n\n  // 登出处理\n  const handleLogout = async () => {\n    await supabase.auth.signOut()\n    router.push('/login')\n    router.refresh()\n  }\n\n  // 获取用户名首字母\n  const getInitials = (name: string): string => {\n    return name\n      .split(' ')\n      .map((n) => n[0])\n      .join('')\n      .toUpperCase()\n      .slice(0, 2)\n  }\n\n  // 切换语言\n  const toggleLanguage = () => {\n    setLanguage((prev) => (prev === 'cn' ? 'en' : 'cn'))\n    // TODO: 实际的语言切换逻辑\n  }\n\n  // 默认显示名称\n  const displayName = currentUser?.name || 'Guest'\n  const displayRole = currentUser?.role ? roleDisplayNames[currentUser.role] : '访客'\n  const displayEmail = currentUser?.email || ''\n\n  return (\n    <header className=\"h-16 bg-white border-b border-slate-200 flex items-center justify-between px-6 fixed top-0 left-64 right-0 z-10\">\n      {/* 左侧：搜索 */}\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\" size={16} />\n          <input\n            type=\"text\"\n            placeholder=\"搜索资源...\"\n            className=\"w-80 pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all\"\n          />\n        </div>\n      </div>\n\n      {/* 右侧：操作区 */}\n      <div className=\"flex items-center gap-3\">\n        {/* 语言切换 */}\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={toggleLanguage}\n          className=\"text-slate-500\"\n        >\n          <Globe size={20} />\n        </Button>\n\n        {/* 通知 */}\n        <Button variant=\"ghost\" size=\"icon\" className=\"text-slate-500 relative\">\n          <Bell size={20} />\n          <span className=\"absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full\"></span>\n        </Button>\n\n        {/* 分隔线 */}\n        <div className=\"h-6 w-px bg-slate-200 mx-2\"></div>\n\n        {/* 用户菜单 */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowUserMenu(!showUserMenu)}\n            className=\"flex items-center gap-3 px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors\"\n          >\n            <Avatar className=\"h-8 w-8\">\n              {currentUser?.avatar_url && (\n                <AvatarImage src={currentUser.avatar_url} alt={displayName} />\n              )}\n              <AvatarFallback className=\"text-xs\">\n                {getInitials(displayName)}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"text-left hidden sm:block\">\n              <p className=\"text-sm font-medium text-slate-900\">\n                {displayName}\n              </p>\n              <p className=\"text-xs text-slate-500\">\n                {displayRole}\n              </p>\n            </div>\n            <ChevronDown size={16} className=\"text-slate-400\" />\n          </button>\n\n          {/* 下拉菜单 */}\n          {showUserMenu && (\n            <>\n              {/* 点击外部关闭 */}\n              <div\n                className=\"fixed inset-0 z-10\"\n                onClick={() => setShowUserMenu(false)}\n              />\n              \n              <div className=\"absolute right-0 top-full mt-2 w-56 bg-white border border-slate-200 rounded-lg shadow-lg py-2 z-20\">\n                {/* 用户信息 */}\n                <div className=\"px-4 py-3 border-b border-slate-100\">\n                  <p className=\"text-sm font-medium text-slate-900\">\n                    {displayName}\n                  </p>\n                  <p className=\"text-xs text-slate-500\">{displayEmail}</p>\n                  <Badge variant=\"secondary\" className=\"mt-2\">\n                    {displayRole}\n                  </Badge>\n                </div>\n\n                {/* 菜单项 */}\n                <div className=\"py-1\">\n                  <button\n                    onClick={() => {\n                      setShowUserMenu(false)\n                      // TODO: 跳转到个人设置\n                    }}\n                    className=\"w-full flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors\"\n                  >\n                    <UserIcon size={16} />\n                    个人资料\n                  </button>\n                  <button\n                    onClick={() => {\n                      setShowUserMenu(false)\n                      router.push('/settings')\n                    }}\n                    className=\"w-full flex items-center gap-3 px-4 py-2 text-sm text-slate-700 hover:bg-slate-50 transition-colors\"\n                  >\n                    <Settings size={16} />\n                    系统设置\n                  </button>\n                </div>\n\n                {/* 登出 */}\n                <div className=\"border-t border-slate-100 pt-1\">\n                  <button\n                    onClick={handleLogout}\n                    className=\"w-full flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors\"\n                  >\n                    <LogOut size={16} />\n                    退出登录\n                  </button>\n                </div>\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </header>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1290, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/layout/Shell.tsx"],"sourcesContent":["'use client'\n\nimport { Sidebar } from './Sidebar'\nimport { Topbar } from './Topbar'\nimport type { User } from '@/types/entities'\n\ninterface ShellProps {\n  children: React.ReactNode\n  currentUser: User | null\n  isLoading?: boolean\n}\n\n/**\n * 全局 Shell 布局\n * \n * 包含：\n * - 侧边栏（Sidebar）\n * - 顶部栏（Topbar）\n * - 主内容区\n * \n * 布局结构：\n * ┌─────────────────────────────────────────┐\n * │ Topbar (h-16, fixed)                    │\n * ├───────────┬─────────────────────────────┤\n * │ Sidebar   │ Main Content               │\n * │ (w-64)    │ (ml-64, mt-16)             │\n * │ (fixed)   │                            │\n * │           │                            │\n * └───────────┴─────────────────────────────┘\n */\nexport function Shell({ children, currentUser, isLoading }: ShellProps) {\n  // 加载中状态\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin w-10 h-10 border-3 border-brand-500 border-t-transparent rounded-full mx-auto mb-4\" />\n          <p className=\"text-slate-500 text-sm\">正在加载...</p>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50\">\n      {/* 侧边栏 */}\n      <Sidebar currentUser={currentUser} />\n      \n      {/* 顶部栏 */}\n      <Topbar currentUser={currentUser} />\n      \n      {/* 主内容区 */}\n      <main className=\"ml-64 pt-16 min-h-screen\">\n        {children}\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AA8BO,SAAS,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,SAAS,EAAc;IACpE,QAAQ;IACR,IAAI,WAAW;QACb,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAyB;;;;;;;;;;;;;;;;;IAI9C;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC,2IAAO;gBAAC,aAAa;;;;;;0BAGtB,8OAAC,yIAAM;gBAAC,aAAa;;;;;;0BAGrB,8OAAC;gBAAK,WAAU;0BACb;;;;;;;;;;;;AAIT"}},
    {"offset": {"line": 1372, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/components/layout/index.ts"],"sourcesContent":["export { Sidebar } from './Sidebar'\nexport { Topbar } from './Topbar'\nexport { Shell } from './Shell'\n"],"names":[],"mappings":";AAAA;AACA;AACA"}},
    {"offset": {"line": 1383, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/lib/hooks/useCurrentUser.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useState, useEffect, ReactNode } from 'react'\nimport { getCurrentUser } from '@/lib/services/user.service'\nimport { useToast } from '@/components/shared/Toast'\nimport type { User } from '@/types/entities'\n\n// ============================================\n// Context 类型\n// ============================================\n\ninterface UserContextValue {\n  user: User | null\n  isLoading: boolean\n  isAuthenticated: boolean\n  refresh: () => Promise<void>\n}\n\nconst UserContext = createContext<UserContextValue | null>(null)\n\n// ============================================\n// Hook\n// ============================================\n\nexport function useCurrentUser() {\n  const context = useContext(UserContext)\n  if (!context) {\n    throw new Error('useCurrentUser must be used within a UserProvider')\n  }\n  return context\n}\n\n// ============================================\n// Provider\n// ============================================\n\nexport function UserProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const toast = useToast()\n\n  const fetchUser = async () => {\n    setIsLoading(true)\n    try {\n      const result = await getCurrentUser()\n      if (result.success) {\n        setUser(result.data)\n      } else {\n        // 非开发模式下显示错误\n        if (process.env.NODE_ENV !== 'development') {\n          toast.error('获取用户信息失败', result.error.message)\n        }\n        setUser(null)\n      }\n    } catch (error) {\n      console.error('fetchUser error:', error)\n      setUser(null)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    fetchUser()\n  }, [])\n\n  const refresh = async () => {\n    await fetchUser()\n  }\n\n  return (\n    <UserContext.Provider value={{\n      user,\n      isLoading,\n      isAuthenticated: !!user,\n      refresh,\n    }}>\n      {children}\n    </UserContext.Provider>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AAJA;;;;;AAkBA,MAAM,4BAAc,IAAA,sNAAa,EAA0B;AAMpD,SAAS;IACd,MAAM,UAAU,IAAA,mNAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAMO,SAAS,aAAa,EAAE,QAAQ,EAA2B;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,QAAQ,IAAA,0IAAQ;IAEtB,MAAM,YAAY;QAChB,aAAa;QACb,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,oJAAc;YACnC,IAAI,OAAO,OAAO,EAAE;gBAClB,QAAQ,OAAO,IAAI;YACrB,OAAO;gBACL,aAAa;gBACb;;gBAGA,QAAQ;YACV;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oBAAoB;YAClC,QAAQ;QACV,SAAU;YACR,aAAa;QACf;IACF;IAEA,IAAA,kNAAS,EAAC;QACR;IACF,GAAG,EAAE;IAEL,MAAM,UAAU;QACd,MAAM;IACR;IAEA,qBACE,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAC3B;YACA;YACA,iBAAiB,CAAC,CAAC;YACnB;QACF;kBACG;;;;;;AAGP"}},
    {"offset": {"line": 1453, "column": 0}, "map": {"version":3,"sources":["file:///Users/katewang/Desktop/kiwi-workbench/app/%28protected%29/ProtectedLayoutClient.tsx"],"sourcesContent":["'use client'\n\nimport { Shell } from '@/components/layout'\nimport { ToastProvider } from '@/components/shared/Toast'\nimport { UserProvider, useCurrentUser } from '@/lib/hooks/useCurrentUser'\n\n/**\n * 受保护路由客户端布局\n * \n * 包含：\n * - ToastProvider（全局 Toast 通知）\n * - UserProvider（用户状态管理）\n * - Shell（全局布局）\n */\nexport function ProtectedLayoutClient({ children }: { children: React.ReactNode }) {\n  return (\n    <ToastProvider>\n      <UserProvider>\n        <ShellWithUser>{children}</ShellWithUser>\n      </UserProvider>\n    </ToastProvider>\n  )\n}\n\n/**\n * Shell 包装组件，使用 useCurrentUser hook\n */\nfunction ShellWithUser({ children }: { children: React.ReactNode }) {\n  const { user, isLoading } = useCurrentUser()\n\n  return (\n    <Shell currentUser={user} isLoading={isLoading}>\n      {children}\n    </Shell>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AAJA;;;;;AAcO,SAAS,sBAAsB,EAAE,QAAQ,EAAiC;IAC/E,qBACE,8OAAC,+IAAa;kBACZ,cAAA,8OAAC,+IAAY;sBACX,cAAA,8OAAC;0BAAe;;;;;;;;;;;;;;;;AAIxB;AAEA;;CAEC,GACD,SAAS,cAAc,EAAE,QAAQ,EAAiC;IAChE,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,IAAA,iJAAc;IAE1C,qBACE,8OAAC,uIAAK;QAAC,aAAa;QAAM,WAAW;kBAClC;;;;;;AAGP"}}]
}