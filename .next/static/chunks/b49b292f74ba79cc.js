(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78583,e=>{"use strict";let t=(0,e.i(75254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],78583)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},3116,91741,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>r],3116);let a=(0,t.default)("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);e.s(["ClipboardList",()=>a],91741)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},70756,e=>{"use strict";let t=(0,e.i(75254).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],70756)},70065,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(6908);let s=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm",e),...r}));s.displayName="Card";let l=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...r}));l.displayName="CardHeader";let i=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("h3",{ref:s,className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("p",{ref:s,className:(0,a.cn)("text-sm text-slate-500",e),...r})).displayName="CardDescription";let n=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("p-6 pt-0",e),...r}));n.displayName="CardContent",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>n,"CardHeader",()=>l,"CardTitle",()=>i])},40160,86407,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>r],40160);let a=(0,t.default)("SearchX",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["SearchX",()=>a],86407)},75505,e=>{"use strict";let t=(0,e.i(75254).default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);e.s(["FolderOpen",()=>t],75505)},9164,e=>{"use strict";var t=e.i(43476),r=e.i(86407),a=e.i(63209),s=e.i(75505),l=e.i(70756),i=e.i(67881);let n={default:s.FolderOpen,search:r.SearchX,error:a.AlertCircle,"no-permission":l.Lock};function o({variant:e="default",icon:r,title:a,description:s,actionLabel:l,onAction:o,className:c=""}){let d=r||n[e];return(0,t.jsxs)("div",{className:`py-16 text-center ${c}`,children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center",children:(0,t.jsx)(d,{size:32,className:"text-slate-400"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:a}),s&&(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-4 max-w-sm mx-auto",children:s}),l&&o&&(0,t.jsx)(i.Button,{variant:"outline",onClick:o,children:l})]})}e.s(["EmptyState",()=>o])},41071,e=>{"use strict";let t=(0,e.i(75254).default)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);e.s(["MoreHorizontal",()=>t],41071)},20313,e=>{"use strict";var t=e.i(20755),r=e.i(44328);let a=[{id:"mat-001",title:"2024美本申请趋势解读",type:"article",source:"公众号",date:"2024-10-20",summary:"今年美本申请有这些新变化..."},{id:"mat-002",title:"文书写作避坑指南",type:"video",source:"视频号",date:"2024-10-18",summary:"分享这个视频给正在准备文书的学生"}];async function s(e){let a=(0,t.createClient)(),{page:s=1,pageSize:l=50,type:i}=e||{};try{var n,d,u;let e,{data:t,error:m}=await a.from("wechat_messages").select("room_id, from_user_id, to_user_id, content, send_time, msg_type").order("send_time",{ascending:!1}).limit(500);if(m){if(console.error("Supabase wechat_messages query failed:",m.message),"42P01"===m.code||m.message.includes("does not exist"))return(0,r.failure)({code:"TABLE_NOT_EXISTS",message:"企业微信消息表不存在，请联系管理员创建 wechat_messages 表"});if("42501"===m.code||m.message.includes("permission denied"))return(0,r.failure)({code:"PERMISSION_DENIED",message:"没有访问企业微信消息的权限"});return(0,r.failure)((0,r.createServiceError)(m,"获取会话列表失败"))}let x=(d=(n=t||[],e=new Map,n.forEach(t=>{let r;if(t.room_id)r=`room_${t.room_id}`;else if(t.from_user_id&&t.to_user_id){let e=[t.from_user_id,t.to_user_id].sort();r=`dm_${e[0]}_${e[1]}`}else r=`msg_${t.from_user_id||"unknown"}`;let a=e.get(r);!a||new Date(t.send_time||"")>new Date(a.lastMessage.send_time||"")?e.set(r,{id:r,lastMessage:t,messageCount:(a?.messageCount||0)+1}):a&&a.messageCount++}),Array.from(e.values()).map(e=>{let t=e.lastMessage,r=o(t.content);return{id:e.id,name:t.room_id?`群聊 ${t.room_id.slice(0,8)}`:`用户 ${t.from_user_id?.slice(0,8)||"Unknown"}`,type:t.room_id?"group":"student",lastMessage:r.slice(0,50)+(r.length>50?"...":""),lastMessageTime:c(t.send_time||""),unreadCount:0,isOverdue:!1}})),(u=i)&&"all"!==u?"internal"===u?d.filter(e=>"internal"===e.type||"group"===e.type):d.filter(e=>e.type===u):d),p=(s-1)*l,h=x.slice(p,p+l);return(0,r.success)({data:h,total:x.length})}catch(e){return console.error("getConversationList error:",e),(0,r.failure)((0,r.createServiceError)(e,"获取会话列表失败"))}}async function l(e,a){let s=(0,t.createClient)(),{limit:l=50,before:i}=a||{};try{let t=s.from("wechat_messages").select("*").order("send_time",{ascending:!1}).limit(l+1);if(e.startsWith("room_")){let r=e.replace("room_","");t=t.eq("room_id",r)}else if(e.startsWith("dm_")){let r=e.replace("dm_","").split("_");r.length>=2&&(t=t.or(`and(from_user_id.eq.${r[0]},to_user_id.eq.${r[1]}),and(from_user_id.eq.${r[1]},to_user_id.eq.${r[0]})`))}i&&(t=t.lt("send_time",i));let{data:a,error:o}=await t;if(o)return console.error("Supabase messages query failed:",o.message),(0,r.failure)((0,r.createServiceError)(o,"获取消息列表失败"));let c=(a?.length||0)>l,d=(a||[]).slice(0,l).map(n);return(0,r.success)({data:d.reverse(),hasMore:c})}catch(e){return console.error("getConversationMessages error:",e),(0,r.failure)((0,r.createServiceError)(e,"获取消息列表失败"))}}async function i(){return(0,r.success)(a)}function n(e){return{id:e.id,conversationId:e.room_id?`room_${e.room_id}`:`dm_${e.from_user_id}_${e.to_user_id}`,senderName:e.from_user_id?.slice(0,8)||"Unknown",senderId:e.from_user_id,content:o(e.content),timestamp:c(e.send_time),isMe:!1,type:function(e){switch(e?.toLowerCase()){case"text":default:return"text";case"image":return"image";case"voice":return"voice";case"video":return"video";case"file":return"file";case"link":return"link"}}(e.msg_type)}}function o(e){if(!e)return"[空消息]";if("string"==typeof e)return e;if(e.text)return String(e.text);if(e.content)return String(e.content);if(e.message)return String(e.message);switch(e.msgtype||e.type){case"image":return"[图片]";case"voice":return"[语音]";case"video":return"[视频]";case"file":return"[文件]";case"link":return"[链接]";case"miniprogram":return"[小程序]";case"location":return"[位置]";default:return"[消息]"}}function c(e){if(!e)return"";try{let t=new Date(e),r=new Date().getTime()-t.getTime(),a=Math.floor(r/6e4),s=Math.floor(r/36e5),l=Math.floor(r/864e5);if(a<1)return"刚刚";if(a<60)return`${a}分钟前`;if(s<24)return t.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});if(1===l)return"昨天";if(l<7)return`${l}天前`;return t.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})}catch{return e}}e.s(["getConversationList",()=>s,"getConversationMessages",()=>l,"getMarketingMaterials",()=>i])},16715,78917,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>r],16715);let a=(0,t.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>a],78917)},73477,e=>{"use strict";var t=e.i(20755),r=e.i(44328),a=e.i(20313);async function s(e){try{var t,s,l;let i,n,o,c=await (0,a.getConversationList)({pageSize:100});if(!c.success)return(0,r.failure)(c.error);let d=(s=(t=c.data.data,i=[],n=new Date,t.forEach(e=>{e.isOverdue&&i.push({id:`alert-overdue-${e.id}`,type:"response_timeout",severity:"high",title:"会话响应超时",description:`${e.name} 的会话已超时未回复`,relatedType:"conversation",relatedId:e.id,relatedName:e.name,status:"pending",createdAt:n.toISOString()}),e.unreadCount>5&&i.push({id:`alert-unread-${e.id}`,type:"response_timeout",severity:"medium",title:"未读消息堆积",description:`${e.name} 有 ${e.unreadCount} 条未读消息`,relatedType:"conversation",relatedId:e.id,relatedName:e.name,status:"pending",createdAt:n.toISOString()}),"critical"===e.riskStatus?i.push({id:`alert-risk-${e.id}`,type:"service_risk",severity:"critical",title:"高风险客户预警",description:`${e.name} 被标记为高风险状态`,relatedType:"conversation",relatedId:e.id,relatedName:e.name,status:"pending",createdAt:n.toISOString()}):"attention"===e.riskStatus&&i.push({id:`alert-attention-${e.id}`,type:"service_risk",severity:"medium",title:"客户需关注",description:`${e.name} 需要重点关注`,relatedType:"conversation",relatedId:e.id,relatedName:e.name,status:"pending",createdAt:n.toISOString()})}),i),l=e,o=[...s],l?.type&&"all"!==l.type&&(o=o.filter(e=>e.type===l.type)),l?.severity&&"all"!==l.severity&&(o=o.filter(e=>e.severity===l.severity)),l?.status&&"all"!==l.status&&(o=o.filter(e=>e.status===l.status)),l?.assignee&&(o=o.filter(e=>e.assigneeId===l.assignee)),o);return(0,r.success)(d)}catch(e){return console.error("getQualityAlerts error:",e),(0,r.failure)((0,r.createServiceError)(e,"获取预警列表失败"))}}async function l(e){let t=await s();if(!t.success)return(0,r.failure)(t.error);let a=t.data.find(t=>t.id===e);return(0,r.success)(a||null)}async function i(){try{let e=await (0,a.getConversationList)({pageSize:200}),t=0;e.success&&(t=e.data.total,e.data.data.filter(e=>e.isOverdue).length,e.data.data.filter(e=>e.unreadCount>0).length);let l=await s(),i=0,n=0,o=0;l.success&&(i=l.data.filter(e=>"pending"===e.status).length,n=l.data.filter(e=>"critical"===e.severity&&"resolved"!==e.status).length,o=l.data.filter(e=>"resolved"===e.status).length);let c=[{label:"今日会话数",value:t,color:"text-blue-600",trend:"neutral"},{label:"待处理预警",value:i,color:"text-amber-600",trend:i>3?"up":"neutral",change:i>3?i-3:void 0},{label:"紧急预警",value:n,color:"text-red-600",trend:n>0?"up":"down"},{label:"已处理",value:o,total:i+o+n,color:"text-emerald-600"}];return(0,r.success)(c)}catch(e){return console.error("getQualityMetrics error:",e),(0,r.success)([{label:"今日会话数",value:0,color:"text-blue-600"},{label:"待处理预警",value:0,color:"text-amber-600"},{label:"紧急预警",value:0,color:"text-red-600"},{label:"已处理",value:0,color:"text-emerald-600"}])}}async function n(){let e=await s();if(!e.success)return(0,r.failure)(e.error);let t=e.data,a={},l={},i={};return t.forEach(e=>{a[e.type]=(a[e.type]||0)+1,l[e.severity]=(l[e.severity]||0)+1,i[e.status]=(i[e.status]||0)+1}),(0,r.success)({byType:a,bySeverity:l,byStatus:i})}async function o(){let e=await s({status:"pending"});return e.success?(0,r.success)(e.data.length):(0,r.failure)(e.error)}async function c(e=5){let t=await s();if(!t.success)return(0,r.failure)(t.error);let a=[...t.data].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,e);return(0,r.success)(a)}async function d(e){let a=(0,t.createClient)();try{let{data:{user:t}}=await a.auth.getUser(),l={alert_id:e.alertId,alert_type:"manual_resolve",status:"resolved",notes:e.notes||null,reviewed_by:t?.id||null,reviewed_at:new Date().toISOString()},{error:i}=await a.from("quality_reviews").upsert(l,{onConflict:"alert_id"});if(i){if(console.error("Resolve alert error:",i),"42P01"===i.code||i.message.includes("does not exist"))return(0,r.failure)({code:"TABLE_NOT_EXISTS",message:"quality_reviews 表不存在，请联系管理员创建"});if("42501"===i.code||i.message.includes("permission denied"))return(0,r.failure)({code:"PERMISSION_DENIED",message:"没有处理预警的权限"});return(0,r.failure)((0,r.createServiceError)(i,"处理预警失败"))}let n=await s();if(n.success){let t=n.data.find(t=>t.id===e.alertId);if(t)return(0,r.success)({...t,status:"resolved",resolvedAt:new Date().toISOString()})}return(0,r.success)({id:e.alertId,type:"response_timeout",severity:"low",title:"已处理",description:"",relatedType:"conversation",relatedId:"",relatedName:"",status:"resolved",createdAt:new Date().toISOString(),resolvedAt:new Date().toISOString()})}catch(e){return console.error("resolveAlert error:",e),(0,r.failure)((0,r.createServiceError)(e,"处理预警失败"))}}async function u(e,a){let s=(0,t.createClient)();try{let{data:{user:t}}=await s.auth.getUser(),l={alert_id:e,alert_type:"ignored",status:"ignored",notes:a||"用户忽略",reviewed_by:t?.id||null,reviewed_at:new Date().toISOString()},{error:i}=await s.from("quality_reviews").upsert(l,{onConflict:"alert_id"});if(i){if("42P01"===i.code)return(0,r.failure)({code:"TABLE_NOT_EXISTS",message:"quality_reviews 表不存在"});return(0,r.failure)((0,r.createServiceError)(i,"忽略预警失败"))}return(0,r.success)(void 0)}catch(e){return(0,r.failure)((0,r.createServiceError)(e,"忽略预警失败"))}}async function m(e,t){let a=0;for(let r of e)(await d({alertId:r,notes:t})).success&&a++;return(0,r.success)(a)}e.s(["batchResolveAlerts",()=>m,"getAlertById",()=>l,"getAlertStats",()=>n,"getPendingAlertsCount",()=>o,"getQualityAlerts",()=>s,"getQualityMetrics",()=>i,"getRecentAlerts",()=>c,"ignoreAlert",()=>u,"resolveAlert",()=>d])},27111,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(75254);let s=(0,a.default)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var l=e.i(40160),i=e.i(16715),n=e.i(70065),o=e.i(22016),c=e.i(3116),d=e.i(87316),u=e.i(78894);let m=(0,a.default)("Frown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 16s-1.5-2-4-2-4 2-4 2",key:"epbg0q"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),x=(0,a.default)("MessageSquareWarning",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v2",key:"stiyo7"}],["path",{d:"M12 13h.01",key:"y0uutt"}]]);var p=e.i(91741),h=e.i(78583),g=e.i(41071),f=e.i(84614),y=e.i(78917),v=e.i(94179),b=e.i(9164);let j={response_timeout:{label:"响应超时",icon:"Clock",color:"text-amber-600"},follow_up_overdue:{label:"跟进逾期",icon:"Calendar",color:"text-orange-600"},service_risk:{label:"服务风险",icon:"AlertTriangle",color:"text-red-600"},negative_sentiment:{label:"负面情绪",icon:"Frown",color:"text-purple-600"},complaint:{label:"投诉预警",icon:"MessageSquareWarning",color:"text-red-700"},task_overdue:{label:"任务逾期",icon:"ClipboardList",color:"text-amber-700"},contract_expiring:{label:"合同到期",icon:"FileText",color:"text-blue-600"}},k={low:{label:"低",color:"text-slate-600",bgColor:"bg-slate-100"},medium:{label:"中",color:"text-amber-600",bgColor:"bg-amber-100"},high:{label:"高",color:"text-orange-600",bgColor:"bg-orange-100"},critical:{label:"紧急",color:"text-red-600",bgColor:"bg-red-100"}},w={pending:{label:"待处理",color:"text-amber-600"},processing:{label:"处理中",color:"text-blue-600"},resolved:{label:"已解决",color:"text-emerald-600"},ignored:{label:"已忽略",color:"text-slate-400"}},_={Clock:c.Clock,Calendar:d.Calendar,AlertTriangle:u.AlertTriangle,Frown:m,MessageSquareWarning:x,ClipboardList:p.ClipboardList,FileText:h.FileText};function N({alerts:e,onAlertClick:r,onResolve:a,emptyTitle:s="暂无预警",emptyDescription:l="当前没有需要处理的预警"}){return 0===e.length?(0,t.jsx)(b.EmptyState,{variant:"default",title:s,description:l,icon:u.AlertTriangle}):(0,t.jsx)("div",{className:"divide-y divide-slate-100",children:e.map(e=>(0,t.jsx)(C,{alert:e,onClick:()=>r?.(e),onResolve:()=>a?.(e)},e.id))})}function C({alert:e,onClick:r,onResolve:a}){let s=j[e.type],l=k[e.severity],i=w[e.status],n=_[s.icon]||u.AlertTriangle;return(0,t.jsx)("div",{className:`p-4 hover:bg-slate-50 transition-colors cursor-pointer ${"resolved"===e.status?"opacity-60":""}`,onClick:r,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l.bgColor}`,children:(0,t.jsx)(n,{size:20,className:l.color})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h4",{className:"font-medium text-slate-900 truncate",children:e.title}),(0,t.jsx)(v.Badge,{variant:"outline",className:`text-[10px] ${l.color}`,children:l.label}),(0,t.jsx)(v.Badge,{variant:"secondary",className:`text-[10px] ${i.color}`,children:i.label})]}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-slate-400",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(c.Clock,{size:12}),e.createdAt]}),e.assignee&&(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(f.User,{size:12}),e.assignee]}),(0,t.jsxs)(o.default,{href:`/${"conversation"===e.relatedType?"messages":"customer"===e.relatedType?"sales/customers/"+e.relatedId:"projects"}`,className:"flex items-center gap-1 text-brand-600 hover:text-brand-700",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)(y.ExternalLink,{size:12}),e.relatedName]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:["pending"===e.status&&(0,t.jsx)("button",{onClick:a,className:"px-3 py-1.5 text-xs font-medium bg-brand-50 text-brand-700 rounded-lg hover:bg-brand-100 transition-colors",children:"处理"}),(0,t.jsx)("button",{className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded",children:(0,t.jsx)(g.MoreHorizontal,{size:16})})]})]})})}let S=(0,a.default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),M=(0,a.default)("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);function T({metrics:e}){return(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:e.map((e,r)=>(0,t.jsx)(A,{metric:e},r))})}function A({metric:e}){return(0,t.jsx)(n.Card,{className:"hover:shadow-md transition-shadow",children:(0,t.jsxs)(n.CardContent,{className:"p-5",children:[(0,t.jsx)("div",{className:"text-slate-500 text-sm font-medium mb-1",children:e.label}),(0,t.jsxs)("div",{className:"flex items-end justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:`text-3xl font-bold ${e.color||"text-slate-900"}`,children:e.value}),void 0!==e.total&&(0,t.jsxs)("span",{className:"text-lg text-slate-400 ml-1",children:["/ ",e.total]})]}),void 0!==e.change&&e.trend&&(0,t.jsxs)("div",{className:`text-xs font-medium flex items-center gap-1 ${"up"===e.trend?"text-red-500":"down"===e.trend?"text-emerald-600":"text-slate-500"}`,children:["up"===e.trend?(0,t.jsx)(S,{size:14}):"down"===e.trend?(0,t.jsx)(M,{size:14}):null,e.change>0?"+":"",e.change]})]})]})})}var $=e.i(71689),E=e.i(67881);function I({title:e,description:r,backHref:a,badges:s,actions:l,children:i,className:n=""}){return(0,t.jsxs)("div",{className:`px-6 py-5 bg-white border-b border-slate-200 shadow-sm ${n}`,children:[(0,t.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[a&&(0,t.jsx)(o.default,{href:a,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors mt-0.5",children:(0,t.jsx)($.ArrowLeft,{size:20,className:"text-slate-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:e}),s&&s.map((e,r)=>(0,t.jsx)(v.Badge,{variant:e.variant,children:e.label},r))]}),r&&(0,t.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:r})]})]}),l&&l.length>0&&(0,t.jsx)("div",{className:"flex gap-3",children:l.map((e,r)=>{let a=e.icon,s=(0,t.jsxs)(E.Button,{variant:e.variant||"default",onClick:e.onClick,children:[a&&(0,t.jsx)(a,{size:16,className:"mr-2"}),e.label]},r);return e.href?(0,t.jsx)(o.default,{href:e.href,children:s},r):s})})]}),i]})}var z=e.i(44328),L=e.i(73477);function q(){let e=(0,z.useToast)(),[a,o]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(!0),[x,p]=(0,r.useState)("all"),[h,g]=(0,r.useState)("all"),[f,y]=(0,r.useState)("pending");(0,r.useEffect)(()=>{v()},[x,h,f]);let v=async()=>{m(!0);let[t,r]=await Promise.all([(0,L.getQualityAlerts)({type:x,severity:h,status:f}),(0,L.getQualityMetrics)()]);t.success?o(t.data):(e.error("加载预警列表失败",t.error.message),o([])),r.success?d(r.data):d([]),m(!1)},b=async t=>{let r=await (0,L.resolveAlert)({alertId:t.id});r.success?(e.success("处理成功",`预警 "${t.title}" 已标记为已处理`),v()):e.error("处理失败",r.error.message)},w="all"!==x||"all"!==h||"pending"!==f;return(0,t.jsxs)("div",{className:"min-h-[calc(100vh-64px)] bg-slate-50/50",children:[(0,t.jsx)(I,{title:"管理质检中心",description:"监控服务质量，及时处理风险预警",actions:[{label:"导出报告",icon:l.Download,variant:"outline",onClick:()=>console.log("Export")},{label:"刷新",icon:i.RefreshCw,variant:"outline",onClick:()=>{v(),e.info("刷新中","正在重新加载数据")}}]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)(T,{metrics:c}),(0,t.jsxs)(n.Card,{className:"border-0 shadow-sm ring-1 ring-slate-200",children:[(0,t.jsx)(n.CardHeader,{className:"border-b border-slate-100",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(s,{size:18,className:"text-brand-600"}),"风险预警列表"]}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:(0,t.jsx)("div",{className:"flex items-center gap-1 bg-slate-100 p-1 rounded-lg",children:[{key:"pending",label:"待处理"},{key:"processing",label:"处理中"},{key:"resolved",label:"已解决"},{key:"all",label:"全部"}].map(e=>(0,t.jsx)("button",{onClick:()=>y(e.key),className:`px-3 py-1 text-xs font-medium rounded-md transition-all ${f===e.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"}`,children:e.label},e.key))})})]})}),(0,t.jsxs)("div",{className:"px-6 py-3 border-b border-slate-100 bg-slate-50/50 flex items-center gap-3",children:[(0,t.jsxs)("select",{value:x,onChange:e=>p(e.target.value),className:"px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,t.jsx)("option",{value:"all",children:"全部类型"}),Object.entries(j).map(([e,r])=>(0,t.jsx)("option",{value:e,children:r.label},e))]}),(0,t.jsxs)("select",{value:h,onChange:e=>g(e.target.value),className:"px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,t.jsx)("option",{value:"all",children:"全部严重程度"}),Object.entries(k).map(([e,r])=>(0,t.jsx)("option",{value:e,children:r.label},e))]}),w&&(0,t.jsx)("button",{onClick:()=>{p("all"),g("all"),y("pending")},className:"text-sm text-brand-600 hover:text-brand-700 font-medium",children:"重置筛选"}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsxs)("span",{className:"text-sm text-slate-500",children:["共 ",(0,t.jsx)("span",{className:"font-medium text-slate-900",children:a.length})," 条预警"]})]}),(0,t.jsx)(n.CardContent,{className:"p-0",children:u?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-500 border-t-transparent rounded-full"})}):(0,t.jsx)(N,{alerts:a,onAlertClick:e=>console.log("Click alert:",e.id),onResolve:b,emptyTitle:w?"没有找到匹配的预警":"暂无待处理预警",emptyDescription:w?"尝试调整筛选条件":"当前没有需要处理的风险预警"})})]})]})]})}e.s(["default",()=>q],27111)},5258,e=>{e.v(e=>Promise.resolve().then(()=>e(73477)))}]);