(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87316,e=>{"use strict";let t=(0,e.i(75254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},70756,e=>{"use strict";let t=(0,e.i(75254).default)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);e.s(["Lock",()=>t],70756)},70065,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(6908);let l=s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:(0,a.cn)("rounded-xl border border-slate-200 bg-white text-slate-900 shadow-sm",e),...s}));l.displayName="Card";let r=s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...s}));r.displayName="CardHeader";let n=s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("h3",{ref:l,className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));n.displayName="CardTitle",s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("p",{ref:l,className:(0,a.cn)("text-sm text-slate-500",e),...s})).displayName="CardDescription";let i=s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:(0,a.cn)("p-6 pt-0",e),...s}));i.displayName="CardContent",s.forwardRef(({className:e,...s},l)=>(0,t.jsx)("div",{ref:l,className:(0,a.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter",e.s(["Card",()=>l,"CardContent",()=>i,"CardHeader",()=>r,"CardTitle",()=>n])},40160,86407,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>s],40160);let a=(0,t.default)("SearchX",[["path",{d:"m13.5 8.5-5 5",key:"1cs55j"}],["path",{d:"m8.5 8.5 5 5",key:"a8mexj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["SearchX",()=>a],86407)},75505,e=>{"use strict";let t=(0,e.i(75254).default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);e.s(["FolderOpen",()=>t],75505)},9164,e=>{"use strict";var t=e.i(43476),s=e.i(86407),a=e.i(63209),l=e.i(75505),r=e.i(70756),n=e.i(67881);let i={default:l.FolderOpen,search:s.SearchX,error:a.AlertCircle,"no-permission":r.Lock};function o({variant:e="default",icon:s,title:a,description:l,actionLabel:r,onAction:o,className:d=""}){let c=s||i[e];return(0,t.jsxs)("div",{className:`py-16 text-center ${d}`,children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center",children:(0,t.jsx)(c,{size:32,className:"text-slate-400"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-slate-900 mb-1",children:a}),l&&(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-4 max-w-sm mx-auto",children:l}),r&&o&&(0,t.jsx)(n.Button,{variant:"outline",onClick:o,children:r})]})}e.s(["EmptyState",()=>o])},97548,e=>{"use strict";let t=(0,e.i(75254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],97548)},63059,e=>{"use strict";let t=(0,e.i(75254).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},88869,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(22016),l=e.i(55436),r=e.i(97548),n=e.i(40160),i=e.i(64659),o=e.i(43432),d=e.i(87316),c=e.i(63209),u=e.i(78894),m=e.i(95468),x=e.i(7233),h=e.i(61911),g=e.i(75254);let p=(0,g.default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var b=e.i(63059);let f=(0,g.default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),v=(0,g.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var j=e.i(70065),y=e.i(67881),N=e.i(63270),w=e.i(9164),k=e.i(44328),C=e.i(37727),S=e.i(20755);let z={new:{label:"新咨询",color:"bg-blue-100 text-blue-700"},following:{label:"跟进中",color:"bg-purple-100 text-purple-700"},proposal:{label:"方案制定",color:"bg-amber-100 text-amber-700"},signed:{label:"已签约",color:"bg-emerald-100 text-emerald-700"},lost:{label:"已流失",color:"bg-slate-100 text-slate-500"}},_={low:{label:"正常",color:"text-emerald-600",bgColor:"bg-emerald-50"},medium:{label:"需关注",color:"text-amber-600",bgColor:"bg-amber-50"},high:{label:"高风险",color:"text-red-600",bgColor:"bg-red-50"}},A=[{id:"cust-001",name:"Emily Zhang",phone:"+86 138****0001",email:"emily.z@example.com",wechat:"emily_dream_big",tags:["VIP","高二","美本"],stage:"signed",riskLevel:"low",owner:"Sarah Wu",ownerId:"user-002",source:"小红书",lastContact:"2小时前",nextAction:"文书审核",nextActionDate:"2024-11-01",createdAt:"2024-09-15",updatedAt:"2024-10-24",studentName:"Emily Zhang",grade:"高二",targetCountry:"美国",budget:"50万+"}];async function $(e){let t=(0,S.createClient)(),{search:s,stage:a,owner:l,riskLevel:r,page:n=1,pageSize:i=20}=e||{};try{let e=t.from("customers").select("*",{count:"exact"});s&&(e=e.or(`name.ilike.%${s}%,phone.ilike.%${s}%`)),a&&"all"!==a&&(e=e.eq("stage",a)),l&&(e=e.eq("assigned_to",l)),r&&"all"!==r&&(e=e.eq("risk_level",r));let o=(n-1)*i;e=e.range(o,o+i-1).order("updated_at",{ascending:!1});let{data:d,error:c,count:u}=await e;if(c)return console.warn("Supabase query failed, using mock data:",c.message),(0,k.success)({data:A,total:A.length});let m=(d||[]).map(M);return(0,k.success)({data:m,total:u||0})}catch(e){return console.error("getCustomers error:",e),(0,k.success)({data:A,total:A.length})}}function M(e){var t;let s,a,l,r,n;return{id:e.id,name:e.name,phone:e.phone||"",email:e.email||void 0,wechat:e.wechat||void 0,tags:e.tags||[],stage:e.stage,riskLevel:e.risk_level||"low",owner:e.assigned_to||"未分配",ownerId:e.assigned_to||"",source:e.source||"",lastContact:(s=new Date(t=e.updated_at),l=Math.floor((a=new Date().getTime()-s.getTime())/6e4),r=Math.floor(a/36e5),n=Math.floor(a/864e5),l<60?`${l}分钟前`:r<24?`${r}小时前`:n<7?`${n}天前`:D(t)),nextAction:e.next_action||"",nextActionDate:e.next_action_date||void 0,createdAt:D(e.created_at),updatedAt:D(e.updated_at),studentName:e.student_name||void 0,grade:e.grade||void 0,targetCountry:e.target_country||void 0,budget:e.budget||void 0,notes:e.notes||void 0}}function D(e){return new Date(e).toLocaleDateString("zh-CN")}async function T(e){let t=(0,S.createClient)();try{let s={name:e.name,phone:e.phone||null,email:e.email||null,wechat:e.wechat||null,source:e.source||null,stage:e.stage||"new",tags:e.tags||null,notes:e.notes||null,student_name:e.studentName||null,grade:e.grade||null,target_country:e.targetCountry||null,budget:e.budget||null,assigned_to:e.assignedTo||null,risk_level:"low"},{data:a,error:l}=await t.from("customers").insert(s).select().single();if(l){if(console.error("Create customer error:",l),"42501"===l.code||l.message.includes("permission denied"))return(0,k.failure)({code:"PERMISSION_DENIED",message:"没有创建客户的权限，请联系管理员"});if("23505"===l.code)return(0,k.failure)({code:"DUPLICATE",message:"该客户已存在（手机号或邮箱重复）"});return(0,k.failure)((0,k.createServiceError)(l,"创建客户失败"))}return(0,k.success)(M(a))}catch(e){return console.error("createCustomer error:",e),(0,k.failure)((0,k.createServiceError)(e,"创建客户失败"))}}async function E(e,t){let s=(0,S.createClient)();try{let a={};void 0!==t.name&&(a.name=t.name),void 0!==t.phone&&(a.phone=t.phone||null),void 0!==t.email&&(a.email=t.email||null),void 0!==t.wechat&&(a.wechat=t.wechat||null),void 0!==t.source&&(a.source=t.source||null),void 0!==t.stage&&(a.stage=t.stage),void 0!==t.riskLevel&&(a.risk_level=t.riskLevel),void 0!==t.tags&&(a.tags=t.tags),void 0!==t.notes&&(a.notes=t.notes||null),void 0!==t.nextAction&&(a.next_action=t.nextAction||null),void 0!==t.nextActionDate&&(a.next_action_date=t.nextActionDate||null),void 0!==t.studentName&&(a.student_name=t.studentName||null),void 0!==t.grade&&(a.grade=t.grade||null),void 0!==t.targetCountry&&(a.target_country=t.targetCountry||null),void 0!==t.budget&&(a.budget=t.budget||null),void 0!==t.assignedTo&&(a.assigned_to=t.assignedTo||null);let{data:l,error:r}=await s.from("customers").update(a).eq("id",e).select().single();if(r){if(console.error("Update customer error:",r),"42501"===r.code||r.message.includes("permission denied"))return(0,k.failure)({code:"PERMISSION_DENIED",message:"没有编辑客户的权限"});if("PGRST116"===r.code)return(0,k.failure)({code:"NOT_FOUND",message:"客户不存在"});return(0,k.failure)((0,k.createServiceError)(r,"更新客户失败"))}return(0,k.success)(M(l))}catch(e){return console.error("updateCustomer error:",e),(0,k.failure)((0,k.createServiceError)(e,"更新客户失败"))}}async function P(e,t){return E(e,{stage:t})}async function R(e){let t=await E(e,{stage:"lost"});return t.success?(0,k.success)(void 0):(0,k.failure)(t.error)}function L({customer:e,onSuccess:a,onCancel:l}){let r=(0,k.useToast)(),n=!!e,[i,o]=(0,s.useState)({name:e?.name||"",phone:e?.phone||"",email:e?.email||"",wechat:e?.wechat||"",source:e?.source||"",stage:e?.stage||"new",tags:e?.tags?.join(", ")||"",notes:e?.notes||"",studentName:e?.studentName||"",grade:e?.grade||"",targetCountry:e?.targetCountry||"",budget:e?.budget||""}),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)({}),x=(e,t)=>{o(s=>({...s,[e]:t})),u[e]&&m(t=>{let s={...t};return delete s[e],s})},h=async t=>{let s;if(t.preventDefault(),s={},i.name.trim()||(s.name="请输入客户姓名"),i.phone&&!/^[\d\s\-+()]+$/.test(i.phone)&&(s.phone="请输入有效的手机号"),i.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)&&(s.email="请输入有效的邮箱"),m(s),0!==Object.keys(s).length)return;c(!0);let l=i.tags.split(",").map(e=>e.trim()).filter(e=>e);if(n&&e){let t={name:i.name,phone:i.phone||void 0,email:i.email||void 0,wechat:i.wechat||void 0,source:i.source||void 0,stage:i.stage,tags:l.length>0?l:void 0,notes:i.notes||void 0,studentName:i.studentName||void 0,grade:i.grade||void 0,targetCountry:i.targetCountry||void 0,budget:i.budget||void 0},s=await E(e.id,t);s.success?(r.success("更新成功","客户信息已更新"),a(s.data)):r.error("更新失败",s.error.message)}else{let e={name:i.name,phone:i.phone||void 0,email:i.email||void 0,wechat:i.wechat||void 0,source:i.source||void 0,stage:i.stage,tags:l.length>0?l:void 0,notes:i.notes||void 0,studentName:i.studentName||void 0,grade:i.grade||void 0,targetCountry:i.targetCountry||void 0,budget:i.budget||void 0},t=await T(e);t.success?(r.success("创建成功","新客户已添加"),a(t.data)):r.error("创建失败",t.error.message)}c(!1)};return(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-slate-200",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:n?"编辑客户":"新建客户"}),(0,t.jsx)("button",{onClick:l,className:"p-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100",children:(0,t.jsx)(C.X,{size:20})})]}),(0,t.jsx)("form",{onSubmit:h,className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"col-span-2",children:(0,t.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"基本信息"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["客户姓名 ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)("input",{type:"text",value:i.name,onChange:e=>x("name",e.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${u.name?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入客户姓名"}),u.name&&(0,t.jsx)("p",{className:"text-xs text-red-500 mt-1",children:u.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"手机号"}),(0,t.jsx)("input",{type:"tel",value:i.phone,onChange:e=>x("phone",e.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${u.phone?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入手机号"}),u.phone&&(0,t.jsx)("p",{className:"text-xs text-red-500 mt-1",children:u.phone})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"邮箱"}),(0,t.jsx)("input",{type:"email",value:i.email,onChange:e=>x("email",e.target.value),className:`w-full px-3 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 ${u.email?"border-red-300 bg-red-50":"border-slate-200"}`,placeholder:"输入邮箱"}),u.email&&(0,t.jsx)("p",{className:"text-xs text-red-500 mt-1",children:u.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"微信号"}),(0,t.jsx)("input",{type:"text",value:i.wechat,onChange:e=>x("wechat",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"输入微信号"})]}),(0,t.jsx)("div",{className:"col-span-2 mt-4",children:(0,t.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"销售信息"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"客户来源"}),(0,t.jsx)("input",{type:"text",value:i.source,onChange:e=>x("source",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"如：小红书、转介绍、官网"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"客户阶段"}),(0,t.jsx)("select",{value:i.stage,onChange:e=>x("stage",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:Object.entries(z).map(([e,s])=>(0,t.jsx)("option",{value:e,children:s.label},e))})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"标签"}),(0,t.jsx)("input",{type:"text",value:i.tags,onChange:e=>x("tags",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"用逗号分隔，如：VIP, 美本, 高意向"})]}),(0,t.jsx)("div",{className:"col-span-2 mt-4",children:(0,t.jsx)("h3",{className:"text-sm font-medium text-slate-700 mb-3",children:"学员信息"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"学员姓名"}),(0,t.jsx)("input",{type:"text",value:i.studentName,onChange:e=>x("studentName",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"输入学员姓名"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"年级"}),(0,t.jsxs)("select",{value:i.grade,onChange:e=>x("grade",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,t.jsx)("option",{value:"",children:"请选择"}),(0,t.jsx)("option",{value:"初一",children:"初一"}),(0,t.jsx)("option",{value:"初二",children:"初二"}),(0,t.jsx)("option",{value:"初三",children:"初三"}),(0,t.jsx)("option",{value:"高一",children:"高一"}),(0,t.jsx)("option",{value:"高二",children:"高二"}),(0,t.jsx)("option",{value:"高三",children:"高三"}),(0,t.jsx)("option",{value:"大一",children:"大一"}),(0,t.jsx)("option",{value:"大二",children:"大二"}),(0,t.jsx)("option",{value:"大三",children:"大三"}),(0,t.jsx)("option",{value:"大四",children:"大四"}),(0,t.jsx)("option",{value:"研一",children:"研一"}),(0,t.jsx)("option",{value:"研二",children:"研二"}),(0,t.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"目标国家"}),(0,t.jsx)("input",{type:"text",value:i.targetCountry,onChange:e=>x("targetCountry",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",placeholder:"如：美国、英国、美国/英国"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"预算范围"}),(0,t.jsxs)("select",{value:i.budget,onChange:e=>x("budget",e.target.value),className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,t.jsx)("option",{value:"",children:"请选择"}),(0,t.jsx)("option",{value:"10万以下",children:"10万以下"}),(0,t.jsx)("option",{value:"10-30万",children:"10-30万"}),(0,t.jsx)("option",{value:"30-50万",children:"30-50万"}),(0,t.jsx)("option",{value:"50万+",children:"50万+"})]})]}),(0,t.jsxs)("div",{className:"col-span-2 mt-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"备注"}),(0,t.jsx)("textarea",{value:i.notes,onChange:e=>x("notes",e.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 resize-none",placeholder:"输入备注信息..."})]})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-slate-200 bg-slate-50",children:[(0,t.jsx)(y.Button,{variant:"outline",onClick:l,disabled:d,children:"取消"}),(0,t.jsx)(y.Button,{onClick:h,disabled:d,children:d?"提交中...":n?"保存":"创建"})]})]})})}let F=(0,g.default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function O({customer:e,onUpdate:a}){let l=(0,k.useToast)(),[r,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),c=z[e.stage],u=async t=>{if(t===e.stage)return void n(!1);d(!0);let s=await P(e.id,t);s.success?(l.success("更新成功",`已将 ${e.name} 更新为"${z[t].label}"`),a(s.data)):l.error("更新失败",s.error.message),d(!1),n(!1)};return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>n(!r),disabled:o,className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-md transition-colors ${c.color} ${o?"opacity-50 cursor-wait":"hover:opacity-80 cursor-pointer"}`,children:[o?"更新中...":c.label,(0,t.jsx)(i.ChevronDown,{size:12})]}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),(0,t.jsx)("div",{className:"absolute left-0 top-full mt-1 z-20 bg-white border border-slate-200 rounded-lg shadow-lg py-1 min-w-[120px]",children:Object.entries(z).map(([s,a])=>(0,t.jsxs)("button",{onClick:()=>u(s),className:`w-full flex items-center justify-between gap-2 px-3 py-2 text-sm hover:bg-slate-50 ${s===e.stage?"text-brand-600 font-medium":"text-slate-700"}`,children:[(0,t.jsx)("span",{className:`inline-block w-2 h-2 rounded-full ${a.color.split(" ")[0]}`}),(0,t.jsx)("span",{className:"flex-1 text-left",children:a.label}),s===e.stage&&(0,t.jsx)(F,{size:14,className:"text-brand-600"})]},s))})]})]})}function q(){let e=(0,k.useToast)(),[g,C]=(0,s.useState)([]),[S,A]=(0,s.useState)(0),[M,D]=(0,s.useState)(!0),[T,E]=(0,s.useState)(new Set),[P,F]=(0,s.useState)(""),[q,I]=(0,s.useState)("my"),[B,H]=(0,s.useState)("all"),[U,V]=(0,s.useState)(1),[X,K]=(0,s.useState)(!1),[Z,G]=(0,s.useState)(null),W=async()=>{D(!0);let t=await $({search:P||void 0,stage:B,page:U,pageSize:20});t.success?(C(t.data.data),A(t.data.total)):e.error("加载客户列表失败",t.error.message),D(!1)};(0,s.useEffect)(()=>{W()},[P,B,U]);let[J,Q]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=setTimeout(()=>{F(J),V(1)},300);return()=>clearTimeout(e)},[J]);let Y=Math.ceil(S/20),ee=async t=>{if(!confirm(`确定要将 ${t.name} 标记为已流失吗？`))return;let s=await R(t.id);s.success?(e.success("操作成功",`${t.name} 已标记为已流失`),W()):e.error("操作失败",s.error.message)},et=e=>{C(t=>t.map(t=>t.id===e.id?e:t))};return(0,t.jsxs)("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden bg-slate-50/50",children:[X&&(0,t.jsx)(L,{customer:Z,onSuccess:e=>{K(!1),G(null),W()},onCancel:()=>{K(!1),G(null)}}),(0,t.jsxs)("div",{className:"px-6 py-5 bg-white border-b border-slate-200 shadow-sm flex-shrink-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:"客户列表"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:"管理您的客户资源，跟踪销售进度"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(y.Button,{variant:"outline",children:[(0,t.jsx)(n.Download,{size:16,className:"mr-2"}),"导出"]}),(0,t.jsxs)(y.Button,{onClick:()=>{G(null),K(!0)},children:[(0,t.jsx)(x.Plus,{size:16,className:"mr-2"}),"新建客户"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"flex items-center gap-1 bg-slate-100 p-1 rounded-lg",children:[{key:"all",label:"全部客户"},{key:"my",label:"我的客户"},{key:"team",label:"团队公海"}].map(e=>(0,t.jsx)("button",{onClick:()=>I(e.key),className:`px-4 py-1.5 text-xs font-semibold rounded-md transition-all ${q===e.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"}`,children:e.label},e.key))}),(0,t.jsxs)("div",{className:"relative w-80",children:[(0,t.jsx)(l.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),(0,t.jsx)("input",{type:"text",value:J,onChange:e=>Q(e.target.value),placeholder:"搜索姓名、手机号...",className:"w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("select",{value:B,onChange:e=>{H(e.target.value),V(1)},className:"px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 focus:outline-none focus:ring-2 focus:ring-brand-500",children:[(0,t.jsx)("option",{value:"all",children:"全部阶段"}),(0,t.jsx)("option",{value:"new",children:"新咨询"}),(0,t.jsx)("option",{value:"following",children:"跟进中"}),(0,t.jsx)("option",{value:"proposal",children:"方案制定"}),(0,t.jsx)("option",{value:"signed",children:"已签约"}),(0,t.jsx)("option",{value:"lost",children:"已流失"})]}),(0,t.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,t.jsx)("span",{className:"font-medium",children:"负责人"}),(0,t.jsx)(i.ChevronDown,{size:14,className:"text-slate-400"})]}),(0,t.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,t.jsx)("span",{className:"font-medium",children:"风险等级"}),(0,t.jsx)(i.ChevronDown,{size:14,className:"text-slate-400"})]}),(0,t.jsxs)("button",{className:"flex items-center gap-2 px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm text-slate-600 hover:border-brand-300",children:[(0,t.jsx)(r.Filter,{size:14}),(0,t.jsx)("span",{className:"font-medium",children:"更多筛选"})]}),(P||"all"!==B)&&(0,t.jsx)("button",{onClick:()=>{F(""),H("all")},className:"text-sm text-brand-600 hover:text-brand-700 font-medium",children:"重置筛选"})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-auto p-6",children:(0,t.jsx)(j.Card,{className:"overflow-hidden border-0 shadow-sm ring-1 ring-slate-200",children:M?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin w-8 h-8 border-2 border-brand-500 border-t-transparent rounded-full"})}):g.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50 border-b border-slate-200 text-slate-500 font-semibold",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-4 w-14",children:(0,t.jsx)("input",{type:"checkbox",checked:T.size===g.length&&g.length>0,onChange:()=>{T.size===g.length?E(new Set):E(new Set(g.map(e=>e.id)))},className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"})}),(0,t.jsx)("th",{className:"px-4 py-4",children:"客户信息"}),(0,t.jsx)("th",{className:"px-4 py-4",children:"阶段"}),(0,t.jsx)("th",{className:"px-4 py-4",children:"负责人"}),(0,t.jsx)("th",{className:"px-4 py-4",children:"最近跟进"}),(0,t.jsx)("th",{className:"px-4 py-4",children:"风险"}),(0,t.jsx)("th",{className:"px-4 py-4 text-right",children:"操作"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:g.map(e=>{z[e.stage];let s=_[e.riskLevel];return(0,t.jsxs)("tr",{className:"hover:bg-slate-50/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-6 py-4",children:(0,t.jsx)("input",{type:"checkbox",checked:T.has(e.id),onChange:()=>{var t;let s;return t=e.id,void((s=new Set(T)).has(t)?s.delete(t):s.add(t),E(s))},className:"rounded border-slate-300 text-brand-600 focus:ring-brand-500"})}),(0,t.jsxs)("td",{className:"px-4 py-4",children:[(0,t.jsxs)(a.default,{href:`/sales/customers/${e.id}`,className:"flex items-center gap-3 group",children:[(0,t.jsx)(N.Avatar,{className:"h-10 w-10",children:(0,t.jsx)(N.AvatarFallback,{className:"bg-brand-100 text-brand-700 text-xs",children:e.name.slice(0,2)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900 group-hover:text-brand-600 transition-colors",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 flex items-center gap-2 mt-0.5",children:[(0,t.jsx)(o.Phone,{size:10}),e.phone]})]})]}),e.tags.length>0&&(0,t.jsx)("div",{className:"flex gap-1 mt-2",children:e.tags.slice(0,3).map(e=>(0,t.jsx)("span",{className:"text-[10px] bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded",children:e},e))})]}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsx)(O,{customer:e,onUpdate:et})}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(N.Avatar,{className:"h-6 w-6",children:(0,t.jsx)(N.AvatarFallback,{className:"text-[10px] bg-slate-200",children:e.owner.slice(0,1)})}),(0,t.jsx)("span",{className:"text-slate-700",children:e.owner})]})}),(0,t.jsxs)("td",{className:"px-4 py-4",children:[(0,t.jsx)("div",{className:"text-slate-900",children:e.lastContact}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 mt-0.5 flex items-center gap-1",children:[(0,t.jsx)(d.Calendar,{size:10}),e.nextAction]})]}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsxs)("div",{className:`flex items-center gap-1.5 ${s.color}`,children:[(e=>{switch(e){case"high":return(0,t.jsx)(c.AlertCircle,{size:14,className:"text-red-500"});case"medium":return(0,t.jsx)(u.AlertTriangle,{size:14,className:"text-amber-500"});default:return(0,t.jsx)(m.CheckCircle2,{size:14,className:"text-emerald-500"})}})(e.riskLevel),(0,t.jsx)("span",{className:"text-xs font-medium",children:s.label})]})}),(0,t.jsx)("td",{className:"px-4 py-4 text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,t.jsx)("button",{onClick:()=>{G(e),K(!0)},className:"p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded",title:"编辑",children:(0,t.jsx)(f,{size:14})}),(0,t.jsx)(a.default,{href:`/sales/customers/${e.id}`,children:(0,t.jsx)(y.Button,{variant:"ghost",size:"sm",children:"查看"})}),"lost"!==e.stage&&(0,t.jsx)("button",{onClick:()=>ee(e),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded",title:"标记流失",children:(0,t.jsx)(v,{size:14})})]})})]},e.id)})})]}),(0,t.jsxs)("div",{className:"px-6 py-4 border-t border-slate-200 flex items-center justify-between bg-slate-50/50",children:[(0,t.jsxs)("div",{className:"text-sm text-slate-500",children:["共 ",(0,t.jsx)("span",{className:"font-medium text-slate-900",children:S})," 条记录",T.size>0&&(0,t.jsxs)("span",{className:"ml-2",children:["（已选择 ",(0,t.jsx)("span",{className:"font-medium text-brand-600",children:T.size})," 条）"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>V(e=>Math.max(1,e-1)),disabled:1===U,className:"p-2 border border-slate-200 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)(p,{size:16})}),Array.from({length:Math.min(5,Y)},(e,s)=>{let a;return a=Y<=5||U<=3?s+1:U>=Y-2?Y-4+s:U-2+s,(0,t.jsx)("button",{onClick:()=>V(a),className:`px-3 py-1.5 text-sm font-medium rounded-lg ${U===a?"bg-brand-600 text-white":"text-slate-600 hover:bg-slate-100"}`,children:a},a)}),(0,t.jsx)("button",{onClick:()=>V(e=>Math.min(Y,e+1)),disabled:U===Y||0===Y,className:"p-2 border border-slate-200 rounded-lg text-slate-600 hover:text-slate-900 hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:(0,t.jsx)(b.ChevronRight,{size:16})})]})]})]}):(0,t.jsx)(w.EmptyState,{variant:"search",title:"暂无客户数据",description:P?"没有找到匹配的客户，尝试调整搜索条件":'点击右上角"新建客户"添加第一个客户',icon:h.Users})})})]})}e.s(["default",()=>q],88869)}]);