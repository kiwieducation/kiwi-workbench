# ğŸ—‚ï¸ æŸ¯ç»´å·¥ä½œå° - é¡¹ç›®ç»“æ„è§„åˆ’

## ç›®å½•ç»“æ„ï¼ˆå¯¹é½ v8.0 PRDï¼‰

```
kiwi-workbench/
â”œâ”€â”€ app/                              # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                       # è®¤è¯ç›¸å…³ï¼ˆæ—  Shellï¼‰
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx              # ç™»å½•é¡µ
â”‚   â”‚   â””â”€â”€ layout.tsx                # è®¤è¯å¸ƒå±€ï¼ˆæ— ä¾§è¾¹æ ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ (dashboard)/                  # ä¸»å·¥ä½œå°ï¼ˆå¸¦ Shellï¼‰
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # å…¨å±€ Shellï¼ˆSidebar + Topbarï¼‰
â”‚   â”‚   â”œâ”€â”€ page.tsx                  # ä¸ªäººé¦–é¡µï¼ˆDashboardï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ messages/                 # ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ [conversationId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx          # ä¼šè¯è¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ knowledge/                # ä¼ä¸šçŸ¥è¯†åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # çŸ¥è¯†åº“é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ [documentId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx          # æ–‡æ¡£è¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ projects/                 # é¡¹ç›®åä½œä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # é¡¹ç›®åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ [projectId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx          # é¡¹ç›®è¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ materials/                # é”€å”®ç´ æä¸­å°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ contacts/                 # é€šè®¯å½•
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sales/                    # é”€å”®å·¥ä½œå°
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # é”€å”®é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ customers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # å®¢æˆ·åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [customerId]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # å®¢æˆ·è¯¦æƒ…
â”‚   â”‚   â”‚   â””â”€â”€ contracts/
â”‚   â”‚   â”‚       â””â”€â”€ [contractId]/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx      # åˆåŒè¯¦æƒ…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ bd/                       # BDæ¸ é“å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ marketing/                # å¸‚åœºå·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tutor/                    # å¯¼å¸ˆå·¥ä½œå°
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # å¯¼å¸ˆé¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ [studentId]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx          # å­¦å‘˜æ¡£æ¡ˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ academic/                 # æ•™åŠ¡å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ finance/                  # è´¢åŠ¡äººäº‹å·¥ä½œå°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ quality/                  # ç®¡ç†è´¨æ£€ä¸­å¿ƒ
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ external/                 # å¤–éƒ¨åä½œå¹³å°
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ settings/                 # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                         # Supabase Auth å›è°ƒ
â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚       â””â”€â”€ route.ts              # OAuth å›è°ƒå¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                          # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ health/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts              # å¥åº·æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ globals.css                   # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.tsx                    # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ not-found.tsx                 # 404 é¡µé¢
â”‚
â”œâ”€â”€ components/                       # ç»„ä»¶åº“
â”‚   â”œâ”€â”€ ui/                           # åŸºç¡€ UI ç»„ä»¶ï¼ˆshadcn/uiï¼‰
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ avatar.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ layout/                       # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx               # ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ topbar.tsx                # é¡¶éƒ¨æ 
â”‚   â”‚   â””â”€â”€ shell.tsx                 # å…¨å±€ Shell
â”‚   â”‚
â”‚   â””â”€â”€ shared/                       # å…±äº«ä¸šåŠ¡ç»„ä»¶
â”‚       â”œâ”€â”€ empty-state.tsx           # ç©ºçŠ¶æ€
â”‚       â”œâ”€â”€ loading.tsx               # åŠ è½½çŠ¶æ€
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/                              # å·¥å…·åº“
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts                 # æµè§ˆå™¨ç«¯å®¢æˆ·ç«¯ï¼ˆAnon Keyï¼‰
â”‚   â”‚   â”œâ”€â”€ server.ts                 # æœåŠ¡ç«¯å®¢æˆ·ç«¯ï¼ˆAnon Key + Cookieï¼‰
â”‚   â”‚   â””â”€â”€ middleware.ts             # Middleware å®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ cn.ts                     # className åˆå¹¶
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                        # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ use-user.ts               # å½“å‰ç”¨æˆ·
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â””â”€â”€ mock/                         # Mock æ•°æ®
â”‚       â”œâ”€â”€ users.ts
â”‚       â”œâ”€â”€ tasks.ts
â”‚       â”œâ”€â”€ customers.ts
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ types/                            # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ database.ts                   # Supabase æ•°æ®åº“ç±»å‹
â”‚   â””â”€â”€ entities.ts                   # ä¸šåŠ¡å®ä½“ç±»å‹
â”‚
â”œâ”€â”€ middleware.ts                     # Next.js Middlewareï¼ˆè®¤è¯æ‹¦æˆªï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json                 # é”å®šä¾èµ–ç‰ˆæœ¬
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ next.config.js
```

---

## è·¯ç”±è¡¨ï¼ˆå¯¹é½ v8.0 ç¬¬ 4.2 èŠ‚ï¼‰

| è·¯ç”± | é¡µé¢ | PRD æ¨¡å— | æƒé™ |
|-----|------|---------|-----|
| `/login` | ç™»å½•é¡µ | - | å…¬å¼€ |
| `/` | ä¸ªäººé¦–é¡µ | 1. ä¸ªäººé¦–é¡µ | å…¨å‘˜ |
| `/messages` | ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ | 2. ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ | å…¨å‘˜ï¼ˆå·®å¼‚åŒ–è§†å›¾ï¼‰|
| `/messages/[id]` | ä¼šè¯è¯¦æƒ… | 2. ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒ | å…¨å‘˜ï¼ˆå·®å¼‚åŒ–è§†å›¾ï¼‰|
| `/knowledge` | ä¼ä¸šçŸ¥è¯†åº“ | 3. ä¼ä¸šçŸ¥è¯†åº“ | å…¨å‘˜ |
| `/projects` | é¡¹ç›®åä½œä¸­å¿ƒ | 4. é¡¹ç›®åä½œä¸­å¿ƒ | å…¨å‘˜ |
| `/materials` | é”€å”®ç´ æä¸­å° | 5. é”€å”®ç´ æä¸­å° | å…¨å‘˜ |
| `/contacts` | é€šè®¯å½• | 6. é€šè®¯å½• | å…¨å‘˜ |
| `/sales` | é”€å”®å·¥ä½œå° | 7. é”€å”®å·¥ä½œå° | sales, manager, admin |
| `/sales/customers` | å®¢æˆ·åˆ—è¡¨ | 7. é”€å”®å·¥ä½œå° | sales, manager, admin |
| `/sales/customers/[id]` | å®¢æˆ·è¯¦æƒ… | 7. é”€å”®å·¥ä½œå° | æœ¬äºº/æœ¬éƒ¨é—¨/å…¨å…¬å¸ |
| `/bd` | BDæ¸ é“å·¥ä½œå° | 8. BDæ¸ é“å·¥ä½œå° | bd, manager, admin |
| `/marketing` | å¸‚åœºå·¥ä½œå° | 9. å¸‚åœºå·¥ä½œå° | marketing, manager, admin |
| `/tutor` | å¯¼å¸ˆå·¥ä½œå° | 10. å¯¼å¸ˆå·¥ä½œå° | tutor, manager, admin |
| `/tutor/[studentId]` | å­¦å‘˜æ¡£æ¡ˆ | 10. å¯¼å¸ˆå·¥ä½œå° | æœ¬äºº/æœ¬éƒ¨é—¨/å…¨å…¬å¸ |
| `/academic` | æ•™åŠ¡å·¥ä½œå° | 11. æ•™åŠ¡å·¥ä½œå° | academic, manager, admin |
| `/finance` | è´¢åŠ¡äººäº‹å·¥ä½œå° | 12. è´¢åŠ¡äººäº‹å·¥ä½œå° | finance, manager, admin |
| `/quality` | ç®¡ç†è´¨æ£€ä¸­å¿ƒ | 13. ç®¡ç†è´¨æ£€ä¸­å¿ƒ | manager, admin |
| `/external` | å¤–éƒ¨åä½œå¹³å° | 14. å¤–éƒ¨åä½œå¹³å° | ç®¡ç†å±‚ |
| `/settings` | ç³»ç»Ÿè®¾ç½® | 15. ç³»ç»Ÿè®¾ç½® | åˆ†çº§æƒé™ |

---

## æƒé™/ç™»å½•æµï¼ˆå¯¹é½å®‰å…¨å†»ç»“ï¼‰

### è®¤è¯æµç¨‹

```
ç”¨æˆ·è®¿é—®ä»»æ„é¡µé¢
    â†“
middleware.ts æ‹¦æˆª
    â†“
æ£€æŸ¥ Supabase Sessionï¼ˆä½¿ç”¨ Anon Keyï¼‰
    â†“
â”œâ”€â”€ æ—  Session â†’ é‡å®šå‘ /login
â”‚   â†“
â”‚   ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç  / ä¼ä¸šå¾®ä¿¡ç™»å½•
â”‚   â†“
â”‚   Supabase Auth éªŒè¯
â”‚   â†“
â”‚   é‡å®šå‘å›åŸé¡µé¢
â”‚
â””â”€â”€ æœ‰ Session â†’ æ”¾è¡Œ
    â†“
    é¡µé¢åŠ è½½
    â†“
    RLS ç­–ç•¥è‡ªåŠ¨è¿‡æ»¤æ•°æ®
```

### å…³é”®å®‰å…¨çº¦æŸï¼ˆæ¥è‡ªå†»ç»“æ–‡æ¡£ï¼‰

1. **ç¦æ­¢åœ¨ Vercel/å‰ç«¯ä½¿ç”¨ Service Role Key**
   - æ‰€æœ‰å‰ç«¯ä»£ç åªä½¿ç”¨ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - Service Role Key ä»…é™é˜¿é‡Œäº‘ ECS åŒæ­¥æœåŠ¡

2. **æ•°æ®èŒƒå›´é™åˆ¶ï¼ˆPRD 6.1ï¼‰**
   - æœ¬äººï¼šåªèƒ½çœ‹è‡ªå·±åˆ›å»º/è´Ÿè´£çš„æ•°æ®
   - æœ¬éƒ¨é—¨ï¼šç»„é•¿å¯çœ‹æœ¬éƒ¨é—¨æ‰€æœ‰æˆå‘˜æ•°æ®
   - å…¨å…¬å¸ï¼šç®¡ç†å±‚å¯çœ‹å…¨å…¬å¸æ•°æ®

3. **RLS ç­–ç•¥å¿…é¡»å¯ç”¨**
   - æ‰€æœ‰æ•°æ®è¡¨å¿…é¡»å¯ç”¨ Row Level Security
   - åŸºäº `auth.uid()` å’Œç”¨æˆ·è§’è‰²æ§åˆ¶è®¿é—®

---

## é¡µé¢å®ç°é¡ºåºï¼ˆPhase 1ï¼‰

### ç¬¬ 1 æ‰¹ï¼šåŸºç¡€æ¡†æ¶ï¼ˆæœ¬æ¬¡å®ç°ï¼‰
1. âœ… ç™»å½•é¡µï¼ˆ`/login`ï¼‰
2. âœ… å…¨å±€ Shellï¼ˆSidebar + Topbarï¼‰
3. âœ… ä¸ªäººé¦–é¡µï¼ˆ`/`ï¼‰

### ç¬¬ 2 æ‰¹ï¼šå…¬å¸çº§èƒ½åŠ›
4. ä¼ä¸šå¾®ä¿¡ä¼šè¯ä¸­å¿ƒï¼ˆ`/messages`ï¼‰
5. ä¼ä¸šçŸ¥è¯†åº“ï¼ˆ`/knowledge`ï¼‰
6. é¡¹ç›®åä½œä¸­å¿ƒï¼ˆ`/projects`ï¼‰
7. é€šè®¯å½•ï¼ˆ`/contacts`ï¼‰

### ç¬¬ 3 æ‰¹ï¼šéƒ¨é—¨å·¥ä½œå°
8. é”€å”®å·¥ä½œå°ï¼ˆ`/sales`ï¼‰+ å®¢æˆ·åˆ—è¡¨/è¯¦æƒ…
9. å¯¼å¸ˆå·¥ä½œå°ï¼ˆ`/tutor`ï¼‰+ å­¦å‘˜æ¡£æ¡ˆ
10. å…¶ä»–éƒ¨é—¨å·¥ä½œå°ï¼ˆBD/å¸‚åœº/æ•™åŠ¡/è´¢åŠ¡ï¼‰

### ç¬¬ 4 æ‰¹ï¼šç®¡ç†ä¸å¤–éƒ¨
11. ç®¡ç†è´¨æ£€ä¸­å¿ƒï¼ˆ`/quality`ï¼‰
12. å¤–éƒ¨åä½œå¹³å°ï¼ˆ`/external`ï¼‰
13. ç³»ç»Ÿè®¾ç½®ï¼ˆ`/settings`ï¼‰

---

## éªŒæ”¶æ ‡å‡†

### ç¬¬ 1 æ‰¹éªŒæ”¶ç‚¹

| åºå· | éªŒæ”¶ç‚¹ | é¢„æœŸç»“æœ |
|-----|-------|---------|
| 1.1 | è®¿é—® `localhost:3000` | æœªç™»å½•æ—¶è‡ªåŠ¨è·³è½¬ `/login` |
| 1.2 | ç™»å½•é¡µæ˜¾ç¤º | æ˜¾ç¤ºé‚®ç®±+å¯†ç è¡¨å•ï¼Œä¼ä¸šå¾®ä¿¡ç™»å½•æŒ‰é’® |
| 1.3 | ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½• | æˆåŠŸåè·³è½¬é¦–é¡µ `/` |
| 1.4 | é¦–é¡µæ˜¾ç¤º | æ˜¾ç¤º Sidebar + Topbar + Dashboard å†…å®¹ |
| 1.5 | ä¾§è¾¹æ å¯¼èˆª | ç‚¹å‡»èœå•é¡¹é«˜äº®ï¼Œè·¯ç”±åˆ‡æ¢æ­£å¸¸ |
| 1.6 | é¡¶éƒ¨æ ä¿¡æ¯ | æ˜¾ç¤ºå½“å‰ç”¨æˆ·å¤´åƒã€åç§°ã€è§’è‰² |
| 1.7 | ç™»å‡ºåŠŸèƒ½ | ç‚¹å‡»ç™»å‡ºåè·³è½¬ `/login` |

---

**å¼€å§‹å®ç°ç¬¬ 1 æ‰¹é¡µé¢** ğŸ‘‡
